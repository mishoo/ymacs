/*
 * DynarchLIB version: 2.0
 *                                                                ____   _____
 * A lightweight JavaScript toolkit for professionals.            \  /_  /   /
 *                                                                 \  / /   /
 * Copyright (c) Dynarch.com 2005-2010.  All rights reserved.       \/ /_  /
 * See http://www.dynarchlib.com/licensing for licensing details.    \  / /
 *                                                                     / /
 *          this package built at 2012/03/25 10:55 GMT                 \/
 */
function $_YIELD(a){this.timeout=a||0}function $_RETURN(a){this.args=a}function $YIELD(a){throw new $_YIELD(a)}function $BREAK(){throw $_BREAK}function $CONTINUE(){throw $_CONTINUE}function $RETURN(a){throw new $_RETURN(a)}function DEFINE_CLASS(a,b,c,d){function f(c){var d;if(c!==$__JSOOP){if(this===window)return alert("FIXME: Constructor called without new in "+a);f.FIXARGS&&(arguments.length==0&&(c={},d=[c]),f.FIXARGS.apply(this,d||arguments)),f.DEFAULT_ARGS&&f.setDefaults(this,c),f.BEFORE_BASE&&f.BEFORE_BASE.apply(this,d||arguments),b&&b.apply(this,d||arguments),f.CONSTRUCT&&f.CONSTRUCT.apply(this,d||arguments)}}var e;return f.name=a||"",d&&(f.hidden=!0),b&&f.inherits(b,a),a&&!d&&(window[a]=f),e=f.prototype,c&&(f.DEFINITION=c,c(f,e,DynarchDomUtils)),e.FINISH_OBJECT_DEF instanceof Function&&e.FINISH_OBJECT_DEF(),e.$||(e.$=Object.curry2),f}function EXTEND_CLASS(a,b){b(a,a.prototype,DynarchDomUtils)}function DEFINE_HIDDEN_CLASS(a,b,c){return DEFINE_CLASS.call(this,a,b,c,!0)}function DEFINE_SINGLETON(a,b,c){var d=DEFINE_HIDDEN_CLASS(a,b,c);return DlSingleton.register(a,d,!0),d}function DEFINE_EXCEPTION(a,b){return DEFINE_CLASS(a,b||DlException)}function DlPoint(a,b){typeof a=="object"?(this.x=a.x,this.y=a.y):(this.x=a,this.y=b)}function DlRect(a,b,c,d){a instanceof DlRect?this.setFromRect(a):typeof a=="object"?typeof b=="object"?b instanceof DlPoint?this.setFromPoints(a,b):this.setFromValues(a.x,a.y,b.x,b.y):this.setFromValues(a.x,a.y,c,d):this.setFromValues(a,b,c,d)}function DlMenuBase(){function c(b,c,d){var e=d?d.widget:null;this._noClose||DlPopupMenu.clearAll(),a.applyHooks.delayed(1,a,"onSelect",[this.name,this,e])}var a,b;if(this._isMenuBase)return;this._isMenuBase=!0,this._items=[],a=this,b=this.appendWidget,this.appendWidget=function(a){a instanceof DlMenuItem&&(this._items.push(a),a.name!=null&&a.addEventListener("onSelect",c)),b.apply(this,Array.$(arguments))},this.getItemByName=function(a){return this._items.grep_first(function(b){return b.name&&b.name==a})},this.getItemById=function(a){return this._items.grep_first(function(b){return b.__itemId&&b.__itemId==a})},this instanceof DlHbox?this._popupAlign={prefer:"Br",fallX1:"_r",fallX2:"_l",fallY1:"B_",fallY2:"T_"}:this._popupAlign={prefer:"bR",fallX1:"_R",fallX2:"_L",fallY1:"b_",fallY2:"t_"},this._getDlPopup=function(){var a,b=this.getParent(DlPopupMenu),c=0;return b&&(c=b._level+1),a=DlPopupMenu.get(c),a.detachPopup(),b&&a.attachToPopup(b),a},this.getToplevelMenu=function(){var a=this;while(a.parentMenu)a=a.parentMenu;return a}}function DlType(a){a&&(this.name=a,DlType.TYPES[a]=this)}function DlConsole(){this._messages=[],DlConsole.INSTANCE=this}var CE_CACHE,$__JSOOP,$_BREAK,$_CONTINUE,$,DlElementCache,DlColor,DlKeyboard;DlTEXTS={goToday:"Go Today",_date_monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],_date_shortMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_date_dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],_date_shortDayNames:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],_date_firstDayOfWeek:1};try{document.execCommand("BackgroundImageCache",!1,!0)}catch(e){}CE_CACHE={HTML_ESCAPE_DIV:document.createElement("div"),HTML_ESCAPE_TEXT:document.createTextNode(""),CONTAINER:document.createElement("div")},CE_CACHE.HTML_ESCAPE_DIV.appendChild(CE_CACHE.HTML_ESCAPE_TEXT),Array.$=function(a,b){var c,d,e;b==null&&(b=0);try{c=Array.prototype.slice.call(a,b)}catch(f){c=Array(a.length-b);for(d=b,e=0;d<a.length;++d,++e)c[e]=a[d]}return c},Object.merge=function(a,b){var c;a==null&&(a={});if(b)for(c in b)a[c]=b[c];return a},Object.merge(Object,{mergeDefined:function(a,b){var c;for(c in b)typeof b[c]!="undefined"&&(a[c]=b[c]);return a},mergeUndefined:function(a,b){var c;for(c in b)c in a||(a[c]=b[c]);return a},remove:function(a,b){var c;for(c=b.length;--c>=0;)delete a[b[c]]},isEmpty:function(a){var b;for(b in a)return!1;return!0},makeCopy:function(a){var b,c={};for(b in a)c[b]=a[b];return c},makeDeepCopy:function(a){var b,c,d;if(a instanceof Array){b=[],c=a.length;while(--c>=0)b[c]=Object.makeDeepCopy(a[c]);return b}if(a===null)return null;if(a instanceof Function)return a;if(a instanceof Date)return new Date(a);if(a instanceof Object){d={};for(c in a)d[c]=Object.makeDeepCopy(a[c]);return d}return a},makeShortcuts:function(a,b){var c;for(c in b)a[c]=a[b[c]]},foreach:function(a,b,c){var d;for(d in a)try{b.call(c,a[d],d)}catch(e){if(e===$_BREAK)break;if(e===$_CONTINUE)continue;if(e instanceof $_RETURN)return e.args;throw e}},map:function(a,b,c){var d,e=[];for(d in a)if(a.hasOwnProperty(d))try{e.push(b.call(c,a[d],d))}catch(f){if(f===$_BREAK)break;if(f===$_CONTINUE)continue;if(f instanceof $_RETURN)return f.args;throw f}return e},curry2:function(a){return a instanceof Function||(a=this[a]),a.$A(this,Array.$(arguments,1))},HOP:function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},clear:function(a){var b;for(b in a)Object.HOP(a,b)&&delete a[b]}}),Object.merge(Function,{INHERITANCE:{},getInheritanceGraph:function(){return Function.INHERITANCE},noop:function(){},identity:function(a){return a},returnTrue:function(){return!0},returnFalse:function(){return!1},returnThis:function(){return this},invoke:function(a){return a()}}),$__JSOOP=new Function.noop,Object.merge(Function.prototype,{$:Function.prototype.closure=function(a){var b=Array.$(arguments,1),c=this;return a==window.undefined?function(){return c.apply(this,b.concat(Array.$(arguments)))}:function(){return c.apply(a,b.concat(Array.$(arguments)))}},$0:function(a){var b=this,c=Array.$(arguments,1);return function(){return b.apply(a,c)}},inherits:function(a,b){var c=this.prototype=new a($__JSOOP);return c.constructor=this,this.BASE=a.prototype,Function.INHERITANCE[this.name=this._objectType=c._objectType=b||Dynarch.getFunctionName(this)]=Dynarch.getFunctionName(a),this.BASE},setDefaults:function(a,b,c){return Dynarch.setDefaults.call(a,this.DEFAULT_ARGS,b,c)},$$:function(a){return this.$.apply(this,a)},$A:function(a,b){return this.$.apply(this,[a].concat(b))},$C:function(){var a=Array.$(arguments),b=this;return function(){return b.apply(null,a.concat(Array.$(arguments)))}},inverse:function(){var a=this;return function(){return!a.apply(this,arguments)}},clearingTimeout:function(a,b){var c=null,d=this,e=Array.$(arguments,2),f=function(){c&&clearTimeout(c),c=setTimeout(d.$A(b==null?this:b,e.concat(Array.$(arguments))),a)};return f.cancel=function(){clearTimeout(c)},f.doItNow=function(){clearTimeout(c),d.apply(b,e.concat(Array.$(arguments)))},f},rarify:function(a,b){var c=this.$$(Array.$(arguments,2)),d=this.clearingTimeout.apply(this,Array.$(arguments,1)),e=a,f=null,g=function(){e=a};return function(){return f&&clearTimeout(f),f=setTimeout(g,b),e-->0?c.apply(this,arguments):d.apply(this,arguments)}},delayed:function(a){var b=arguments.length>1?this.$$(Array.$(arguments,1)):this;return setTimeout(b,a)},setInterval:function(a){var b=arguments.length>1?this.$$(Array.$(arguments,1)):this;return setTimeout(b,0),setInterval(b,a)},inject:function(a){return a==null&&(a=this.OBJECT_EXTENSIONS),Object.merge(this.prototype,a),this},memoize:function(){var a=this,b=$__JSOOP;return function(){return b===$__JSOOP&&(b=a.apply(this,arguments)),b}}}),Object.merge(Array,{hashKeys:function(a){var b,c=[],d=0;for(b in a)a.hasOwnProperty(b)&&(c[d++]=b);return c},hashValues:function(a){var b,c=[],d=0;for(b in a)a.hasOwnProperty(b)&&(c[d++]=a[b]);return c}}),$_BREAK={},$_CONTINUE={},Array.inject({map_hash:function(a,b,c){return c||(c={}),this.foreach(a instanceof Function?function(d){c[d]=a.call(b,d)}:function(b){c[b]=a[b]}),c},accumulate:function(a,b){var c;arguments.length<2&&(b=0);for(c=0;c<this.length;++c)b=a(this[c],b,c);return b},foreach:function(a,b){var c,d;b==null&&(b=this),c=0,d=this.length;while(d-->0)try{a.call(b,this[c],c++)}catch(e){if(e===$_BREAK)break;if(e===$_CONTINUE)continue;if(e instanceof $_RETURN)return e.args;throw e}},r_foreach:function(a,b){var c;b==null&&(b=this);for(c=this.length;--c>=0;)try{a.call(b,this[c],c)}catch(d){if(d===$_BREAK)break;if(d===$_CONTINUE)continue;if(d instanceof $_RETURN)return d.args;throw d}},assign_each:function(a,b){return this.foreach(function(c,d){this[d]=a.call(b,d,c)})},r_assign_each:function(a,b){return this.r_foreach(function(c,d){this[d]=a.call(b,d,c)})},toHash:function(a,b){var c={};return a instanceof Function?this.foreach(function(d,e){c[d]=a.call(b,d,e)}):this.foreach(function(b,d){c[b]=a!=null?a:d+1}),c},toHash2:function(){var a={},b=0;while(b<this.length)a[this[b++]]=this[b++];return a},toHash3:function(a,b){var c={};return a instanceof Function?this.foreach(function(d,e){var f=a.call(b!=null?b:d,d,e);c[f[0]]=f[1]}):this.foreach(function(b){c[b[a]]=b}),c},map:function(a,b){var c,d,e=0,f=this.length,g=[];if(a instanceof Function){b==null&&(b=this);while(f-->0)try{g.push(a.call(b,this[e],e++))}catch(h){if(h===$_BREAK)break;if(h===$_CONTINUE)continue;if(h instanceof $_RETURN){g.push(h.args);break}throw h}}else{c=Array.$(arguments,1);while(f-->0)b=this[e],d=b[a],g[e++]=d instanceof Function?d.apply(b,c):d}return g},r_map:function(a,b){var c,d,e=this.length,f=[];if(a instanceof Function){b==null&&(b=this);while(--e>=0)try{f.push(a.call(b,this[e],e))}catch(g){if(g===$_BREAK)break;if(g===$_CONTINUE)continue;if(g instanceof $_RETURN){f.push(g.args);break}throw g}}else{d=Array.$(arguments,1);while(--e>=0)b=this[e],c=b[a],f[e]=c instanceof Function?c.apply(b,d):c}return f.reverse()},count:function(a,b){var c=0;return this.r_foreach(function(b,d){a.call(this,b,d)&&++c},b),c},keys_map:function(a){return this.map(function(b){return a[b]})},grep:function(a,b){var c,d,e,f=0,g=this.length,h=[];if(a instanceof RegExp)while(g-->0)c=this[f++],a.test(c)&&h.push(c);else if(a instanceof Function){b==null&&(b=this);while(g-->0)c=this[f],a.call(b,c,f++)&&h.push(c)}else{d=Array.$(arguments,1);while(g-->0)b=this[f++],e=b[a],e instanceof Function?e.apply(b,d)&&h.push(b):e&&h.push(b)}return h},grep_last:function(a,b){var c;b==null&&(b=this.length-1);while(b>=0){c=this[b--];if(a(c))return c}return null},grep_first:function(a,b){var c;for(b=b||0;b<this.length;++b){c=this[b];if(a(c))return c}return null},contains:function(a){var b;for(b=this.length;--b>=0;)if(this[b]===a)return!0;return!1},any:function(a,b){var c,d,e;if(a instanceof Function){b==null&&(b=this);for(c=this.length;--c>=0;)if(a.call(b,this[c],c))return!0}else{d=Array.$(arguments,1);for(c=this.length;--c>=0;){b=this[c],e=b[a];if(e instanceof Function){if(e.apply(b,d))return!0}else if(e)return!0}}return!1},find:function(a){var b;for(b=this.length;--b>=0;)if(this[b]===a)return b;return-1},remove:function(a){var b;for(b=this.length;--b>=0;)this[b]===a&&this.splice(b,1);return this},pushUnique:function(a){return this.find(a)<0?(this.push(a),this.length):null},peek:function(a){if(this.length>0)return this[this.length-1-(a!=null?Math.abs(a):0)]},min:function(a,b){var c,d;if(this.length==0)return null;if(arguments.length>0){c=a!=null?a.call(b,this[0],0):this[0];for(d=1;d<this.length;++d)c=Math.min(c,a!=null?a.call(b,this[d],d):this[d]);return c}return Math.min.apply(Math,this)},minElement:function(a,b,c){var d,e,f,g,h;if(this.length==0)return null;d=0,e=this[0],f=a.call(b,e),g=0;while(++d<this.length)(h=a.call(b,this[d]))<f&&(f=h,g=d,e=this[d]);return c&&this.splice(g,1),e},max:function(a,b){var c,d;if(this.length==0)return null;if(arguments.length>0){c=a!=null?a.call(b,this[0],0):this[0];for(d=1;d<this.length;++d)c=Math.max(c,a!=null?a.call(b,this[d],d):this[d]);return c}return Math.max.apply(Math,this)},maxElement:function(a,b,c){var d,e,f,g,h;if(this.length==0)return null;d=0,e=this[0],f=a.call(b,e),g=0;while(++d<this.length)(h=a.call(b,this[d]))>f&&(f=h,g=d,e=this[d]);return c&&this.splice(g,1),e},rotateIndex:function(a){return Math.rotateLimit(a,0,this.length-1)},limitIndex:function(a){return Math.limit(a,0,this.length-1)},nullLimitIndex:function(a){return Math.nullLimit(a,0,this.length-1)},bytesToString:function(){var a,b="",c=0;while(c<this.length)a=this[c++],a&240^240?a&224^224?a&192^192||(a=(a&31)<<6|this[c++]&63):a=(a&15)<<12|(this[c++]&63)<<6|this[c++]&63:a=(a&3)<<18|(this[c++]&63)<<12|(this[c++]&63)<<6|this[c++]&63,b+=String.fromCharCode(a);return b},repeat:function(a){var b;return a==0?[]:a==1?this:(b=this.repeat(a>>1),b=b.concat(b),a&1&&(b=b.concat(this)),b)},common_prefix:function(){var a,b,c,d;switch(this.length){case 0:return"";case 1:return this[0];case 2:a=this[0],b=this[1],c=Math.min(a.length,b.length),d=0;while(d<c&&a.charAt(d)===b.charAt(d))++d;return a.substring(0,d);default:return[this[0],this.slice(1).common_prefix()].common_prefix()}},append:function(a){this.push.apply(this,a)},prepend:function(a){this.unshift.apply(this,a)},toXML:function(){var a,b,c,d=this[0];if(d=="~literal")return this.slice(1).flatJoin();a="<"+d,b=1,c=this[1],typeof c=="object"&&(Object.foreach(c,function(b,c){c.charAt(0)=="$"&&(c=c.substr(1)),a+=" "+c.htmlEscape()+'="',typeof b=="object"?a+=Object.map(b,function(a,b){return b=b.replace(/([a-z]?)([A-Z])/g,function(a,b,c){return b+"-"+c.toLowerCase()}),b.htmlEscape()+": "+a.htmlEscape()}).join("; "):a+=b.htmlEscape(),a+='"'}),++b),a+=">";while(b<this.length)c=this[b++],c instanceof Array?a+=c.toXML():a+=(c+"").htmlEscape();return a+"</"+d+">"},swap:function(a,b){var c=this[a];return this[a]=this[b],this[b]=c,this}}),Number.inject({map:function(a,b){return a+(b-a)*this},reduce:function(a,b){return(this-a)/(b-a)},mapInt:function(a,b){return Math.round(this.map(a,b))},reduceInt:function(a,b){return Math.round((this-a)/(b-a))},bits1Array:function(){var a=this,b=[],c=1,d=0;while(a>0)a&1&&(b[d++]=c),c<<=1,a>>=1;return b},times:function(a,b){var c=this,d=0;while(--c>=0)a.call(b,d++,c)},hex:function(a){var b=this.toString(16).toUpperCase();if(a)while(b.length<a)b="0"+b;return b},zeroPad:function(a,b){var c=""+Math.round(this);b==null&&(b="0");while(c.length<a)c=b+c;return c},formatTime:function(){var a,b=this,c=b/60;return b%=60,a=c/60,c%=60,[a,c,b].map("zeroPad",2).join(":")},toDate:function(a,b,c,d){return Date.intToDate(this,a,b,c,d)},limit:function(a,b){return Math.limit(this,a,b)},rotateLimit:function(a,b){return Math.rotateLimit(this,a,b)},nullLimit:function(a,b){return Math.nullLimit(this,a,b)},i18n:function(a){var b=this;return arguments.length>1?a=Array.$(arguments):a=a.trim().split(/\s*\|\s*/),a=b<a.length?a[b]:a[a.length-1],a.replace(/##?/g,function(a){return a.length==2?"#":b})}}),Object.merge(Math,{nullLimit:function(a,b,c){return a<b&&(a=null),a>c&&(a=null),a},limit:function(a,b,c){return a<b&&(a=b),a>c&&(a=c),a+0},rotateLimit:function(a,b,c){return c++,a%=c-b,a<0?a=c+a:a<b&&(a=b-a),a+0}}),Object.merge(Date,{_MD:[31,28,31,30,31,30,31,31,30,31,30,31],SECOND:1e3,MINUTE:6e4,HOUR:36e5,DAY:864e5,WEEK:6048e5,_MN:DlTEXTS._date_monthNames,_SMN:DlTEXTS._date_shortMonthNames,_DN:DlTEXTS._date_dayNames,_SDN:DlTEXTS._date_shortDayNames,_FDOW:DlTEXTS._date_firstDayOfWeek,isWeekend:function(a){return a==0||a==6},parseMySQL:function(a,b){var c=a.split(/\s+/),d=c[0].split(/-/),e=c[1].split(/:/),f=new Date(d[0],d[1]-1,d[2],e[0]||null,e[1]||null,e[2]||null);return b&&(f.setUTCMilliseconds(0),f.setUTCSeconds(e[2]||0),f.setUTCMinutes(e[1]||0),f.setUTCHours(e[0]||0),f.setUTCDate(1),f.setUTCMonth(d[1]-1),f.setUTCDate(d[2]),f.setUTCFullYear(d[0])),f},dateToInt:function(a){return a instanceof Date?1e4*a.getFullYear()+100*(a.getMonth()+1)+a.getDate():typeof a=="string"?parseInt(a,10):a},intToDate:function(a,b,c,d,e){var f,g;return a instanceof Date||(a=parseInt(a,10),f=Math.floor(a/1e4),a%=1e4,g=Math.floor(a/100),a%=100,a=new Date(f,g-1,a,b||12,c||0,d||0,e||0)),a},getMonthName:function(a,b){var c=b?Date._SMN:Date._MN;return c[a%12]},getFirstDayOfWeek:function(){return Date._FDOW},getDayName:function(a,b){var c=b?Date._SDN:Date._DN;return c[a%7]}}),Date.now||(Date.now=function(){return(new Date).getTime()}),Date.inject({toInt:function(){return Date.dateToInt(this)},getMonthDays:function(a){var b=this.getFullYear();return a==null&&(a=this.getMonth()),0!=b%4||0==b%100&&0!=b%400||a!=1?Date._MD[a]:29},getDayOfYear:function(){var a=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0),b=new Date(this.getFullYear(),0,0,0,0,0),c=a-b;return Math.floor(c/Date.DAY)},getWeekNumber:function(){var a,b=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0),c=b.getDay();return b.setDate(b.getDate()-(c+6)%7+3),a=b.valueOf(),b.setMonth(0),b.setDate(4),Math.round((a-b.valueOf())/6048e5)+1},dateEqualsTo:function(a,b){return this.getFullYear()==a.getFullYear()&&this.getMonth()==a.getMonth()&&(b||this.getDate()==a.getDate())},print:function(a){var b,c,d,e,f,g,h=this.getMonth(),i=this.getDate(),j=this.getFullYear(),k=this.getWeekNumber(),l=this.getDay(),m={},n=this.getHours(),o=n>=12,p=o?n-12:n,q=this.getDayOfYear();return p==0&&(p=12),b=this.getMinutes(),c=this.getSeconds(),m["%a"]=Date.getDayName(l,!0),m["%A"]=Date.getDayName(l),m["%b"]=Date.getMonthName(h,!0),m["%B"]=Date.getMonthName(h),m["%C"]=1+Math.floor(j/100),m["%d"]=i<10?"0"+i:i,m["%e"]=i,m["%H"]=n<10?"0"+n:n,m["%I"]=p<10?"0"+p:p,m["%j"]=q<100?q<10?"00"+q:"0"+q:q,m["%k"]=n,m["%l"]=p,m["%m"]=h<9?"0"+(1+h):1+h,m["%M"]=b<10?"0"+b:b,m["%n"]="\n",m["%p"]=o?"PM":"AM",m["%P"]=o?"pm":"am",m["%s"]=Math.floor(this.getTime()/1e3),m["%S"]=c<10?"0"+c:c,m["%t"]="	",m["%U"]=m["%W"]=m["%V"]=k<10?"0"+k:k,m["%u"]=l+1,m["%w"]=l,m["%y"]=(""+j).substr(2,2),m["%Y"]=j,m["%%"]="%",d=/%./g,a.replace(d,function(a){return m[a]||a})}}),String.inject({breakable:function(a){return a||(a=/([_.-])/g),this.replace(a,"$1<span class='BreakPoint'> </span>")},printf:function(){var a=Array.$(arguments),b=0;return this.replace(/%[sdfo%]/g,function(c){var d;c=c.charAt(1),d=a[b++];switch(c){case"s":return d+"";case"d":return parseInt(d);case"f":return parseFloat(d).toFixed(3);case"o":return d;case"%":return"%"}return"undefined"})},fixedWidth:function(a){return String.buffer("<div style='width:",a,"'>",this,"</div>").get()},noWrap:function(){return this.replace(/\x20/g,"&nbsp;")},lastIndexOfRegexp:function(a,b){var c,d=0;a.lastIndex=0,a.global=!0;while(c=a.exec(this)){if(a.lastIndex>=b)break;d=a.lastIndex}return d},hashWords:function(a){return this.trim().split(/\s+/).toHash(arguments.length>0?a:!0)},arrayWords:function(){return this.trim().split(/\s+/)},trim:function(a,b){var c=a?this:this.replace(/^\s+/,"");return b||(c=c.replace(/\s+$/,"")),c},htmlEscapeFull:function(){return this.replace(/&/g,"&amp;").replace(/\x22/g,"&quot;").replace(/\x27/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00A0/g,"&#xa0;")},decodeJSON:function(a){return DlJSON.decode(this,a)},makeLabel:function(){return this.replace(/\s+/g,"&nbsp;")},capitalizeString:function(){return this.charAt(0).toUpperCase()+this.substr(1)},htmlEmbed:function(a,b){var c=["<",a];return b!=null&&c.push(" class='",b,"'"),c.push(">",this,"</",a,">"),c.join("")},repeat:function(a){var b;return a==0?"":a==1?""+this:(b=this.repeat(a>>1),b+=b,a&1&&(b+=this),b)},hexToBytes:function(a){var b=[],c=0,d=this;a&&(d=d.replace(/[^0-9a-f]/ig,"")),d.length&1&&(d="0"+d);while(c<d.length)b.push(parseInt(d.substr(c,2),16)),c++,c++;return b},toBytes:function(){var a,b=this.length,c=0,d=0,e=[];while(--b>=0)a=this.charCodeAt(d++),a<128?e[c++]=a:a<2048?(e[c++]=192|a>>>6&31,e[c++]=128|a&63):a<65536?(e[c++]=224|a>>>12&15,e[c++]=128|a>>>6&63,e[c++]=128|a&63):a<1114112&&(e[c++]=240|a>>>18&3,e[c++]=128|a>>>12&63,e[c++]=128|a>>>6&63,e[c++]=128|a&63);return e}}),function(){function j(a,b){return b?a instanceof Function?function(b,c){return a(c,b)}:function(a,b){return b<a?-1:b>a?1:0}:a instanceof Function?a:function(a,b){return a<b?-1:a>b?1:0}}function k(a){a instanceof Array?a.foreach(k,this):a instanceof Function?(a=a(),a!=null&&a!=0&&k.call(this,a)):this.push(a)}function l(a){return a instanceof Array?a.accumulate(function(a,b){return b+l(a)},""):a instanceof Function?l(a()):a===!1||a==null?"":a+""}var a,b,c,d,e,f,g,h,i=navigator.userAgent;is_opera=/opera/i.test(i),is_ie=/msie/i.test(i)&&!is_opera&&!/mac_powerpc/i.test(i),is_ie5=is_ie&&/msie 5\.[^5]/i.test(i),is_ie6=is_ie&&/msie 6/i.test(i),is_ie7=is_ie&&/msie 7/i.test(i),is_ie8=is_ie&&/msie 8/i.test(i),ie_box_model=is_ie&&document.compatMode&&document.compatMode=="BackCompat",is_mac_ie=/msie.*mac/i.test(i),is_khtml=/Konqueror|Safari|KHTML/i.test(i),is_safari=/Safari/i.test(i),is_safari3=is_safari&&/Version\/3/i.test(i),is_konqueror=is_khtml&&!is_safari3,is_gecko=/gecko/i.test(i)&&!is_khtml&&!is_opera&&!is_ie,is_chrome=/Chrome/i.test(i),is_w3=!is_ie,is_macintosh=/Macintosh/i.test(i),is_gecko&&/rv:\s*([0-9.]+)/.test(i)&&(gecko_version=parseFloat(RegExp.$1)),a=Array.prototype,b=Date.prototype,c=String.prototype,d=Number.prototype,a.mergeSort=function(a,b){function d(a,b){var d=[],e=0,f=0,g=0;while(e<a.length&&f<b.length)c(a[e],b[f])>0?d[g++]=b[f++]:d[g++]=a[e++];return e<a.length&&d.push.apply(d,a.slice(e)),f<b.length&&d.push.apply(d,b.slice(f)),d}function e(a){var b,c,f;return a.length>1?(b=Math.floor(a.length/2),c=a.slice(0,b),f=a.slice(b),c=e(c),f=e(f),d(c,f)):a}var c;return this.length<2?Array.$(this):(c=j(a,b),e(this))},a.qsort=function(a,b){function g(a,b){var h=a,i=b,j=!1;if(h<i){do c(d[h],d[i])>0&&(e=d[h],d[h]=d[i],d[i]=e,j=!j,f=!0),j?--i:++h;while(h<i);g(a,h-1),g(h+1,b)}}var c,d,e,f;if(this.length<2)return;return c=j(a,b),d=this,f=!1,g(0,this.length-1),f},a.x=a.repeat,a.flatJoin=function(){return l(this)},a.flatten=function(){var a=[];return k.call(a,this),a},e=d.$1K=1024,f=d.$1M=e*1024,g=d.$1G=f*1024,h=d.$1T=g*1024,d.formatBytes=function(a){var b,c,d=this;return d<e?b="B":d<f?(d/=e,b="K"):d<g?(d/=f,b="M"):d<h&&(d/=g,b="G"),c=Math.round(d),a&&d!=c?d.toFixed(a)+b:c+b},c.qw=c.arrayWords,c.bold=c.htmlEmbed.$(window.undefined,"b"),c.x=c.repeat}(),Object.merge(String,{firstNonEmpty:function(){var a,b;for(a=0;a<arguments.length;++a){b=arguments[a];if(/\S/.test(b))return b}},template:function(){var format=String.buffer.apply(this,arguments).get();return function(props){return format.replace(/(.?)\$(\{.*?\}|[a-zA-Z0-9_]+)/g,function(s,p1,p2){return p1.charAt(0)=="\\"?s.substr(1):(p2.charAt(0)=="{"&&(p2=p2.substr(1,p2.length-2)),eval("p2 = props."+p2),p1+p2)})}},buffer:is_ie||is_khtml?function(){var a=[],b=0,c=function(){for(var d=0;d<arguments.length;++d)a[b++]=arguments[d];return c};return c.get=function(){return a=[a.join("")],b=1,a[0]},arguments.length>0&&c.apply(this,arguments),c}:function(){var a="",b=function(){return a=a.concat.apply(a,arguments),b};return arguments.length>0&&b.apply(this,arguments),b.get=function(){return a},b}}),String.prototype.htmlEscape=is_gecko?function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00A0/g,"&#xa0;")}:function(){return CE_CACHE.HTML_ESCAPE_TEXT.data=this,CE_CACHE.HTML_ESCAPE_DIV.innerHTML},window.Dynarch={dblClickTimeout:400,setDefaults:function(a,b,c){var d,e,f;b||(b={});for(d in a)if(c||!(d in this))f=a[d],f instanceof Array?f[0]!=null?(e=f[0],e in b?e=b[e]:e=f[1]):e=f[1]:e=f,this[d]=e},__IDS:{},ID:function(a){var b=Dynarch.__IDS;return a==null&&(a="generic"),a in b||(b[a]=0),"dynarch-"+a+"-"+ ++b[a]},getFunctionName:function(a){return a.name!=null?a.name:/function\s+(\$?[a-z0-9_]+)\(/i.test(a+"")?RegExp.$1:"UNKNOWN_FUNCTION"},EXPORT:function(a,b){var c=String.buffer("var D=window.",a,"=",a,",P=",a,".prototype;");return b&&c(DynarchDomUtils.importCommonVars()),c.get()},getBaseURL:function(){var a,b,c,d=window.Dynarch_Base_Url;if(!d){a=document.getElementsByTagName("script"),b=0;while(c=a[b++])if(c.className=="DynarchLIB"){d=c.src;if(/^(.*)\x2fjs\x2f/.test(d)){Dynarch_Base_Url=d=RegExp.$1;break}}}return d},getFileURL:function(a){return Dynarch.getBaseURL()+"/"+a},firebugRunning:function(){return window.console&&window.console.firebug},evalClean:function(code){return Dynarch.firebugRunning()?Function("return ("+code+");")():eval("("+code+")")}},window.DynarchDomUtils={ID:Dynarch.ID,related:function(a,b){var c,d;is_ie?(d=b.type,d=="mouseover"?c=b.fromElement:d=="mouseout"&&(c=b.toElement)):c=b.relatedTarget;if(is_gecko&&c)try{c.parentNode}catch(e){try{c=b.parentNode}catch(e){c=b.target}}try{for(;c;c=c.parentNode)if(c===a)return!0}catch(e){return!0}return!1},getScrollbarSize:function(a){return{x:a.offsetWidth-a.clientWidth,y:a.offsetHeight-a.clientHeight}},addEvent:function(a,b,c){var d;if(typeof b=="string")a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c;else if(b instanceof Array)DynarchDomUtils.addEvents(a,b,c);else for(d in b)DynarchDomUtils.addEvent(a,d,b[d])},addEvents:function(a,b,c){var d;for(d=b.length;--d>=0;)DynarchDomUtils.addEvent(a,b[d],c)},removeEvent:function(a,b,c){var d;if(typeof b=="string")a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]="";else if(b instanceof Array)DynarchDomUtils.removeEvents(a,b,c);else for(d in b)DynarchDomUtils.removeEvent(a,d,b[d])},removeEvents:function(a,b,c){var d;for(d=b.length;--d>=0;)DynarchDomUtils.removeEvent(a,b[d],c)},condEvent:function(a){return a=a?DynarchDomUtils.addEvent:DynarchDomUtils.removeEvent,a.apply(DynarchDomUtils,Array.$(arguments,1))},condEvents:function(a){return a=a?DynarchDomUtils.addEvents:DynarchDomUtils.removeEvents,a.apply(DynarchDomUtils,Array.$(arguments,1))},stopEvent:function(a){return is_ie?(a.cancelBubble=!0,a.returnValue=!1):(a.preventDefault(),a.stopPropagation()),!1},addLoadHandler:function(a,b){is_ie?a.onreadystatechange=function(){if(a.readyState==4){try{a.onreadystatechange=null}catch(c){}b()}}:DynarchDomUtils.addEvent(a,"load",b)},callHandler:function(a,b){if(a[b]instanceof Function)return a[b].call(a);if(typeof a[b]=="string")return Dynarch.evalClean(a[b])},setStyleProperty:function(a,b,c){switch(b){case"float":b="styleFloat";break;default:b=b.toLowerCase().replace(/-([a-z])/g,function(a,b){return b.toUpperCase()})}a.style[b]=c},setOpacity:function(a,b){if(b!=null)return b==""&&b!=0?is_ie?a.style.filter="":a.style.opacity="":is_ie?a.style.filter="alpha(opacity="+Math.round(b*100)+")":a.style.opacity=b,b;if(!is_ie)return parseFloat(a.style.opacity);if(/alpha\(opacity=([0-9.])+\)/.test(a.style.opacity))return parseFloat(RegExp.$1)},getClosestParentByTagName:function(a,b){b=b.toLowerCase();while(a&&a.tagName&&a.tagName.toLowerCase()!=b)a=a.parentNode;return a},isInside:function(a,b){try{while(a){if(a===b)return!0;a=a.parentNode}}catch(c){}return!1},getWindowSize:function(){var a,b;return is_gecko?document.documentElement.clientWidth?{x:document.documentElement.clientWidth,y:document.documentElement.clientHeight}:{x:window.innerWidth,y:window.innerHeight}:is_opera?{x:window.innerWidth,y:window.innerHeight}:is_ie?!document.compatMode||document.compatMode=="BackCompat"?{x:document.body.clientWidth,y:document.body.clientHeight}:{x:document.documentElement.clientWidth,y:document.documentElement.clientHeight}:(a=document.createElement("div"),b=a.style,b.position="absolute",b.bottom=b.right="0px",document.body.appendChild(a),b={x:a.offsetLeft,y:a.offsetTop},document.body.removeChild(a),b)},getPos:function(a){var b,c,d,e,f,g,h;if(a.getBoundingClientRect)return b=a.getBoundingClientRect(),{x:b.left-document.documentElement.clientLeft,y:b.top-document.documentElement.clientTop};if(document.getBoxObjectFor){b=a.ownerDocument.getBoxObjectFor(a),c={x:b.x,y:b.y};while(a.parentNode&&a.parentNode!==document.body)a=a.parentNode,c.x-=a.scrollLeft,c.y-=a.scrollTop;return c}return/^body$/i.test(a.tagName)?{x:0,y:0}:(d=0,e=0,f=/^div$/i.test(a.tagName),f&&a.scrollLeft&&(d=a.scrollLeft),f&&a.scrollTop&&(e=a.scrollTop),g={x:a.offsetLeft-d,y:a.offsetTop-e},a.offsetParent&&(h=DynarchDomUtils.getPos(a.offsetParent),g.x+=h.x,g.y+=h.y),g)},getBRPos:function(a){var b=DynarchDomUtils.getPos(a),c=DynarchDomUtils.getOuterSize(a);return b.x+=c.x-1,b.y+=c.y-1,b},setPos:function(a,b,c){typeof b=="number"&&(b+="px"),typeof c=="number"&&(c+="px"),b!=null&&(a.style.left=b),c!=null&&(a.style.top=c)},createElement:function(a,b,c,d,e){var f,g=CE_CACHE[a]||(CE_CACHE[a]=document.createElement(a));g=g.cloneNode(!1);if(b)for(f in b)is_ie?DynarchDomUtils.setStyleProperty(g,f,b[f]):g.style.setProperty(f,b[f],"");if(c)for(f in c)g[f]=c[f];return d&&(typeof e=="number"&&(e=d.childNodes[e]),e||(e=null),d.insertBefore(g,e)),g},setUnselectable:function(a,b){var c;b==null&&(b=!0),is_ie?(b=b?"on":"off",c=Array.$(a.getElementsByTagName("*")),c.push(a),c.foreach(function(a){a.setAttribute("unselectable",b)})):(b=b?"none":"normal",a.style.MozUserSelect=b,a.style.WebkitUserSelect=b,a.style.userSelect=b)},addClass:function(a,b,c){DynarchDomUtils.delClass(a,c,b)},delClass:function(a,b,c){var d,e,f,g;if(a){d=a.className,b instanceof RegExp&&(d=d.replace(b," "),b=null);if(c||b){e=d.split(/\s+/),f=e.length,g={},b&&(g[b]=1),c&&(g[c]=1);while(--f>=0)e[f]in g&&e.splice(f,1);c&&e.push(c),d=e.join(" ")}a.className=d}},condClass:function(a,b,c,d){DynarchDomUtils[b?"addClass":"delClass"](a,c,d)},hasClass:function(a,b){return a.className.split(" ").contains(b)},elementIsVisible:function(a){return!!a.offsetWidth&&a.style.visibility!="hidden"},ie_getBackgroundColor:function(a){var b=document.body.createTextRange();return b.moveToElementText(a),"#"+parseInt(b.queryCommandValue("BackColor")).hex(6)},getStyle:function(a,b){var c=null;return window.getComputedStyle?c=document.defaultView.getComputedStyle(a,"").getPropertyValue(b):a.currentStyle&&(b=b.replace(/-[a-z]/g,function(a){return a.charAt(1).toUpperCase()}),b=="backgroundColor"?c=ie_getBackgroundColor(a):c=a.currentStyle[b]),c},getStylePX:function(a,b){var c=parseInt(DynarchDomUtils.getStyle(a,b),10);return isNaN(c)&&(c=0),c},getBorder:function(a){return{x:a.offsetWidth-a.clientWidth,y:a.offsetHeight-a.clientHeight}},getPadding:function(a){var b=DynarchDomUtils.getStylePX,c=b(a,"padding-left")+b(a,"padding-right"),d=b(a,"padding-top")+b(a,"padding-bottom");return{x:c,y:d}},getPaddingAndBorder:function(a){var b=0,c=0,d=DynarchDomUtils.getStylePX;return b+=d(a,"border-left-width"),b+=d(a,"border-right-width"),c+=d(a,"border-top-width"),c+=d(a,"border-bottom-width"),b+=d(a,"padding-left"),b+=d(a,"padding-right"),c+=d(a,"padding-top"),c+=d(a,"padding-bottom"),{x:b,y:c}},getSelectionRange:function(a){var b,c,d,e,f;return is_ie?(d=document.selection.createRange(),e=d.compareEndPoints("StartToEnd",d)==0,e||d.collapse(!0),f=d.getBookmark(),b=f.charCodeAt(2)-2,d=document.selection.createRange(),e=d.compareEndPoints("StartToEnd",d)==0,e||d.collapse(!1),f=d.getBookmark(),c=f.charCodeAt(2)-2):(b=a.selectionStart,c=a.selectionEnd),{start:b,end:c}},setSelectionRange:function(a,b,c){var d,e;c==null&&(c=b),b>c&&(d=b,b=c,c=d),typeof b=="object"&&(c=b.end,b=b.start),is_ie?(e=a.createTextRange(),e.collapse(!0),e.moveStart("character",b),e.moveEnd("character",c-b),e.select()):a.setSelectionRange(b,c)},setOuterSize:function(a,b,c){var d=DynarchDomUtils.getPaddingAndBorder(a);b!=null&&d.x!=NaN&&(b-=d.x),c!=null&&d.y!=NaN&&(c-=d.y),DynarchDomUtils.setInnerSize(a,b,c)},setInnerSize:function(a,b,c){try{typeof b=="number"&&b!=NaN&&(b=Math.abs(b)+"px"),typeof c=="number"&&c!=NaN&&(c=Math.abs(c)+"px"),b!=null&&b!=NaN&&(!is_ie||b>0)&&(a.style.width=b),c!=null&&c!=NaN&&(!is_ie||c>0)&&(a.style.height=c)}catch(d){}},getOuterSize:function(a){return{x:a.offsetWidth,y:a.offsetHeight}},getInnerSize:function(a){var b=DynarchDomUtils.getOuterSize(a),c=DynarchDomUtils.getPaddingAndBorder(a);return b.x-=c.x,b.y-=c.y,b},importCommonVars:function(){return["var DOM=DynarchDomUtils","AC=DOM.addClass","DC=DOM.delClass","CC=DOM.condClass","CE=DOM.createElement","ID=Dynarch.ID"].join(",")},trash:function(a,b){a&&(b=a.parentNode)&&b.removeChild(a)},strip:function(a){var b=a.parentNode;while(a.firstChild)b.insertBefore(a.firstChild,a);DynarchDomUtils.trash(a)},createFromHtml:function(a){var b=CE_CACHE.CONTAINER;return b.innerHTML=a,b.firstChild},swapNodes:function(a,b){var c=a.parentNode,d=a.nextSibling;b.parentNode.replaceChild(a,b),c.insertBefore(b,d)},scrollIntoView:function(a){var b,c,d,e,f,g,h=a.parentNode;while(h&&(h.scrollHeight==h.clientHeight&&h.scrollWidth==h.clientWidth||/table|tbody/i.test(h.tagName)))h=h.parentNode;if(h&&h!==document.body){b=[],c=h;while(c)b.push(c),c=c.parentNode;d=0,e=0,c=a;while(c&&c!=h){d+=c.offsetTop,e+=c.offsetLeft,c=c.offsetParent;if(b.contains(c)){c!=h&&(d-=h.offsetTop,e-=h.offsetLeft);break}}f=d+a.offsetHeight,g=e+a.offsetWidth,d<h.scrollTop&&(h.scrollTop=d),d>h.scrollTop&&f>h.scrollTop+h.clientHeight&&(h.scrollTop=f-h.clientHeight),e<h.scrollLeft&&(h.scrollLeft=e),e>h.scrollLeft&&g>h.scrollLeft+h.clientWidth&&(h.scrollLeft=g-h.clientWidth)}},flash:function(a,b,c){var d;c||(c=3),d=setInterval(function(){a.style.visibility=c&1?"hidden":"",--c,c<0&&
clearInterval(d)},b||150)},walk:function(a,b){var c;if(!b(a))for(c=a.firstChild;c;c=c.nextSibling)c.nodeType==1&&DynarchDomUtils.walk(c,b)},setDocumentTitle:function(a){document.title=a},setZoom:function(a,b){b="scale("+b+")",a=a.style,DynarchDomUtils.forAllStandards("transform",function(c){a.setProperty(c,b,"")})},forAllStandards:function(a,b){["-moz-","-webkit-","-o-","-ms-",""].foreach(function(c){b(c+a)})},CE_CACHE:CE_CACHE},$=is_gecko?document.getElementById.$(document):function(a){return document.getElementById(a)},DEFINE_CLASS("DlException",null,function(a,b){a.CONSTRUCT=function(a,b){this.error=this.constructor.name,a||(a="*** no error message given ***"),this.message=this.constructor.name+": "+a,b!=null&&(this.code=b)},b.toString=function(){var a=this.message;return this.code&&(a+=" / code: "+this.code),a}}).stopEventBubbling=function(){throw new DlExStopEventBubbling},DEFINE_EXCEPTION("DlExInvalidOperation"),DEFINE_EXCEPTION("DlExAbstractBaseClass"),DEFINE_EXCEPTION("DlExStopEventProcessing"),DEFINE_EXCEPTION("DlExStopFrameEvent"),DEFINE_EXCEPTION("DlExStopEventBubbling"),DEFINE_EXCEPTION("DlDataException"),DEFINE_EXCEPTION("DlSecurityException"),DEFINE_CLASS("DlEventProxy",null,function(a,b){function c(a,b){return a.applyHooks(b,Array.$(arguments,2))}a.CONSTRUCT=function(){this.__eventHooks={},this.__disHooks={},this.registerEvents(this.DEFAULT_EVENTS),this.addEventListener("onDestroy",this.__onDestroy)},b.DEFAULT_EVENTS=["onDestroy"],b.FINISH_OBJECT_DEF=function(){var a=this.constructor.DEFAULT_EVENTS;a&&(this.DEFAULT_EVENTS=this.DEFAULT_EVENTS.concat(a))},b.__onDestroy=function(){["__eventHooks","__disHooks"].foreach(function(a){var b,c;for(b in this[a])c=this[a][b],c&&c.foreach(function(a,b){this[b]=null}),this[a][b]=null;this[a]=null},this)},b.__getEventHooks=function(a,b){var c;if(!this.__eventHooks)throw new DlExStopEventBubbling;return c=this.__eventHooks[a.toLowerCase()],c?(b&&(c=c.slice(0)),c):[]},b.registerEvents=function(a){var b,c=this.__eventHooks,d=0;while(b=a[d++])b=b.toLowerCase(),c[b]||(c[b]=[])},b.condEventListener=function(a){return a=a?this.addEventListener:this.removeEventListener,a.apply(this,Array.$(arguments,1))},b.addEventListener=function(a,b,c,d){var e,f,g;if(a instanceof Array){e=0;while(f=a[e++])this.addEventListener(f,b,c,d)}else if(typeof a=="object")for(e in a)this.addEventListener(e,a[e],b,c);else g=this.__getEventHooks(a),g.remove(b),c==null&&a.toLowerCase()=="ondestroy"&&(c=!0),c?g.unshift(b):g.push(b),d&&d.addEventListener("onDestroy",this.removeEventListener.$(this,a,b));return this},b.listenOnce=function(a,b,c){var d;return c==null&&(c=1),d=function(){--c==0&&this.removeEventListener(a,d),b.apply(this,arguments)},this.addEventListener(a,d)},b.connectEvents=function(a,b,d){var e;typeof b=="string"?(d=b,b=this):d||(d=a);if(a instanceof Array)for(e=0;e<a.length;++e)this.connectEvents(a[e],b,d[e]);else this.addEventListener(a,c.$(null,b,d));return this},b.removeEventListener=function(a,b){var c,d=0;if(a instanceof Array)while(c=a[d++])this.removeEventListener(c,b);else if(typeof a=="object")for(d in a)this.removeEventListener(d,a[d]);else this.__getEventHooks(a).remove(b);return this},b.removeAllListeners=function(a){var b;if(a instanceof Array)a.foreach(this.removeAllListeners,this);else if(typeof a=="object")for(b in a)this.removeAllListeners(b);else this.__getEventHooks(a).length=0;return this},b.disableHooks=function(a){return a instanceof Array?a.r_foreach(this.disableHooks,this):(a=a.toLowerCase(),this.__disHooks[a]=this.__eventHooks[a],this.__eventHooks[a]=[]),this},b.enableHooks=function(a){return a instanceof Array?a.r_foreach(this.enableHooks,this):(a=a.toLowerCase(),this.__eventHooks[a]=this.__disHooks[a],this.__disHooks[a]=null),this},b.callHooks=function(a){var b=arguments.length>1?Array.$(arguments,1):[];return this.applyHooks(a,b)},b.hasHooks=function(a){var b=this.__eventHooks[a.toLowerCase()];return b&&b.length>0},b.withHooks=function(a,b){this.addEventListener.apply(this,a);try{return b()}finally{this.removeEventListener.apply(this,a)}},b.withDisabledHooks=function(a,b){this.disableHooks.apply(this,a);try{return b()}finally{this.enableHooks.apply(this,a)}},b.applyHooks=function(a,b){var c,d,e=[],f=0;try{c=this.__getEventHooks(a,!0);while(d=c[f++])e.push(d.apply(this,b))}catch(g){if(!(g instanceof DlExStopEventProcessing))throw g}return e},b.debug_countHooks=function(){var a,b={};for(a in this.__eventHooks)b[a]=this.__eventHooks[a].length;return b},b.invoke=function(a){var b=Array.$(arguments,1);return function(){this[a].apply(this,b.concat(Array.$(arguments)))}.$(this)},b.destroy=function(){this.destroyed||(this.destroying=!0,this.callHooks("onDestroy"),this.__eventHooks=null,this.destroying=!1,this.destroyed=!0)}}),DEFINE_CLASS("DlEvent",null,function(a,b,c){function j(a,b,d,e){var f,g=b.getObject();switch(b.type){case"click":break;case"mousedown":a._ev_mouseDown=!0,a.applyHooks(b.dl_type,[b]);break;case"mouseup":f=a._ev_mouseDown,a._ev_mouseDown=!1,a.applyHooks(b.dl_type,[b]),f&&a._ev_mouseInside&&b.button===0&&(b=new DlEvent(e),b.dl_type="onClick",this.push([a,b,d,e]));break;case"mouseover":case"mouseout":!d||!c.related(d,e)?(a===g&&(a._ev_mouseInside=b.type=="mouseover"),a.applyHooks(b.dl_type,[b])):(b.dl_type=b.type=="mouseover"?"onMouseOver":"onMouseOut",a.applyHooks(b.dl_type,[b]));break;case"dblclick":if((is_ie||is_opera)&&!a.hasHooks("onDblClick")){b=new DlEvent(e),b.type="click",a.applyHooks(b.dl_type="onClick",[b]);break};default:a.applyHooks(b.dl_type,[b])}e&&b.domStop&&c.stopEvent(e)}function k(){this===d&&(d=null)}function l(){g.r_foreach(Function.invoke)}var d,e,f,g,h=c.createElement,i={mouseover:"onMouseEnter",mouseout:"onMouseLeave",mousedown:"onMouseDown",mouseup:"onMouseUp",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",keydown:"onKeyDown",keyup:"onKeyUp",keypress:"onKeyPress",contextmenu:"onContextMenu",focus:"on_DOM_Focus",blur:"on_DOM_Blur",mousewheel:"onMouseWheel",DOMMouseScroll:"onMouseWheel",textInput:"onTextInput",paste:"onPaste",copy:"onCopy",cut:"onCut"};a.CONSTRUCT=function(b){var c;this.type=b.type,this.dl_type=i[this.type]||this.type,this.ctrlKey=b.ctrlKey,this.which=b.which,this.keyIdentifier=b.keyIdentifier,is_macintosh?(this.altGrKey=b.altKey,this.altKey=b.metaKey):this.altKey=b.altKey,this.shiftKey=b.shiftKey,this.button=b.button,this.focusedWidget=a.focusedWidget();if(is_ie)switch(b.button){case 0:this.button=null;break;case 1:this.button=0;break;case 2:this.button=2;break;case 4:this.button=1}this.type.indexOf("key")==0&&(this.keyCode=b.keyCode,this.charCode="which"in b?b.which:is_ie||is_opera?b.keyCode:b.charCode,this.keyStr=String.fromCharCode(this.charCode)),this.dl_type=="onMouseWheel"&&(b.wheelDelta?c=b.wheelDelta/120:b.detail&&(c=-b.detail/3),this.wheelDelta=c),this.pos={x:b.clientX,y:b.clientY},this.relPos=this.pos;if(is_ie){this.target=b.srcElement;switch(this.type){case"mouseover":this.relatedTarget=b.fromElement;break;case"mouseout":this.relatedTarget=b.toElement}}else try{this.target=b.target,this.target.nodeType==3&&(this.target=this.target.parentNode);if(this.type=="mouseout"||this.type=="mouseover")this.relatedTarget=b.relatedTarget,this.relatedTarget&&this.relatedTarget.nodeType==3&&(this.relatedTarget=this.relatedTarget.parentNode)}catch(d){this.relatedTarget=b.explicitOriginalTarget}},b.computePos=function(a){var b=a?a instanceof DlWidget?a.getElement():a:document.body,d=this.elPos=b?c.getPos(b):{x:0,y:0};return this.relPos={x:this.pos.x-d.x,y:this.pos.y-d.y,elPos:d}},b.getObject=function(a){var b=this.target,c=this.object;if(!c){try{while(b&&!DlWidget.getFromElement(b))b=b.parentNode;c=b?DlWidget.getFromElement(b):null}catch(d){c=null}this.object=c}return a&&(c=c.getParent(a)),c},b.getParentElement=function(a,b){var c;b&&b instanceof DlWidget&&(b=b.getElement());if(b&&c===b)return null;c=this.target;try{while(c&&c.tagName.toLowerCase()!=a){c=c.parentNode;if(b&&c===b)return null}}catch(d){c=null}return c},a.stopEvent=c.stopEvent,d=null,a.fakeBlur=function(){var a,b;if(is_safari&&d.blur)return d.blur();a=c.CE_CACHE.FAKE_FOCUS,a||(a=c.CE_CACHE.FAKE_FOCUS=h("a",null,{href:"#",innerHTML:"test",className:"DYNARCH-FAKE-FOCUS"},document.body)),a.focus(),is_ie&&(b=document.body.createTextRange(),b.moveStart("character",0),b.collapse(!0),b.select()),a.blur(),window.status=""},a.focusedWidget=function(b){var c;if(arguments.length>0&&d!==b){d&&!d.destroyed&&(d._focusable==2?b._focusable<2&&a.fakeBlur():d.blur(),d.removeEventListener("onDestroy",k)),d=b;if(b){b.addEventListener("onDestroy",k),c=b.parent;while(c)c._focusedWidget=b,c=c.parent}}return d},a.checkDisabled=function(a){while(a){if(a.disabled())return!0;a=a.parent}return!1},b.destroy=function(){this.object=this.target=this.relatedTarget=null},b.stopDomEvent=function(){a.stopEvent(a.latestDomEvent)},e=a.GLOBAL_CAPTURES={},f="keydown keyup keypress".hashWords(),a._genericEventHandler=function(b,c){var g,h,i,k,l,m;b||(b=window.event),i=b instanceof a?b:new a(b),c&&(b=c);if(i._failed){a.stopEvent(b);return}a.latestEvent=i,a.latestDomEvent=b,i.pos.x&&i.dl_type!="onMouseWheel"&&(a.latestMouseEvent=i,i.dl_type=="onMouseDown"&&(a.latestMouseDownEvent=i));try{k=e[i.dl_type];if(k)for(l=k.length;--l>=0;)k[l](i);i.type in f&&d?g=d.getElement():g=i.target,m=[],l=0;while(g){h=DlWidget.getFromElement(g);if(h){a.checkDisabled(h)||(m[l++]=[h,i,g,b]);if(h.__noPropEvents&&h.__noPropEvents.test(i.dl_type))break}g=g.parentNode}for(l=0;l<m.length;++l)j.apply(m,m[l])}catch(n){if(!(n instanceof DlExStopEventBubbling))throw n;a.stopEvent(b)}i.destroy()},g=[],a._unloadHandler=l,a.captureGlobals=function(b){var c;for(c in b)a.captureGlobal(c,b[c])},a.releaseGlobals=function(b){var c;for(c in b)a.releaseGlobal(c,b[c])},a.captureGlobal=function(a,b){var c=e[a];c||(c=e[a]=[]),c.push(b)},a.releaseGlobal=function(a,b){var c=e[a];c&&c.remove(b)},a.atUnload=function(a){g.push(a)},c.addEvents(document,["contextmenu","click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove",is_gecko?"DOMMouseScroll":"mousewheel","keydown","keyup","keypress","paste","copy","cut"],a._genericEventHandler),c.addEvent(window,"unload",l)}),DEFINE_CLASS("DlWidget",DlEventProxy,function(a,b,c){function n(){return e||(e=new DlTooltip({})),e}function o(){var b;this.__tooltipActive&&n().hide(),this.__contextMenu instanceof a&&this.__contextMenu.destroy();if(this.parent)try{this.parent.removeWidget(this)}catch(e){}b=this.getElement(),b&&(b._dynarch_object=null,b._dynarch_focusable=null),this._element=null,c.trash(b),d[this.id]&&(d[this.id]=null,delete d[this.id]),b=null,this.__refNodes.r_foreach(function(a,b){this.__refNodes[b]=null,this[a]=null,delete this[a]},this),this.__refNodes=null,this.userData=null,this.__propsUserData=null}function p(){this.__tooltip&&this._popupTooltip()}function q(){n().hide()}function A(a){var b,c;n().cancel(),this._focusable&&!a._justFocusedWidget&&(a._justFocusedWidget=this,this._focusable<2&&this.focus()),a.button==0&&(b=this._dragArgs,b&&!g&&b.startOK(this,a)&&(c=a.getObject(),c&&c.applyHooks("onMouseLeave",[a]),g=!0,b.source=this,b.captures={onMouseMove:r.$(this,b),onMouseUp:t.$(this,b),onMouseOver:u.$(this,b),onMouseOut:v.$(this,b),onMouseEnter:w.$(this,b),onMouseLeave:x.$(this,b),onContextMenu:z.$(this,b),onKeyPress:y.$(this,b)},b.startPos=a.pos,b.startElPos=this.getPos(),DlEvent.captureGlobals(b.captures)))}function B(a){var b,c=this.__contextMenu;typeof c=="function"&&(c=c.call(this,a)),c&&(b=this._getContextMenuPopup(),b.popup({timeout:0,content:c,anchor:c.contextMenuAnchor||this.getElement(),align:c.contextMenuAlign||"mouse",widget:this,onPopup:c.contextMenuOnPopup||null,onHide:c.contextMenuOnHide||null,isContext:!0}),DlException.stopEventBubbling())}var d,e,f,g,h,i=c.createElement,j=c.addClass,k=c.delClass,l=c.condClass,m=Dynarch.ID;a.FIXARGS=function(a){a.focusable==null&&a.tabIndex&&(a.focusable=!0)},a.CONSTRUCT=function(){this.__propsUserData={},this.__refNodes=[];if(!(this._parent==null||this._parent instanceof DlContainer))throw new DlException("Parent must be an instance of DlContainer");this.id=m(this._objectType||"DlWidget"),d[this.id]=this,this.initDOM()},a.DEFAULT_ARGS={userData:["data",null],_parent:["parent",null],_fillParent:["fillParent",null],_tagName:["tagName","div"],_dragArgs:["drag",null],_element:["element",null],_focusable:["focusable",!1],_tabIndex:["tabIndex",0],_accessKey:["accessKey",null],__appendArgs:["appendArgs",window.undefined],__addClassName:["className",""],__disabled:["disabled",!1],__tooltip:["tooltip",null],__contextMenu:["contextMenu",null],__tooltipTimeout:["tooltipTimeout",650],__refCnt:["_refCnt",0],__noPropEvents:["dontBubbleEvents",null]},a.DEFAULT_EVENTS=["onMouseEnter","onMouseLeave","onMouseMove","onMouseDown","onMouseUp","onMouseOver","onMouseOut","onMouseWheel","onClick","onDblClick","onDisabled","onDisplay","onFocus","on_DOM_Focus","onBlur","on_DOM_Blur","onKeyDown","onKeyUp","onKeyPress","onResize","onContextMenu","onTooltipShow","onTooltipHide"],d=a.WIDGETS={},a.getById=function(a){return d[a]},a.getFromElement=function(a){return a._dynarch_object},a.getFromUpElement=function(a){while(a&&!a._dynarch_object)a=a.parentNode;return a&&a._dynarch_object},e=null,a.getTooltip=n,b.getWidgetId=function(){return this.id},b._className=[],b.FINISH_OBJECT_DEF=function(){a.BASE.FINISH_OBJECT_DEF.call(this),this._className=this._className.concat([this._objectType])},f=null,b.getResizeRect=a.getResizeRect=function(){return f||(f=i("div",{display:"none"},{className:"Dl-ResizeRect",innerHTML:"&nbsp;"},document.body)),f},a.debug_countHooks=function(){var a={};return Array.hashKeys(DlWidget.WIDGETS).foreach(function(b){a[b]=DlWidget.WIDGETS[b].debug_countHooks()}),a},b.destroy=function(){this.unref()<=0&&a.BASE.destroy.call(this)},b.__onTooltipShow=function(){this.__tooltipActive=!0,this.callHooks("onTooltipShow")},b.__onTooltipHide=function(){this.__tooltipActive=!1,this.callHooks("onTooltipHide")},b._popupTooltip=function(){n().popup({timeout:this.__tooltipTimeout,content:this.__tooltip,anchor:this.getElement(),align:"mouse",onPopup:this.__onTooltipShow,onHide:this.__onTooltipHide,widget:this})};function r(a,b){var c;!a.dragging&&(Math.abs(b.pos.x-a.startPos.x)>=a.delta||Math.abs(b.pos.y-a.startPos.y)>=a.delta)&&(a.dragging=!0,a.makeElementCopy(this,b),a.applyHooks("onStartDrag",[this,b]),this.addClass(a.draggingClass)),a.dragging&&(c=a.elementCopy,c&&(c.style.left=b.pos.x+5+"px",c.style.top=b.pos.y+5+"px"),a.moving(this,b),DlException.stopEventBubbling())}function s(a,b,c){this.delClass(a.draggingClass),DlEvent.releaseGlobals(a.captures),a.captures=null,g=!1,c||a.doDrop(this,b),a.reset(c)}function t(a,b){var c;b.button==0&&(c=a.dragging&&a.canDrop,s.call(this,a,b,!c))}function u(){DlException.stopEventBubbling()}function v(){DlException.stopEventBubbling()}function w(a,b){var c,d=b.getObject(),e=!1,f=d;while(f){if(f===this){e=!0;break}f=f.parent}c=a.dropOK(this,b,d,e),DlException.stopEventBubbling()}function x(){DlException.stopEventBubbling()}function y(a,b){b.keyCode==DlKeyboard.ESCAPE&&s.call(this,a,b,!0),DlException.stopEventBubbling()}function z(){DlException.stopEventBubbling()}g=!1,b.setData=function(a,b){arguments.length==1?delete this.__propsUserData[a]:this.__propsUserData[a]=b},b.getData=function(a){return this.__propsUserData[a]},b._getDlPopup=function(){var a=this.getParent(DlPopup)||0;return a&&(a=a._level+1),DlPopupMenu.get(a)},b._getContextMenuPopup=b._getDlPopup,h={onDestroy:o,onMouseEnter:p,onMouseLeave:q,onMouseDown:A,onContextMenu:B},b._setListeners=function(){this.addEventListener(h),this.addEventListener(is_ie||is_khtml?"onKeyDown":"onKeyPress",this._handle_focusKeys)},b._handle_focusKeys=function(){},b._check_accessKey=function(a){return this._accessKey&&DlKeyboard.checkKey(a,this._accessKey)},b._handle_accessKey=function(){this.focus()},b._setFocusedStyle=function(a){this.condClass(a,this._className.peek()+"-focus")},b.focus=function(){this._focusable?(DlEvent.focusedWidget(this),this._setFocusedStyle(!0),this.callHooks("onFocus"),this instanceof DlEntry||this.scrollIntoView()):this.parent&&this.parent.focus()},b.blur=function(){this._focusable&&(this.destroyed||(this._setFocusedStyle(!1),this.callHooks("onBlur")))},b.focusInside=function(){var a=DlEvent.focusedWidget();while(a){if(a==this)break;a=a.parent}return!!a},b._createElement=function(a){var b,d,e=this._element;e?this.__alreadyInDom=!0:(b=this.constructor,d=b.__joinedClassName||this._className.join(" "),b.__joinedClassName||(b.__joinedClassName=d),this.__addClassName&&(d+=" "+this.__addClassName),a?(e=c.createFromHtml(a),e.className=d):e=i(this._tagName,null,{className:d}),this._focusable&&(e._dynarch_focusable=!0),this._element=e),e._dynarch_object=this},b.getElement=function(){return this._element},b.getParentNode=function(){return this._element.parentNode},b.getDOMChildren=function(){return Array.$(this.getContentElement().childNodes)},b.getContentElement=function(){return this.getElement()},b.setStyle=function(a,b){var c,d=this.getElement().style;if(arguments.length>1)d[a]=b;else for(c in a)this.setStyle(c,a[c])},b.setContent=function(b){var c=this.getContentElement();while(c.firstChild)c.removeChild(c.lastChild);if(typeof b=="string")c.innerHTML=b;else{if(b instanceof Function)return this.setContent(b.call(this));b instanceof a?this.appendWidget(b,this.__appendArgs):b instanceof Array?c.innerHTML=b.join(""):b!=null&&c.appendChild(b)}return b!=null},b.ref=function(){return this.__refCnt++},b.unref=function(){return--this.__refCnt},b.refCnt=function(){return this.__refCnt},b.setContextMenu=function(b){this.__contextMenu instanceof a&&this.__contextMenu.destroy(),b instanceof a&&b.ref(),this.__contextMenu=b},b.setTooltip=function(a){this.__tooltip=a},b.initDOM=function(){return this._setListeners(),this._createElement(),this._parent&&(this._parent.appendWidget(this,this.__appendArgs),this._parent=null),this.__disabled&&this.disabled(!0,!0),this.__onTooltipShow=this.__onTooltipShow.$(this),this.__onTooltipHide=this.__onTooltipHide.$(this),this},b.setUnselectable=function(a,b){a==null&&(a=this.getElement()),c.setUnselectable(a,b)},b.disabled=function(a,b){return a!=null&&(b||a!=this.__disabled)&&(this.__disabled=a,this.condClass(a,"DlWidget-disabled"),this.condClass(a,this._className.peek()+"-disabled"),this.applyHooks("onDisabled",[a])),this.__disabled},b.enabled=function(a,b){return a!=null&&this.disabled(!a,b),!this.__disabled},b.getParent=function(a,b){var c;if(a==null)return this.parent;c=this,b&&(c=this.parent);while(c&&!(c instanceof a))c=c.parent;return c},b.findParent=function(a,b){var c,d,e=this;b&&(e=this.parent);if(a instanceof Function)while(e&&!a(e))e=e.parent;else{d=Array.$(arguments,2);while(e){c=e[a];if(c){if(!(c instanceof Function))break;if(c.apply(e,d))break}e=e.parent}}return e},b.getPos=function(){return c.getPos(this.getElement())},b.getBRPos=function(){return c.getBRPos(this.getElement())},b.getOffsetPos=function(){var a=this.getElement();return{x:a.offsetLeft,y:a.offsetTop}},b.setPos=function(a,b){var c=this.getElement();a!=null&&typeof a=="object"&&(b=a.y,a=a.x),a!=null&&(c.style.left=a+"px"),b!=null&&(c.style.top=b+"px")},b.setSize=b.setOuterSize=function(a){c.setOuterSize(this.getElement(),a.x,a.y),this.callHooks("onResize")},b.setInnerSize=function(a){c.setInnerSize(this.getContentElement(),a.x,a.y),this.callHooks("onResize")},b.getSize=b.getOuterSize=function(){return c.getOuterSize(this.getElement())},b.getInnerSize=function(){return c.getInnerSize(this.getContentElement())},b.display=function(a){var b=this.getElement().style;return a!=null?(b.display=a?"":"none",this.applyHooks("onDisplay",[a,b.display,"display"]),a):b.display!="none"},b.visibility=function(a){var b=this.getElement().style;return a!=null?(b.visibility=a?"":"hidden",this.applyHooks("onDisplay",[a,b.visibility,"visibility"]),a):b.visible!="hidden"},b.opacity=function(a){return c.setOpacity(this.getElement(),a)},b.position=function(a){var b=this.getElement().style,c=b.position;return a!=null&&(b.position=a),c},b.setIconClass=function(a){var b=this.getContentElement();l(b,a!=null,this.__withIconClass||this._className.peek()+"-withIcon"),this.iconClass&&k(b,this.iconClass),a&&j(b,a),this.iconClass=a},b.addClass=function(a,b){j(this.getElement(),a,b)},b.delClass=function(a,b){k(this.getElement(),a,b)},b.condClass=function(a,b,c){return l(this.getElement(),a,b,c),a},b.zIndex=function(a){var b=this.getElement();return a!=null?(b.style.zIndex=a,a):b.style.zIndex?parseInt(b.style.zIndex,10):0},b.refNode=function(a,b){return this[a]=b,this.__refNodes.remove(a),b!=null&&this.__refNodes.push(a),b},b.debug_highlight=function(a){this.getElement().style.backgroundColor=a||"yellow"},b.getQuickPopup=function(){var a=this.getParent(DlPopup)||0;return a&&(a=a._level+1),DlDialogPopup.get(a)},b.quickPopup=function(a){var b=this.getQuickPopup();a=Object.makeCopy(a),Object.mergeUndefined(a,{anchor:this.getElement(),align:{prefer:"CC"}}),b.popup(a)},b.getScroll=function(){var a=this.getElement();return{x:a.scrollLeft,y:a.scrollTop}},b.scrollIntoView=function(){c.scrollIntoView(this.getElement())},b.flash=function(a,b){c.flash(this.getElement(),a,b)},DlEvent.atUnload(function(){var a,b,c;do{window.DL_CLOSING=!0,a=!1;for(b in d){a=!0,c=d[b];try{d[b]=null,delete d[b],c.destroy()}catch(e){}break}}while(a);d=null})}),DEFINE_CLASS("DlContainer",DlWidget,function(a,b){function d(a,b){return a=a?Array.$(a.getElement().getElementsByTagName("*")):[],Array.$(this.getElement().getElementsByTagName("*")).grep(b?"_dynarch_object":"_dynarch_focusable").grep(DynarchDomUtils.elementIsVisible).grep(a.contains.$(a).inverse()).map(DlWidget.getFromElement).grep("enabled").mergeSort(function(a,b){return a._tabIndex-b._tabIndex})}function e(a,b){var c=d.call(this,a),e=c.find(a);e=c.rotateIndex(e+b);if(e!=null)return c[e]}var c;a.BEFORE_BASE=function(){this._widgets=[]},a.DEFAULT_ARGS={_scrollBars:["scroll",!1],__noParentKeyBindings:["noParentKB",!1]},b._createElement=function(){a.BASE._createElement.apply(this,arguments),this._scrollBars&&this.setStyle("overflow","auto")},b.appendWidget=function(a){a.parent&&a.parent.removeWidget(a),this._widgets.push(a),a.parent=this,a.__alreadyInDom||this._appendWidgetElement.apply(this,arguments),delete a.__alreadyInDom},b._appendWidgetElement=function(a,b){var c,d=a.getElement();if(typeof b=="number"){c=this.getContentElement();try{b=c.childNodes[b],c.insertBefore(d,b)}catch(e){c.appendChild(d)}}else b==null?b=this.getContentElement():typeof b=="string"&&(b=document.getElementById(b)),d.parentNode!==b&&b.appendChild(d)},b.removeWidget=function(a){a.parent===this&&(this._removeWidgetElement(a),this._widgets.remove(a),a.parent=null)},b._removeWidgetElement=function(a){var b;this._widgets.contains(a)&&(b=a.getElement(),b.parentNode&&b.parentNode.removeChild(b))},b.destroyChildWidgets=function(){var b,c,d=Array.$(this._widgets);for(b=0;b<d.length;++b)d[b]instanceof a&&d.push.apply(d,d[b]._widgets);return d.r_foreach(function(a){try{a.destroy()}catch(b){}}),c=this.getContentElement(),c&&(c.innerHTML=""),c},b._setListeners=function(){a.BASE._setListeners.call(this),this.addEventListener("onDestroy",this.destroyChildWidgets),this.addEventListener("onResize",this.__doLayout)},b.disabled=function(b,c){var d=a.BASE.disabled.call(this,b,c);return b!=null&&this._widgets.r_foreach(function(a){a.disabled(b,c)}),d},b.children=function(a){return a!=null?this._widgets[a]:this._widgets},b.__doLayout=function(){var a=this.children().grep_first(function(a){return a._fillParent});a&&a.setSize(this.getInnerSize())},b.getNextFocusWidget=function(a){return e.call(this,a,1)},b.getPrevFocusWidget=function(a){return e.call(this,a,-1)},b.getFirstFocusWidget=function(){return this.getNextFocusWidget(null)},b.getLastFocusWidget=function(){return this.getPrevFocusWidget(null)},b._handleKeybinding=function(a,b){var c;if(a.altKey||a.ctrlKey)c=d.call(this,b,!0),c.foreach(function(b){if(b._check_accessKey(a))throw b._handle_accessKey(a),a.domStop=!0,new DlExStopEventBubbling}),this.parent&&!this.__noParentKeyBindings&&this.parent._handleKeybinding(a,this)},a.getHiddenContainer=function(){return c||(c=new this({className:"DlContainer-Hidden"}),document.body.appendChild(c.getElement())),c}}),DEFINE_CLASS("DlRadioGroup",DlEventProxy,function(a,b){function d(){c[this.id]&&(this._buttons=null,this._buttonsById=null,this._buttonsByValue=null,this._history=null,delete c[this.id])}function e(a){var b;if(a!=null){this._changed=!0;if(a.checked()){if(this._maxChecked!=null)while(this._history.length>=this._maxChecked)b=this._history[0],b.checked(!1,!0),this._history.splice(0,1);this._history.push(a)}else{if(this._minChecked!=null&&this._history.length<=this._minChecked)throw a.checked(!0,!0),new DlExStopEventProcessing;this._history.remove(a)}}}var c;a.CONSTRUCT=function(a){a!=null&&(this._maxChecked=1,this._minChecked=null,this.id=a,this.reset(),this.addEventListener("onDestroy",d))},c={},a.DEFAULT_EVENTS=["onChange"],a.getById=a.get=function(a){var b;return a||(a=Dynarch.ID("group")),b=c[a],b||(b=c[a]=new this(a)),b},b.reset=function(){this._buttons&&this._buttons.r_foreach(function(a){a.__group=a.__groupId=null}),this._changed=!1,this._buttons=[],this._buttonsById={},this._buttonsByValue={},this._history=[],this.removeAllListeners("onChange"),this.addEventListener("onChange",e)},b.changed=function(a){var b=this._changed;return a!=null&&(this._changed=a),b},b.getSelected=function(){return this._history},b.getButtons=function(){return this._buttons},b.getNextButton=function(a){var b,c;a==null&&(a=this.getSelected()[0]),b=this._buttons,c=b.nullLimitIndex(b.find(a)+1);if(c!=null)return b[c]},b.getPrevButton=function(a){var b,c;a==null&&(a=this.getSelected()[0]),b=this._buttons,c=b.nullLimitIndex(b.find(a)-1);if(c!=null)return b[c]},b.getValue=function(){return this._history.map("value")},b.setValue=function(a,b){var c,d=this._buttonsByValue;a instanceof Array||(a=[a]),a=a.toHash(!0),this._history=[];for(c in d)d[c].checked(a[c],!0),a[c]&&this._history.push(d[c]);b&&this.callHooks("onChange")},b.getByValue=function(a){return this._buttonsByValue[a]},b.addWidget=function(a,b){var c;this._buttonsById[a.id]||(b==null&&(b=this._buttons.length),this._buttonsById[a.id]=a,this._buttons.splice(b,0,a),a.checked()&&this._history.push(a),c=a.value(),typeof c!="undefined"&&(this._buttonsByValue[c]=a),a.addEventListener("onDestroy",this.removeWidget.$(this,a)))},b.removeWidget=function(a){var b;this._buttonsById[a.id]&&(this._changed=!0,delete this._buttonsById[a.id],b=a.value(),typeof b!="undefined"&&delete this._buttonsByValue[a.value()],this._buttons.remove(a),this._history.length!=this._history.remove(a).length&&this.callHooks("onChange"))},b.minChecked=function(a){return arguments.length>0&&(this._minChecked=a),this._minChecked},b.maxChecked=function(a){return arguments.length>0&&(this._maxChecked=a),this._maxChecked},b.checkAll=function(a,b){a==null&&(a=!0),b==null&&(b=!1),this._buttons.foreach(function(c){c.checked(a,!b)}),this._history=a?Array.$(this._buttons):[]},b.unCheckAll=function(){this._history.r_foreach(function(a){a.checked(!1)})}}),DEFINE_CLASS("DlAbstractButton",DlWidget,function(a,b){var c=["onMouseEnter","onMouseLeave","onMouseDown","onMouseUp","onUpdateLabel","onClick","onCheck","onChange","onDisabled"],d={STANDARD:1,TWOSTATE:2};a.DEFAULT_ARGS={_label:["label",""],_classes:["classes",{}],_checked:["checked",!1],__groupId:["group",null],_btnType:["type",d.STANDARD],_value:["value",window.undefined],_noCapture:["noCapture",!1],_alwaysCheck:["alwaysCheck",!1]},a.CONSTRUCT=function(a){var b,c=this.__groupId;c!=null&&(typeof c=="object"?(b=c,this.__groupId=b.id):b=DlRadioGroup.get(c),this.__group=b,b.addWidget(this,typeof a.appendArgs=="number"?a.appendArgs:null)),this._noCapture||(this._btnpressCapture={onMouseMove:DlException.stopEventBubbling,onMouseUp:this._cap_onMouseUp.$(this),onMouseOver:DlException.stopEventBubbling,onMouseOut:DlException.stopEventBubbling,onMouseEnter:this._cap_onMouseEnter.$(this),onMouseLeave:this._cap_onMouseLeave.$(this)})},a.DEFAULT_EVENTS=["onCheck","onUncheck","onChange","onUpdateLabel"],b._cap_onMouseUp=function(a){var b=a.getObject();DlEvent.releaseGlobals(this._btnpressCapture),this.applyHooks("onMouseUp",[a]),this._ev_mouseInside||this.applyHooks("onMouseLeave",[a]),b!==this&&(b&&b.applyHooks("onMouseEnter",[a]),DlException.stopEventBubbling())},b._cap_onMouseEnter=function(a){var b=a.getObject();b===this&&this.addClass(this._classes.active),b&&(b._ev_mouseInside=!0),DlException.stopEventBubbling()},b._cap_onMouseLeave=function(a){var b=a.getObject();b===this&&this.delClass(this._classes.active),b&&(b._ev_mouseInside=!1),DlException.stopEventBubbling()},a.TYPE=d,b._onMouseEnter=function(){this.addClass(this._classes.hover)},b._onMouseLeave=function(){this.delClass(this._classes.hover),this.delClass(this._classes.active)},b._onMouseDown=function(a){a.button===0&&(this._ev_mouseInside=!0,this.addClass(this._classes.hover),this.addClass(this._classes.active),this._noCapture||(DlEvent.captureGlobals(this._btnpressCapture),a.domStop=!0))},b._onMouseUp=function(){this.delClass(this._classes.active)},b._onUpdateLabel=function(){this.condClass(!this._label||!/\S/.test(this._label),this._classes.empty)},b._onClick=function(){this._btnType==d.TWOSTATE&&(this._alwaysCheck?this.checked(!0):this.toggle())},b.keyClicked=function(a){this.addClass(this._classes.active),function(){this.delClass(this._classes.hover),this.delClass(this._classes.active),this.applyHooks("onClick",[a])}.delayed(90,this),a&&(a.domStop=!0,DlException.stopEventBubbling())},b._handle_focusKeys=function(b){var c,d,e=b.keyCode;e==DlKeyboard.ENTER||b.charCode==DlKeyboard.SPACE?this.keyClicked(b):!this._customMoveKeys&&this.__group&&e in DlKeyboard.KEYS_MOVE&&(c=e in DlKeyboard.KEYS_MOVE_PREV,d=c?this.__group.getPrevButton(this):this.__group.getNextButton(this),d&&(d.focus(),b.shiftKey&&(this.checked(!0),d.checked(!0)),b.domStop=!0,DlException.stopEventBubbling())),a.BASE._handle_focusKeys.call(this,b)},b._handle_accessKey=function(a){this.focus(),this.keyClicked(a)},b.disabled=function(b,c){return b!=null&&b&&(this.delClass(this._classes.hover),this.delClass(this._classes.active)),a.BASE.disabled.call(this,b,c)},b._onChange=function(){this.__group!=null&&this.__group.applyHooks("onChange",[this])},b._onCheck=Function.noop,b._onDisabled=function(a){this.condClass(a,this._classes.disabled),a&&this._capture&&(DlEvent.releaseCapture(this._capture),this._capture=null)},b._createElement=function(){a.BASE._createElement.call(this),this._createLabelElement(),this.label(this._label,!0),this._updateState(),this.setUnselectable()},b._setListeners=function(){a.BASE._setListeners.call(this),c.r_foreach(function(a){this.addEventListener(a,this["_"+a])},this)},b._createLabelElement=Function.noop,b.label=function(a,b){if(b||arguments.length>0&&a!==this._label)this._label=a,a&&(a="<div class='DlButton-Label'>"+this._label+"</div>"),this.setContent(a),this.applyHooks("onUpdateLabel",[this._label]);return this._label},b.setLabel=b.label,b.getLabel=b.label,b.group=function(){return this.__group},b._checkTwoState=function(a){var b=this._btnType!=d.TWOSTATE;if(b&&!a)throw new DlExInvalidOperation("This operation is only available for a TWOSTATE button");return!b},b._updateState=function(){var a;this._checkTwoState(!0)&&(a=this._classes,this.condClass(this._checked,a.checked,a.unchecked))},b.checked=function(a,b){var c;return this._checkTwoState(),arguments.length>0&&(a=!!a,c=!b&&this._checked!==a,this._checked=a,this._updateState(),c&&(this.callHooks("onChange"),this.callHooks(a?"onCheck":"onUncheck"))),this._checked},b.toggle=function(a){this._checkTwoState(),this.checked(!this._checked,a)},b.value=function(a){var b=this._value;return arguments.length>0&&(this._value=a),b},b.setValue=b.value,b.getValue=b.value}),DEFINE_CLASS("DlAnimation",DlEventProxy,function(a,b){function l(){this.t=this.i/this.length;try{this.applyHooks("onUpdate",[this.t]),++this.i>this.length&&this.stop(!0)}catch(a){throw this.stop(),a}}var c,d,e,f,g,h,i,j,k;a.DEFAULT_EVENTS=["onStart","onStop","onPause","onUpdate"],a.CONSTRUCT=function(a,b){this.addEventListener("onDestroy",this.stop.$(this)),a!=null&&(this.length=a),b!=null&&(this._speed=1e3/b),this._update=l.$(this)},b.start=function(a,b,c){this.stop(),a!=null&&(this.length=a),b!=null&&(this._speed=1e3/b),c!=null&&(c instanceof Function||(c=DlAnimation.easing[c]),this.func=c),this.t=0,this.i=0,this.callHooks("onStart"),this._timer=setInterval(this._update,this._speed)},b.running=function(){return this._timer},b.stop=function(a){this._timer&&(clearInterval(this._timer),this._timer=null,this.applyHooks("onStop"
,[a]))},b.getPos=function(a){return a==null&&(a=this.func),a.call(this,this.t)},c=Math.PI,d=Math.abs,e=Math.asin,f=Math.pow,g=Math.sin,h=Math.cos,i=Math.exp,j=Math.round,k=a.easing={elastic_b:function(a){return 1-h(-a*5.5*c)/f(2,7*a)},elastic_b_custom:function(a,b,d){return a+=.5,1-h(-d*a*c)/f(2,b*d)},magnetic:function(a){return 1-h(a*a*a*10.5*c)/i(4*a)},accel_b:function(a){return a=1-a,1-a*a*a},accel_a:function(a){return a*a*a},accel_ab:function(a){return a=1-a,1-g(a*a*a*c/2)},bounce_b:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},shake:function(a){return a<.5?-h(a*11*c)*a*a:(a=1-a,h(a*11*c)*a*a)}}}),DEFINE_CLASS("DlBox",DlContainer,function(a,b,c){a.DEFAULT_ARGS={_borderSpacing:["borderSpacing",0],_align:["align",null],_tagName:["tagName","table"]},b._createElement=function(){var b;a.BASE._createElement.call(this),b=this.getElement(),b.cellSpacing=this._borderSpacing,b.cellPadding=0,this._align&&(b.align=this._align),this.refNode("_tbody",c.createElement("tbody",null,null,b))},b.getTableElement=b.getElement,b._appendWidgetElement=function(a,b){b==null?this.createCellElement().appendChild(a.getElement()):b.appendChild(a.getElement())},b.destroyChildWidgets=function(){var a=Array.$(this._widgets);a.r_foreach(function(a){try{a.destroy()}catch(b){}})},b.__addSep=function(a,b,d){var e;return d||(d=this.createCellElement()),d.separator=!0,e=this._objectType+"-"+a,b&&(e+=" "+b),d.className=e,d.innerHTML="<div class='"+e+"'>&nbsp;</div>",c.setUnselectable(d),d},b.addSeparator=function(a,b){return this.__addSep("separator",a,b)},b.addSpace=function(a,b){return this.__addSep("spacer",a,b)}}),DEFINE_CLASS("DlButton",DlAbstractButton,function(a,b,c){a.CONSTRUCT=function(){this.setIconClass(this._iconClass),this._iconClass=null},a.TYPE=DlAbstractButton.TYPE,a.DEFAULT_ARGS={_classes:["classes",{active:"DlButton-active",hover:"DlButton-hover",checked:"DlButton-1",unchecked:"DlButton-0",empty:"DlButton-empty",disabled:"DlButton-disabled"}],_iconClass:["iconClass",null]},b.__withIconClass="DlButton-withIcon",b._createElement=function(){a.BASE._createElement.call(this),this.addClass("DlWidget-3D")},b._createLabelElement=function(){this.getElement().innerHTML="<div class='DlButton-inner'><div></div></div>"},b.getContentElement=function(){return this.getElement().firstChild.firstChild},b.setSize=b.setOuterSize=function(a){var b=c.getPaddingAndBorder(this.getElement());a.x!=null&&(a.x-=b.x),a.y!=null&&(a.y-=b.y),b=c.getPaddingAndBorder(this.getElement().firstChild),a.x!=null&&(a.x-=b.x),a.y!=null&&(a.y-=b.y),c.setOuterSize(this.getContentElement(),a.x,a.y)}}),DEFINE_CLASS("DlHbox",DlBox,function(a,b,c){var d=c.createElement;b._createElement=function(){a.BASE._createElement.call(this),this.refNode("_row",d("tr",null,null,this._tbody))},b.createCellElement=function(a){var b=d("td",null,{className:"cell"});return a!=null?this._row.insertBefore(b,a):this._row.appendChild(b),b},b._removeWidgetElement=function(a){var b;this._widgets.contains(a)&&(b=a.getElement(),b.parentNode.parentNode.removeChild(b.parentNode))},b.addFiller=function(){var a=this.createCellElement();a.className+=" DlHbox-filler",this.addClass("DlHbox-hasFiller")},b.setAlign=function(a,b){var c=this.getElement();switch(a){case"left":c.style.marginLeft="0",c.style.marginRight="auto";break;case"center":c.style.marginLeft="auto",c.style.marginRight="auto";break;case"right":c.style.marginLeft="auto",c.style.marginRight="0";break;default:c.style.marginLeft=a!=null?a:"auto",c.style.marginRight=b!=null?b:"auto"}},b.setEqualWidths=function(a){var b=this.children().max(function(a){return a.getSize().x});a&&(b+=a),this.children().r_foreach(function(a){a.setSize({x:b})})}}),DlPoint.prototype={clone:function(){return new DlPoint(this.x,this.y)},normalize:function(a){var b;return this.x>a.x&&(b=this.x,this.x=a.x,a.x=b),this.y>a.y&&(b=this.y,this.y=a.y,a.y=b),this},distanceTo:function(a){var b=Math.abs(a.x-this.x),c=Math.abs(a.y-this.y);return Math.sqrt(b*b+c*c)}},DlRect.prototype={setFromRect:function(a){return this.x=a.x,this.y=a.y,this.w=a.w,this.h=a.h,this},setFromPoints:function(a,b){return a=a.clone().normalize(b=b.clone()),this.x=a.x,this.y=a.y,this.w=b.x-a.x+1,this.h=b.y-a.y+1,this},setFromValues:function(a,b,c,d){return this.x=a,this.y=b,this.w=c,this.h=d,this},getTL:function(){return new DlPoint(this.x,this.y)},getBR:function(){return new DlPoint(this.x+this.w-1,this.y+this.h-1)},getPoints:function(){return[getTL(),getBR()]},height:function(a){return a!=null&&(this.h=a),this.h},width:function(a){return a!=null&&(this.w=a),this.w},containsPoint:function(a){return this.x<=a.x&&this.x+this.w>a.x&&this.y<=a.y&&this.y+this.h>a.y},intersect:function(a){var b=null,c=Math,d=c.max(this.x,a.x),e=c.max(this.y,a.y),f=c.min(this.x+this.w,a.x+a.w)-d,g=c.min(this.y+this.h,a.y+a.h)-e;return f>0&&g>0&&(b=new DlRect(d,e,f,g)),b},area:function(){return this.w*this.h},makeDiv:function(a,b){var c;return b||(b="#000"),a==null&&(a=0),c={position:"absolute",left:this.x+"px",top:this.y+"px",width:this.w-a*2+"px",height:this.h-a*2+"px",overflow:"hidden",lineHeight:"1px",fontSize:"1px",border:a+"px solid "+b},c=DynarchDomUtils.createElement("div",c,{innerHTML:"&nbsp;"}),c},positionDiv:function(a){a.style.left=this.x+"px",a.style.top=this.y+"px",a.style.height=this.h+"px",a.style.width=this.w+"px"},toString:function(){return this.w+"x"+this.h+"@"+this.x+","+this.y}},DEFINE_CLASS("DlPopup",DlContainer,function(a,b,c){function m(a){this.getScrollDiv().scrollTop+=this._scrollStep*a,this._scrollSetArrowState()}function n(a,b){a._scrollStep=a._oscroll.step1,a._scrollTimer=setInterval(m.$(a,b),a._oscroll.speed),f(this,"DlPopup-scroll-hover"),h(this,b>0,"DlPopup-scrollDown-hover","DlPopup-scrollUp-hover")}function o(){i[this._objectType][this._level]=this;if(!this._autolink||this._level==0)k[this.id]=this}function p(){var a=i[this._objectType],b=a[this._level+1];b&&b.hide(),a.splice(this._level,1),k[this.id]&&delete k[this.id]}function q(a){var b,c;this.args.scrollVisible&&(b=this.getScrollDiv(),c=b.scrollTop,a.wheelDelta<0?c+=20:(c-=20,c<0&&(c=0)),b.scrollTop=c,a.domStop=!0,DlException.stopEventBubbling())}function r(b){var c=b.getObject(),d={};while(c&&!(c instanceof a))c.currentPopup&&(d[c.currentPopup.id]=!0),c=c.parent;if(c)while(c!=null)d[c.id]=!0,c=c._parentPopup;a.clearAllPopups(d)}function s(a){a.onBeforePopup&&a.onBeforePopup.call(this,a),this._timer=null;if(!this.setContent(a.content))return;a.onPopup&&a.onPopup.call(this,a),this.applyHooks("onPopup",[a]),this.showAt(a.anchor,a.align||this._align,a.pos,a.shift,a.fluid),this._prevFocus=DlEvent.focusedWidget(),this.focus()}function t(){if(this.visible){this.args&&this.args.onHide&&this.args.onHide.call(this,this.args);if(this._focusable&&this._prevFocus)try{this._prevFocus.focus()}catch(a){}this.args=null,this._timer=null,this.callHooks("onHide"),this.display(!1),this.visible=!1}}var d,e=c.createElement,f=c.addClass,g=c.delClass,h=c.condClass,i={},j={},k={},l=/DlPopup-scroll(Up|Down)?-hover/g;a.BEFORE_BASE=function(){this._hasScrolling=!1,this.visible=!1},a.DEFAULT_EVENTS=["onPopup","onHide"],a.DEFAULT_ARGS={_level:["level",0],_autolink:["autolink",!0],_oscroll:["scroll",{step1:5,step2:10,speed:40}],_align:["align",null],_zIndex:["zIndex",1e3],_focusable:["focusable",!0]},b.FINISH_OBJECT_DEF=function(){a.BASE.FINISH_OBJECT_DEF.call(this),this.constructor.get=a.get,this.constructor.clearAll=a.clearAll,i[this._objectType]=[],j[this._objectType]={}},a.get=function(a,b){var c,d,e=this.prototype._objectType,f=!1,g=i[e].length;if(a==null||a>=g)a=g,f=!0;return c=j[e],j[e]||(c=j[e]={}),d=c[a],d||(b?d=null:d=c[a]=new this({level:a})),d.detachPopup(),f&&a>0&&d.attachToPopup(i[e].peek()),d},a.clearAll=function(a){var b=i[this.prototype._objectType];b=b[a||0],b&&b.hide()},a.clearAllPopups=function(a){var b;for(b in k)(!a||!a[b])&&k[b].hide()},b._createElement=function(){var b,c=this._parent;this._parent=null,a.BASE._createElement.call(this),b=this.getElement(),this.parent=c,this.display(!1),document.body.appendChild(b),is_gecko&&(b=e("div",null,{className:"Gecko-Bug-302380"},b)),this.refNode("_contentEl",e("div",null,{className:"DlPopup-scrollArea"},b)),this.zIndex(this._zIndex)},b.getContentElement=function(){return this._contentEl},b.getScrollDiv=b.getContentElement,b._scrollSetArrowState=function(){var a=this.getScrollDiv(),b=this._scroll_el(0),c=this._scroll_el(1),d=a.scrollTop==0,e=a.scrollTop+a.offsetHeight==a.scrollHeight;(d||e)&&this._scrollStopHandler(),h(b,d,"DlPopup-scrollUp-disabled"),h(c,e,"DlPopup-scrollDown-disabled")},b._scrollStopHandler=function(){this._scrollTimer&&(clearInterval(this._scrollTimer),this._scrollTimer=null,this._scrollSetArrowState()),g(this._scroll_el(0),l),g(this._scroll_el(1),l)},b._scrollDoubleSpeed=function(a){return this._scrollStep=this._oscroll[a?"step2":"step1"],!1},b._scroll_setup=function(){var a,b,c;this._hasScrolling||(this._hasScrolling=!0,a=this.getElement(),b=e("div",null,{className:"DlPopup-scrollUp"},a,0),c=e("div",null,{className:"DlPopup-scrollDown"},a),b.onmouseover=n.$(null,this,-1),c.onmouseover=n.$(null,this,1),b.onmouseout=c.onmouseout=this._scrollStopHandler.$(this),b.onmousedown=c.onmousedown=this._scrollDoubleSpeed.$(this,!0),b.onmouseup=c.onmouseup=this._scrollDoubleSpeed.$(this,!1),this.refNode("_scrollEl0",b),this.refNode("_scrollEl1",c),this.getScrollDiv().onscroll=this._scrollSetArrowState.$(this)),this._scroll_visibile(!0)},b._scroll_el=function(a){return this["_scrollEl"+a]},b._scroll_visibile=function(a){this._hasScrolling&&(is_gecko&&(this.getScrollDiv().parentNode.style.overflow=a?"auto":""),a=a?"":"none",this._scroll_el(0).style.display=a,this._scroll_el(1).style.display=a,this.args.scrollVisible=!a)},d=!1,b._setListeners=function(){a.BASE._setListeners.call(this),this.addEventListener({onPopup:o,onMouseWheel:q,onHide:p}),d||(d=!0,DlEvent.captureGlobal("onMouseDown",r))},b.popup=function(a){this.args=a,this.cancel(),a.timeout?this._timer=s.$(this,a).delayed(a.timeout):s.call(this,a)},b.hide=function(a){this.cancel(),a?this._timer=t.$(this).delayed(a):t.call(this)},b.cancel=function(){this._timer&&(clearTimeout(this._timer),this._timer=null)},b.correctPos=Function.noop,b.reposition=function(){this.visible&&this.showAt(this.args.anchor,this.args.align||this._align,this.args.pos,this.args.shift,this.args.fluid)},b.showAt=function(a,b,d,e,f){var g,h,i,j,k,l,m,n,o,p,q=this.getScrollDiv();b||(b=this._align),b=="mouse"?(d==null&&(d=Object.makeCopy(DlEvent.latestMouseEvent.pos)),g=d,this._mouseDiff&&(g.x+=this._mouseDiff.x,g.y+=this._mouseDiff.y),b={prefer:"__",fallX1:"_R",fallX2:"_L",fallY1:"B_",fallY2:"T_"}):(g=c.getPos(a),e&&(e.x&&(g.x+=e.x),e.y&&(g.y+=e.y))),i=c.getOuterSize(a),h=Object.makeCopy(g),this.visibility(!1),q.style.height="",this._scroll_visibile(!1),this.setPos(-3e4,-3e4),this.display(!0),is_ie&&(this.getElement().style.width=""),j=this._bestPosition(b,h,i),k=j.height(),l=this.getScrollDiv().offsetHeight,m=this.getElement().offsetHeight-l,h=j.getTL(),k<l&&(f?this.children(0).setSize({y:k}):(is_ie&&(this.getElement().style.width=q.offsetWidth+"px"),this._scroll_setup(),n=this._scroll_el(0).offsetHeight,o=this._scroll_el(1).offsetHeight,q.style.height=k-n-o-m+"px",this._scrollSetArrowState(),q.scrollTop=0)),this.correctPos(h),this.setPos(h.x,h.y),this._parentPopup&&(p=this._parentPopup.zIndex()+1,this.zIndex(p)),this.visibility(!0),this.visible=!0},b._bestPosition=function(a,b,d){var e,f,g,h,i,j,k,l=c.getWindowSize(),m=new DlRect(0,0,l.x,l.y),n=new DlPoint(b);return l=this.getSize(),this._doAlign(a.prefer,n,d),e=(new DlRect(n,l)).intersect(m),f=this.checkXPos(n,m),g=this.checkYPos(n,m),f==0&&g==0?e:(f!=0&&(n.x=b.x,this._doAlign(a.fallX1,n,d),h=(new DlRect(n,l)).intersect(m),n.x=b.x,this._doAlign(a.fallX2,n,d),i=(new DlRect(n,l)).intersect(m),h&&i?n=h.area()>i.area()?h.getTL():i.getTL():h?n=h.getTL():i&&(n=i.getTL()),this.args.fallX=!0),g!=0&&(n.y=b.y,this._doAlign(a.fallY1,n,d),j=(new DlRect(n,l)).intersect(m),n.y=b.y,this._doAlign(a.fallY2,n,d),k=(new DlRect(n,l)).intersect(m),j&&k?n=j.area()>k.area()?j.getTL():k.getTL():j?n=j.getTL():k&&(n=k.getTL()),this.args.fallY=!0),(new DlRect(n,l)).intersect(m))},b._doAlign=function(a,b,c){var d=this.getSize(),e=a.substr(0,1),f="";a.length>1&&(f=a.substr(1,1));switch(e){case"T":b.y-=d.y,this._mouseDiff&&this.args.align=="mouse"&&(b.y-=2*this._mouseDiff.y);break;case"B":b.y+=c.y,this._mouseDiff&&this.args.align=="mouse"&&(b.y+=2*this._mouseDiff.y);break;case"C":case"c":b.y+=(c.y-d.y)/2;break;case"t":b.y+=c.y-d.y;break;case"b":}switch(f){case"L":b.x-=d.x,this._mouseDiff&&this.args.align=="mouse"&&(b.x-=2*this._mouseDiff.x);break;case"R":b.x+=c.x,this._mouseDiff&&this.args.align=="mouse"&&(b.x+=2*this._mouseDiff.x);break;case"C":case"c":b.x+=(c.x-d.x)/2;break;case"l":b.x+=c.x-d.x;break;case"r":}},b.checkXPos=function(a,b){var c,d;return a.x<b.x?a.x-b.x:(c=this.getSize(),d=a.x+c.x-b.x-b.w,d>0?d:0)},b.checkYPos=function(a,b){var c,d;return a.y<b.y?a.y-b.y:(c=this.getSize(),d=a.y+c.y-b.y-b.h,d>0?d:0)},b.attachToPopup=function(a){this._parentPopup=a,a._childPopup=this},b.detachPopup=function(){this._parentPopup&&(this._parentPopup._childPopup=null),this._parentPopup=null},b.getToplevelPopup=function(){var a=this;while(a._parentPopup)a=a._parentPopup;return a},b._handle_focusKeys=function(a){var b;!a.altKey&&!a.ctrlKey&&(a.keyCode==DlKeyboard.ESCAPE?this.hide():a.keyCode==DlKeyboard.TAB&&(b=a.focusedWidget,b=a.shiftKey?this.getPrevFocusWidget(b):this.getNextFocusWidget(b),b&&b.focus(),a.domStop=!0,DlException.stopEventBubbling())),this._handleKeybinding(a)}}),DEFINE_CLASS("DlVbox",DlBox,function(a,b,c){var d=c.createElement;b.createCellElement=function(){return d("td",null,{className:"cell"},d("tr",null,{className:"row"},this._tbody))},b._removeWidgetElement=function(a){var b;this._widgets.contains(a)&&(b=a.getElement(),b.parentNode.parentNode.parentNode.removeChild(b.parentNode.parentNode))}}),DEFINE_CLASS("DlPopupMenu",DlPopup,function(a,b){function c(){var a;this.cancel(),a=this.args}a.CONSTRUCT=function(){this._mouseDiff={x:2,y:1}},a.onBeforePopup=function(a){var b;a.isContext?a.widget.activateSubmenu&&a.widget.activateSubmenu(!0):(a.item.currentPopup=this,a.item._popupVisible=!0,a.menu._popupVisible=!0,a.item.activateSubmenu(!0)),b=a.content,b instanceof Function&&(a.content=b=b.call(this)),b.parentMenu=a.isContext?a.widget:a.menu,b instanceof DlWidget&&b.hasHooks("onPopup")&&b.applyHooks("onPopup",[a])},a.onHide=function(a,b){var c;a.isContext?a.widget.activateSubmenu&&a.widget.activateSubmenu(!1):(a.item.activateSubmenu(!1),a.item.currentPopup=null,a.item._popupVisible=!1,a.menu._popupVisible=!1,c=a.content,c instanceof DlWidget&&c.hasHooks("onHide")&&c.applyHooks("onHide",[a]),c.parentMenu=null),b&&b.call(this,a)},b.popup=function(b){b.onBeforePopup||(b.onBeforePopup=a.onBeforePopup),b.onHide?b.onHide=a.onHide.$(this,b,b.onHide):b.onHide=a.onHide,a.BASE.popup.call(this,b)},b._setListeners=function(){a.BASE._setListeners.call(this),this.addEventListener({onMouseEnter:c})},b.correctPos=function(a){var b,c,d=this.args;try{!d.isContext&&!d.scrollVisible&&(b=d.menu,b&&b instanceof DlVMenu&&(c=d.content._widgets[0].getPos().y-d.content.parent.getElement().offsetTop,Math.abs(c)<50&&(d.fallY?a.y+=c:a.y-=c)))}catch(e){}}}),DEFINE_CLASS("DlHMenu",DlHbox,function(a){a.CONSTRUCT=DlMenuBase,a.DEFAULT_EVENTS=["onSelect","onPopup"]}),DEFINE_CLASS("DlVMenu",DlVbox,function(a){a.CONSTRUCT=DlMenuBase,a.DEFAULT_EVENTS=["onSelect","onPopup"]}),DEFINE_CLASS("DlMenuItem",DlContainer,function(a,b,c){function d(){var a;this.scrollIntoView(),this.addClass("DlMenuItem-hover","DlMenuItem-active"),a=this._inBaseMenu();if(!a||this.parentMenu._popupVisible)this._menu?this._popupMenu(a?0:250):a&&this._getDlPopup().hide(100)}function e(){var a;this.delClass("DlMenuItem-hover"),this.delClass("DlMenuItem-active"),a=this._inBaseMenu(),a||this._getDlPopup().hide(100)}function f(){var a;this.delClass("DlMenuItem-active"),this.hasHooks("onSelect")&&(a=DlPopupMenu.get(0).args,this._noClose||DlPopupMenu.clearAll(),this.applyHooks.delayed(1,this,"onSelect",[this.name,this,a]))}function g(){this.addClass("DlMenuItem-active"),this._popupMenu(0),DlException.stopEventBubbling()}function h(){this._menu instanceof DlWidget&&(this._menu.destroy(),this._menu=null)}a.CONSTRUCT=function(){this.parentMenu||(this.parentMenu=this.parent)},a.DEFAULT_EVENTS=["onSelect"],a.DEFAULT_ARGS={label:["label","DlMenuItem"],_iconClass:["iconClass",null],_noClose:["noClose",!1],parentMenu:["menu",null],name:["name",null],__itemId:["id",null]},b._inBaseMenu=function(){return!this.parentMenu.parentMenu},b._createElement=function(){var b;a.BASE._createElement.call(this),b=this.getElement(),b.innerHTML='<div class="div1"><div class="div2"></div></div>',this.setIconClass(this._iconClass),this._iconClass=null,this.setUnselectable(),this.label&&this.setContent(this.label)},b.getContentElement=function(){return this.getElement().firstChild.firstChild},b._getDlPopup=function(){return this.parentMenu._getDlPopup()},b._popupMenu=function(a){var b,c;this._menu&&!this._popupVisible&&(b=this.parentMenu,c=this._getDlPopup(),c.visible&&c.hide(),c.popup({timeout:a,content:this.getMenu(),anchor:this.getElement(),align:b._popupAlign,item:this,menu:this.parentMenu,onPopup:this._onPopup,onHide:this._onHide}))},b._setListeners=function(){a.BASE._setListeners.call(this),this.addEventListener({onMouseEnter:d,onMouseLeave:e,onMouseDown:g,onMouseUp:f,onDestroy:h})},b.getMenu=function(){return this._menu},b.setMenu=function(a,b,d){this._menu instanceof DlWidget&&this._menu.destroy(),a instanceof DlWidget&&a.ref(),this._menu=a,this._onPopup=b,this._onHide=d,c.condClass(this.getElement().firstChild,a,"DlMenuItem-withPopup")},b.activateSubmenu=function(a){this.condClass(a,"DlMenuItem-popped")}}),DEFINE_CLASS("DlButtonMenu",DlHbox,function(a,b){a.CONSTRUCT=DlMenuBase,a.DEFAULT_EVENTS=["onSelect","onPopup","onHide","onClick"],a.DEFAULT_ARGS={label:["label",null],_iconClass:["iconClass",null],_shiftMenu:["shiftMenu",null],_connected:["connected",!1]},b.ALIGN={prefer:"Br",fallX1:"_r",fallX2:"_l",fallY1:"B_",fallY2:"T_"},b.activateSubmenu=function(a){this._mainBtn.condClass(a,"DlButton-1"),this._menuBtn.condClass(a,"DlButton-1")},b._createElement=function(){a.BASE._createElement.call(this),this._mainBtn=new DlButton({parent:this,focusable:!1,label:this.label,className:"LabelPart",noCapture:this._connected,iconClass:this._iconClass}),this._mainBtn.connectEvents("onClick",this),this._menuBtn=new DlButton({parent:this,focusable:!1,label:"&nbsp;",className:"MenuArrow",noCapture:!0}),this._menuBtn.getElement().parentNode.style.width="3px",this._menuBtn.getContentElement().className="MenuArrow-inner",this._connected&&this._mainBtn.connectEvents("onMouseDown",this._menuBtn),this._mainBtn.connectEvents(["onMouseEnter","onMouseLeave"],this._menuBtn),this._menuBtn.addEventListener("onMouseDown",this._do_popupMenu.$(this)),this.addEventListener("onDestroy",this.setMenu.$(this,null))},b._do_popupMenu=function(a){var b;this._popupVisible||(b=this._getContextMenuPopup(),b.popup({timeout:0,content:this.getMenu(),align:this.ALIGN,anchor:this.getTableElement(),isContext:!0,widget:this,shift:this._shiftMenu,onHide:this.callHooks.$(this,"onHide")}),a instanceof DlEvent&&(a._justFocusedWidget=b),this.callHooks("onPopup"))},b.getMenu=function(){return this._menu},b.getButton=function(){return this._mainBtn},b.getArrow=function(){return this._menuBtn},b.setMenu=function(a){this._menu instanceof DlWidget&&this._menu.destroy(),a instanceof DlWidget&&a.ref(),this._menu=a}}),DlElementCache={get:function(a){return this[a].cloneNode(!0)}},function(){var a=DynarchDomUtils.createElement,b=Dynarch.ID,c=DlElementCache;(function(){var b=document.createDocumentFragment();a("td",null,null,a("tr",null,null,a("tbody",null,null,b))),c.TBODY_RC=b})(),function(){var b=document.createDocumentFragment();a("div",null,{className:"Shadow Shadow-TL"},b),a("div",null,{className:"Shadow Shadow-T"},b),a("div",null,{className:"Shadow Shadow-TR"},b),a("div",null,{className:"Shadow Shadow-L"},b),a("div",null,{className:"Shadow Shadow-R"},b),a("div",null,{className:"Shadow Shadow-BL"},b),a("div",null,{className:"Shadow Shadow-B"},b),a("div",null,{className:"Shadow Shadow-BR"},b),c.SHADOWS=b}(),function(){var b,d=a("tr"),e=a("td",null,null,d);6..times(function(){d.appendChild(e.cloneNode(!0))}),c.CAL_HEAD=a("thead"),c.CAL_HEAD.appendChild(d.cloneNode(!0)),b=c.CAL_BODY=a("tbody"),6..times(function(){b.appendChild(d.cloneNode(!0))})}(),c.DRAGGING_LINE=a("div",null,{className:"DlResizeBar-DraggingLine"})}(),DEFINE_CLASS("DlCalendar",DlWidget,function(a,b,c){function i(){var a;return d||(d=new DlVMenu({}),d.setStyle("textAlign","center"),new DlMenuItem({parent:d,label:DlTEXTS.goToday,name:"today",noClose:!0}),d.addSeparator(),a=new DlSpinner({parent:d,size:4}),a.addEventListener("onChange",function(){a.validationError||d.calendar.setYear(a.getValue())}),a.getElement().align="center",d.addSeparator(),12..times(function(a){new DlMenuItem({parent:d,label:Date.getMonthName(a),name:a,noClose:!0})}),d.addEventListener("onPopup",function(b){this.calendar=b.widget,a.setValue(this.calendar.date.getFullYear()),a.focus.$(a).delayed(5)}),d.addEventListener("onSelect",function(b){b=="today"?this.calendar.setToday():(this.calendar.setMonth(b),this.calendar.setYear(a.getValue())),d.getParent(DlPopup).hide()})),d}function j(a){var b;this._clearTimer(),b=a.getParentElement("td",this);if(b){this._currentHover&&(g(this._currentHover,"hover"),g(this._currentHover,"rolling"),this._currentHover=null,DlWidget.getTooltip().hide());if(b._navType!=null&&this._navDisabled)return;if(b._otherMonth&&this._omDisabled)return;if(b._firstDay!=null&&this.fixedFirstDay||b._week!=null)return;if(b.disabled)return;f(b,"hover"),this._currentHover=b,this.__tooltip&&this._popupTooltip()}}function k(){this._clearTimer(),this._currentHover&&(g(this._currentHover,"hover"),g(this._currentHover,"rolling"),this._currentHover=null)}function l(a){var b,c,d;j.call(this,a),b=a.getParentElement("td",this);if(!b)return;if(!(a.button==0||b._navType==null&&!b._otherMonth))return;if(b._otherMonth&&this._omDisabled||b.disabled)return;b._navType!=null&&a.dl_type=="onMouseDown"?this._navDisabled||this._navCellClicked(b,b._navType!=0?350:0,a):b._year!=null&&a.dl_type=="onMouseUp"?(c=this.date,c.setFullYear(b._year,b._month,b._iday),d=this._selectedDate,this._selectedDate=b._iday,b._otherMonth?(this.init(),this.applyHooks("onSelect",[!1,!0,!1,c])):d!=this._selectedDate?this._selectCell(b,!0):this.applyHooks("onSelect",[!1,!1,!0,c])):b._firstDay!=null&&!this.fixedFirstDay&&a.button==0&&a.dl_type=="onMouseDown"&&(this.firstDay=b._firstDay,this._displayCalendar())}function m(){var a,b=this.args.widget,c=b._currentHover;return c&&(a=c._info),c=b._cal_tooltip,c?c.call(b,a):a?a.tooltip:null}var d,e=c.createElement,f=c.addClass,g=c.delClass,h=c.condClass;a.FIXARGS=function(a){a.tagName="table",this._dayNamesOn=-1,this._selectedDate=a.date&&a.selected?a.date.getDate():0},a.CONSTRUCT=function(){this._noinit||this.init()},a.DEFAULT_EVENTS=["onSelect","onChange","onRendered"],a.DEFAULT_ARGS={firstDay:["firstDay",Date.getFirstDayOfWeek()],fixedFirstDay:["fixedFirstDay",!0],_weekNumbers:["weekNumbers",!1],date:["date",null],selected:["selected",!0],_navigation:["navigation",2],_navDisabled:["navDisabled",!1],_omDisabled:["omDisabled",!1],_noinit:["noinit",!1],_withMenu:["withMenu",!1],_disableHandler:["disableHandler",Function.returnFalse],_cal_tooltip:["dayTooltip",null],_infoDates:["infoDates",null],__tooltip:["tooltip",m]},b._createElement=function(){var b,c,d,f,g,h,i,j,k,l;a.BASE._createElement.call(this),g=this.getElement(),h=DlElementCache.get("CAL_BODY"),g.cellSpacing=g.cellPadding=g.border=0,g.appendChild(DlElementCache.get("CAL_HEAD")),g.appendChild(h);if(this._weekNumbers){b=g.getElementsByTagName("tr");for(c=b.length;--c>=0;)d=b[c],f=e("td",null,{className:"DlCalendar-WeekNumber"}),d.insertBefore(f,d.firstChild)}d=e("tr"),f=e("td",null,null,d),d.className="DlCalendar-Navigation",this._navigation==0?(f.colSpan=this.getNCols(),this._makeNavPart(f,0)):(i=e("td",null,null,d),j=e("td",null,null,d),this._navigation==1?(i.colSpan=this.getNCols()-2,this._makeNavPart(i,0,f,-1,j,1)):this._navigation==2&&(k=e("td",null,null,d),l=e("td",null,null,d),j.colSpan=this.getNCols()-4,this._makeNavPart(j,0,f,-2,i,-1,k,1,l,2))),c=g.rows[0],c.parentNode.insertBefore(d,c),this.setUnselectable(),this._withMenu&&this._createQuickNavMenu()},d=null,b._createQuickNavMenu=function(){this.setContextMenu(i)},b._makeNavPart=function(){var a,b,c;for(c=0;c<arguments.length;++c){a=arguments[c++],b=arguments[c],a._navType=b;switch(b){case-2:a.className="PrevYear";break;case-1:a.className="PrevMonth";break;case 0:a.className="Month",this.refNode("_monthTD",a);break;case 1:a.className="NextMonth";break;case 2:a.className="NextYear"}}},b.getNCols=function(){return this._weekNumbers?8:7},b.getTableElement=function(){return this.getElement()},b._displayDayNames=function(){var a,b=new Date,c=b.getDay(),d=this.getTableElement().getElementsByTagName("tr")[1],e=this._weekNumbers?1:0,f=this.firstDay;d.className="DlCalendar-DayNames";while(a=d.cells[e++])a._firstDay=f%7,h(a,f==c,"Today"),a.innerHTML=Date.getDayName(f++,!0),h(a,Date.isWeekend(a._firstDay),"WeekEnd");this._dayNamesOn=this.firstDay,this._weekNumbers&&(a=d.cells[0],a.innerHTML="w",a._week=-1,a.className="WeekNumber")},b._displayCalendar=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=new Date,t=s.getFullYear(),u=s.getMonth(),v=s.getDate();this._selectedTD=null,this._dayNamesOn!=this.firstDay&&this._displayDayNames(),a=new Date(this.date),a.setHours(12),b=a.getMonth(),c=a.getDate(),d=a.getFullYear(),e=a.getMonthDays(),this._monthTD.innerHTML=String.buffer("<b>",Date.getMonthName(b,this._navigation==2),"</b> ",d).get(),a.setDate(1),f=(a.getDay()-this.firstDay)%7,f<0&&(f+=7),a.setDate(-f),a.setDate(a.getDate()+1),g=this.getTableElement().rows[2],h=this._cells=[],i=this._displayedInterval={};for(k=0;k<6;++k,g=g.nextSibling){g.className="Dates",l=g.firstChild,this._weekNumbers&&(l.className="WeekNumber",l.innerHTML=l._week=a.getWeekNumber(),l=l.nextSibling);for(n=0;n<7;++n,l=l.nextSibling,a.setDate(m+1))o=a.getDay(),p=[],l._iday=m=a.getDate(),l._month=a.getMonth(),l._year=a.getFullYear(),l._info=null,j={y:l._year,m:l._month,d:l._iday},this._infoDates&&(q=j.y+"-"+(1+j.m).zeroPad(2)+"-"+j.d.zeroPad(2),r=this._infoDates[q],r&&(l._info=r,p.push(r.className||"DlCalendar-infoDay"))),i.start||(i.start=j),(l._otherMonth=b!=j.m)?(p.push("OtherMonth"),h[m+(m>15?100:200)]=l):(b==u&&m==v&&t==j.y&&p.push("Today"),this._selectedDate==m&&(this._selectCell(l),p.push("Selected")),h[m]=l),(o==0||o==6)&&p.push("WeekEnd"),l.disabled=this._disableHandler(a,p,l),l.innerHTML=this.getDayHTML(m),l.className=p.join(" ")}i.end=j,this.applyHooks("onRendered",[this])},b.getDayHTML=Function.identity,b.getDateCell=function(a){return this._cells[a]},b.getDisplayedInterval=function(){return this._displayedInterval},b.selectDate=function(a,b){a instanceof Date&&(a.dateEqualsTo(this.date,!0)||(this.date=new Date(a),this.init()),a=a.getDate()),this._selectCell(this.getDateCell(a),!b)},b.clearSelection=function(){this._selectedDate=null,this._initialized&&this._displayCalendar()},b.setYear=function(a){a!=this.date.getFullYear()&&(this.date.setFullYear(a),this.init())},b.setMonth=function(a){a!=this.date.getMonth()&&(this.date.setMonth(a),this.init())},b.setToday=function(){var a=new Date;this._selectedDate=0,this.date=a,this.init()},b._navCellClicked=function(a,b,c){var d,e;f(a,"rolling"),this._selectedDate=0,d=this.date,a._navType!=0&&d.setDate(1);switch(a._navType){case 0:if(this._withMenu)this.applyHooks("onContextMenu",[c]);else{e=new Date;if(d.dateEqualsTo(e,!0))return;this.date=e}break;case-2:d.setFullYear(d.getFullYear()-1);break;case-1:d.setMonth(d.getMonth()-1);break;case 1:d.setMonth(d.getMonth()+1);break;case 2:d.setFullYear(d.getFullYear()+1)}this.init(),this.applyHooks("onChange",[a._navType]),this.applyHooks("onSelect",[!0,a._navType,null,d]),b&&a._navType!=0&&(++this._timerStep,this._timer=setTimeout(this._navCellClicked.$(this,a,this._timerStep>4?50:100),b))},b._clearTimer=function(){this._timer&&clearTimeout(this._timer),this._timer=null,this._timerStep=0},b._selectCell=function(a,b){this._selectedDate=a._iday,this._selectedTD&&(g(this._selectedTD,"Selected"),g(this._selectedTD.parentNode,"Selected")),this._selectedTD=a,f(a,"Selected"),f(a.parentNode,"Selected"),g(a,"hover"),b&&this.applyHooks("onSelect",[!1,!1,!1,this.date])},b._setListeners=function(){a.BASE._setListeners.call(this),this.addEventListener({onMouseOver:j,onMouseLeave:k,onMouseUp:l,onMouseDown:l})},b.setInfoDates=function(a){this._infoDates=a,this._initialized&&this._displayCalendar()},b.init=function(){this.date||(this.date=new Date),this._displayCalendar(),this._initialized=!0},b.setSize=b.setOuterSize=function(b){a.BASE.setOuterSize.call(this,{x:b.x!=null?b.x+2:null,y:b.y})}}),DEFINE_CLASS("DlButtonCalendar",DlButtonMenu,function(a,b){function c(a,b){b||(this.getButton().setContent(a.date.print(this.dateFormat)),DlPopup.clearAllPopups(),this.date=new Date(a.date),this.applyHooks("onSelect",[this.date]))}function d(a){var b;this.date instanceof Date&&(b=this.getCalendar(),b.date.dateEqualsTo(this.date)||(b.date=new Date(this.date),b._selectedDate=this.date.getDate(),b.init())),this.getArrow().applyHooks("onMouseDown",[a])}a.DEFAULT_ARGS={dateFormat:["dateFormat","%Y/%m/%d"],_calendarArgs:["calendar",{}],_iconClass:["iconClass","IconCalendar"],date:["date","Select date..."]},a.DEFAULT_EVENTS=["onSelect","onCalendarRendered"],b.getCalendar=function(){var a=this._calendar;return a||(this._calendarArgs.noinit=!0,a=this._calendar=new DlCalendar(this._calendarArgs),this.addEventListener("onDestroy",a.destroy.$(a)),a.addEventListener("onSelect",c.$(this,a)),a.connectEvents("onRendered",this,"onCalendarRendered"),this.date instanceof Date&&(a.date=new Date(this.date)),a.init()),this._calendar},b.initDOM=function(){var b;a.BASE.initDOM.call(this),b=this.getButton(),this.date instanceof Date?b.label(this.date.print(this.dateFormat)):b.label(this.date),this.setMenu(this.getCalendar.$(this)),b.addEventListener("onClick",d.$(this))},b.getValue=function(){return this.date instanceof Date?this.date:null}}),DEFINE_CLASS("DlButtonColorPicker",DlButtonMenu,function(a,b,c){function d(a,b,c,d,e){var f=a.getColorElement();f.style.backgroundColor=d,a.hsv=Array.$(c),a._updateValues(),DlPopup.clearAllPopups(),a.applyHooks("onSelect",[b,c,d,e])}function e(a,b,c,d){a.getColorElement().style.backgroundColor=d}function f(a,b){var c,d;a.hsv&&(c=[b,a.hsv[1],a.hsv[2]],d=DlColor.RGB2color(DlColor.HSV2RGB(c)),a.getColorElement().style.backgroundColor=d,a.hsv=c,a._updateValues())}function g(a){var b=a.getColorElement();b.style.backgroundColor=a.rgb?DlColor.RGB2color(a.rgb):""}function h(){this._cp.addEventListener(this._events_cp),this.hsv&&this._cp.setHSV(this.hsv)}function i(){this._cp.removeEventListener(this._events_cp)}a.CONSTRUCT=function(){this._events_cp={onSelect:d.$(null,this),onHueChange:f.$(null,this),onHover:e.$(null,this),onHoverOut:g.$(null,this)},this._updateValues()},a.DEFAULT_ARGS={rgb:["rgb",null],hsv:["hsv",null],color:["color",null]},b._updateValues=function(){this.hsv?(this.rgb=DlColor.HSV2RGB(this.hsv),this.color=DlColor.RGB2color(this.rgb)):this.rgb?(this.hsv=DlColor.RGB2HSV(this.rgb),this.color=DlColor.RGB2color(this.rgb)):this.color&&(this.rgb=DlColor.color2RGB(this.color),this.hsv=DlColor.RGB2HSV(this.rgb))},b.setColorPicker=function(a){this._cp=a,this.setMenu(a),this.hsv&&(a.setHSV(this.hsv),d.call(a,this,this.rgb,this.hsv,DlColor.RGB2color(this.rgb),DlColor.RGBrightness(this.rgb)))},b._createElement=function(){var b;a.BASE._createElement.call(this),b=this.getButton().setContent(["<table cellspacing='0' cellpadding='0'><tr><td>","<div unselectable='on' class='ColorPart'>&nbsp;</div>","</td><td></td></tr></table>"].join("")),this.setLabel(this.label)},b.setLabel=function(a){var b=this.getLabelElement();b.innerHTML=a||"",c.condClass(b,a,"Label","EmptyLabel")},b.getColorElement=function(){return this.getButton().getContentElement().firstChild.rows[0].cells[0].firstChild},b.getLabelElement=function(){return this.getButton().getContentElement().firstChild.rows[0].cells[1]},b._setListeners=function(){a.BASE._setListeners.call(this),this.addEventListener({onPopup:h,onHide:i})}}),DEFINE_CLASS("DlCanvas",DlContainer,function(a,b){function g(a){return function(b){var c=b.computePos(this),d=this.getContext(),e=[c.x,c.y,d,this,b];return a
.call(this,b,c,d,e)}}function h(a){function b(b,c,d,e,f){var g;a.dragging=!0,a.ctx=d,a.cw=e,g=a.getPos(),a._dragDiff={x:g.x-b,y:g.y-c},DlEvent.captureGlobals(a._dragHandlers),f.domStop=!0}function c(){DlEvent.releaseGlobals(a._dragHandlers),a.dragging=!1,a.cw.refresh(),a.cw=null,a.ctx=null,a._dragPos=null}function d(b){var c=b.computePos(a.cw);c={x:c.x+a._dragDiff.x,y:c.y+a._dragDiff.y},a.setPos(c.x,c.y),a.applyHooks("onMove",[c]),a.cw.refresh(),f()}a.registerEvents(["onMove"]),a._dragHandlers={onMouseMove:d,onMouseUp:c,onMouseOver:f,onMouseOut:f,onMouseEnter:f,onMouseLeave:f},a.addEventListener({onMouseDown:b})}function i(a){function d(){f(a,"TL",function(){return[a.left(),a.top()]}),f(a,"T",function(){return[a.hcenter(),a.top()]}),f(a,"TR",function(){return[a.right(),a.top()]}),f(a,"L",function(){return[a.left(),a.vcenter()]}),f(a,"R",function(){return[a.right(),a.vcenter()]}),f(a,"BL",function(){return[a.left(),a.bottom()]}),f(a,"B",function(){return[a.hcenter(),a.bottom()]}),f(a,"BR",function(){return[a.right(),a.bottom()]})}function e(){Object.foreach(a._handles,function(a){a.update()})}function f(a,d,e){var f=e(),g=new c(f[0],f[1]);return g.update=function(){var a=e();this.setPos(a[0],a[1])},a._handles[d]=g,g.addEventListener("onMove",b[d]),g}var b;a._handles={},h(a),a.addEventListener({onActivate:function(a){a?d():(Array.hashKeys(this._handles).map("destroy"),this._handles={})},onMove:function(){e()}}),a.handles=function(){return Array.hashValues(this._handles)},a.activable=function(){return!0},b={TL:function(b){a.left(b.x),a.top(b.y),e()},T:function(b){a.top(b.y),e()},TR:function(b){a.right(b.x),a.top(b.y),e()},L:function(b){a.left(b.x),e()},R:function(b){a.right(b.x),e()},BL:function(b){a.left(b.x),a.bottom(b.y),e()},B:function(b){a.bottom(b.y),e()},BR:function(b){a.right(b.x),a.bottom(b.y),e()}}}function j(a,b){return b.zIndex()-a.zIndex()}var c,d=1e5,e="onMouseMove onMouseDown onMouseUp onMouseEnter onMouseLeave onClick",f=DlException.stopEventBubbling;a.DEFAULT_ARGS={width:["width",100],height:["height",100]},a.CONSTRUCT=function(){this._elements=[],this._activeEl=null,this._noUpdates=0},b.setMouseListeners=function(){e.qw().foreach(function(a){this[a]instanceof Function&&this.addEventListener(a,this[a])},this)},b._createElement=function(){a.BASE._createElement.apply(this,arguments),this.setContent("<canvas width='"+this.width+"' height='"+this.height+"'></canvas>")},b.getCanvas=function(){return this.getContentElement().firstChild},b.getContext=function(){return this._context||this.refNode("_context",this.getCanvas().getContext("2d"))},b.withContext=function(a){a(this.getContext())},b.withSavedContext=function(a){this.getContext().save();try{return a(this.getContext())}finally{this.getContext().restore()}},b.setSize=function(a){this.getCanvas().width=a.x,this.getCanvas().height=a.y,this.refresh(),this.callHooks("onResize")},b.add=function(a){this._elements.push(a),this.refresh()},b.clear=function(){var a=this.getCanvas();this.getContext().clearRect(0,0,a.width,a.height)},b.refresh=function(){this._noUpdates==0&&(this.clear(),this.getSortedElements().reverse().foreach(this.renderElement,this))},b.getSortedElements=function(){var a=this._elements.mergeSort(j);return this._activeEl&&a.unshift.apply(a,this._activeEl.handles()),a},b.renderElement=function(a){var b=this.getContext();b.save(),a.render(b,this),b.restore()},b.withNoUpdates=function(a){++this._noUpdates;try{return a()}finally{--this._noUpdates}},b.onMouseMove=g(function(a,b,c,d){this.getSortedElements().foreach(function(a){a.pointInside(b,c)?(a.__mouseInside||(a.__mouseInside=!0,a.applyHooks("onMouseEnter",d)),a.applyHooks("onMouseMove",d)):a.__mouseInside&&(a.__mouseInside=!1,a.applyHooks("onMouseLeave",d))},this)}),b.onMouseLeave=g(function(a,b,c,d){this.getSortedElements().foreach(function(a){a.__mouseInside&&(a.__mouseInside=!1,a.applyHooks("onMouseLeave",d))},this)}),b.onMouseDown=g(function(b,c,d,e){var f=!1;this.getSortedElements().foreach(function(b){b.pointInside(c,d)&&(b instanceof a.Handle?f=!0:!f&&b.activable()&&(b!==this._activeEl&&(this._activeEl&&this._activeEl.applyHooks("onActivate",[!1]),b.applyHooks("onActivate",[!0]),this._activeEl=b),f=!0),b.applyHooks("onMouseDown",e),$BREAK())},this),f?this.refresh():this._activeEl&&(this._activeEl.applyHooks("onActivate",[!1]),this._activeEl=null,this.refresh())}),b.onMouseUp=g(function(a,b,c,d){this.getSortedElements().foreach(function(a){a.pointInside(b,c)&&a.applyHooks("onMouseUp",d)},this)}),b.onClick=g(function(a,b,c,d){this.getSortedElements().foreach(function(a){a.pointInside(b,c)&&a.applyHooks("onClick",d)},this)}),a.make_movable=h,a.make_resizable=i,a.Element=DEFINE_CLASS(null,DlEventProxy,function(a,b){a.CONSTRUCT=function(){this._zIndex=0},a.DEFAULT_EVENTS=(e+" onActivate").qw(),b.pointInside=function(a,b){return b.save(),this.setMyPath(b),b.restore(),b.isPointInPath(a.x,a.y)},b.handles=function(){return[]},b.activable=function(){return!1},b.setClipPath=function(a){this.setMyPath(a)},b.zIndex=function(a){return a!=null&&(this._zIndex=a),this._zIndex}}),a.Rect=DEFINE_CLASS(null,a.Element,function(a,b){a.CONSTRUCT=function(a,b,c,d){this._p1=new DlPoint(a,b),this._p2=new DlPoint(a+c,b+d),this.normalize()},b.normalize=function(){this._p1.normalize(this._p2)},b.rectangle=function(){return new DlRect(this._p1,this._p2)},b.left=function(a){return a!=null&&(this._p1.x=a,this.normalize()),this._p1.x},b.top=function(a){return a!=null&&(this._p1.y=a,this.normalize()),this._p1.y},b.right=function(a){return a!=null&&(this._p2.x=a,this.normalize()),this._p2.x},b.bottom=function(a){return a!=null&&(this._p2.y=a,this.normalize()),this._p2.y},b.hcenter=function(){return(this.left()+this.right())/2},b.vcenter=function(){return(this.top()+this.bottom())/2},b.width=function(){return Math.abs(this._p2.x-this._p1.x)},b.height=function(){return Math.abs(this._p2.y-this._p1.y)},b.getPos=function(){return this._p1},b.setPos=function(a,b){var c,d;a!=null&&(c=a-this._p1.x,this._p1.x=a,this._p2.x+=c),b!=null&&(d=b-this._p1.y,this._p1.y=b,this._p2.y+=d)},b.setMyPath=function(a){var b,c,d,e;a.beginPath(),a.translate(this.hcenter(),this.vcenter()),b=this.width(),c=this.height(),d=b/2,e=c/2,a.rect(-d,-e,b,c),a.closePath()},b.render=function(a){a.fillStyle="#ffffff",a.strokeStyle="#000000",this.setMyPath(a),a.fill(),a.stroke()}}),a.Ellipse=DEFINE_CLASS(null,a.Rect,function(a,b){function c(a,b,c,d,e){var f=.5522848,g=d/2*f,h=e/2*f,i=b+d,j=c+e,k=b+d/2,l=c+e/2;a.moveTo(b,l),a.bezierCurveTo(b,l-h,k-g,c,k,c),a.bezierCurveTo(k+g,c,i,l-h,i,l),a.bezierCurveTo(i,l+h,k+g,j,k,j),a.bezierCurveTo(k-g,j,b,l+h,b,l)}b.setMyPath=function(a){var b,d,e,f;a.beginPath(),a.translate(this.hcenter(),this.vcenter()),b=this.width(),d=this.height(),e=b/2,f=d/2,c(a,-e,-f,b,d),a.closePath()}}),c=a.Handle=DEFINE_CLASS(null,a.Element,function(a,b){var c="rgba(0, 0, 0, 0.5)",e="#5500ff",f="rgba(255, 0, 0, 0.5)";a.CONSTRUCT=function(a,b,c){var d=this;h(d),d._point=new DlPoint(a,b),d._size=c||4,d.addEventListener({onMouseEnter:function(a,b,c,g){g.withSavedContext(function(a){a.strokeStyle=e,a.fillStyle=f,d.setMyPath(a),a.fill(),a.stroke()})},onMouseLeave:function(a,b,c,e){e.withSavedContext(function(a){d.setClipPath(a),a.clip(),e.refresh()})}})},b.setMyPath=function(a){a.beginPath(),a.arc(this._point.x,this._point.y,this._size,0,2*Math.PI,!0),a.closePath()},b.setClipPath=function(a){a.beginPath(),a.rect(this._point.x-this._size-1,this._point.y-this._size-1,this._size*2+2,this._size*2+2),a.closePath()},b.render=function(a){a.fillStyle=this.dragging?e:c,this.setMyPath(a),a.fill()},b.zIndex=function(){return d},b.setPos=function(a,b){a!=null&&(this._point.x=a),b!=null&&(this._point.y=b)},b.getPos=function(){return this._point}})}),DEFINE_CLASS("DlCheckbox",DlAbstractButton,function(a){a.DEFAULT_ARGS={_classes:["classes",{active:"DlCheckbox-active",hover:"DlCheckbox-hover",checked:"DlCheckbox-1",unchecked:"DlCheckbox-0",empty:"DlCheckbox-empty",disabled:"DlCheckbox-disabled"}]},a.FIXARGS=function(a){a.type=DlButton.TYPE.TWOSTATE}}),DlColor={RGB2HSV:function(a){var b=a[0],c=a[1],d=a[2],e,f,g,h,i,j;return e=Math.min(b,c,d),f=Math.max(b,c,d),j=f,g=f-e,f!=0?(i=g/f,b==f?h=(c-d)/g:c==f?h=2+(d-b)/g:h=4+(b-c)/g,h*=60,h<0&&(h+=360)):(i=0,h=-1),[h,i,j]},HSV2RGB:function(a){var b=a[0],c=a[1],d=a[2],e,f,g,h,i,j,k,l;if(c==0)f=g=h=d;else{b/=60,e=Math.floor(b),i=b-e,j=d*(1-c),k=d*(1-c*i),l=d*(1-c*(1-i));switch(e){case 0:f=d,g=l,h=j;break;case 1:f=k,g=d,h=j;break;case 2:f=j,g=d,h=l;break;case 3:f=j,g=k,h=d;break;case 4:f=l,g=j,h=d;break;default:f=d,g=j,h=k}}return[f,g,h]},RGB2bytes:function(a){var b=Array(3);return b[0]=Math.round(a[0]*255),b[1]=Math.round(a[1]*255),b[2]=Math.round(a[2]*255),b},RGB2color:function(a){return String.buffer("rgb(",a[0]*100,"%,",a[1]*100,"%,",a[2]*100,"%)").get()},RGB2hex:function(a){return a=DlColor.RGB2bytes(a),a[0].hex(2)+a[1].hex(2)+a[2].hex(2)},color2RGB:function(a){var b=0,c=0,d=0;if(!/^#/.test(a))throw new DlException("Can't parse color: "+a);return a.length==4&&(a=a.replace(/([a-f0-9])/ig,"$1$1")),b=parseInt(a.substr(1,2),16)/255,c=parseInt(a.substr(3,2),16)/255,d=parseInt(a.substr(5,2),16)/255,[b,c,d]},brighter:function(a){var b=Array.$(a);return b[1]-=.5,b[1]<0&&(b[1]=0),b},darker:function(a){var b=Array.$(a);return b[2]-=.5,b[2]<0&&(b[2]=0),b},RGBrightness:function(a){return(a[0]*299+a[1]*587+a[2]*114)/1e3}},DEFINE_CLASS("DlColorPickerHSV",DlWidget,function(a,b,c){function g(a){var b=a.target;try{while(b&&b.tagName.toLowerCase()!="td")b=b.parentNode}catch(c){b=null}return b}function h(a){var b=g(a);if(!b)return;throw b.rgb&&this.applyHooks("onSelect",[b.rgb,b.hsv,b.style.backgroundColor,DlColor.RGBrightness(b.rgb)]),new DlExStopEventBubbling}function i(a){var b,c=g(a);if(!c)return;throw b=c.getAttribute("hueCell"),b&&(a.computePos(this),this._refresh(a),DlEvent.captureGlobals(this._dragHandlers)),new DlExStopEventBubbling}function j(a){var b,c;this._currentHover&&(e(this._currentHover,"hover1"),e(this._currentHover,"hover2")),b=g(a),b&&(b.rgb?(this._currentHover=b,c=DlColor.RGBrightness(b.rgb),f(b,c>.6,"hover2","hover1"),this.applyHooks("onHover",[b.rgb,b.hsv,b.style.backgroundColor,c])):this._currentHover&&(this.callHooks("onHoverOut"),this._currentHover=null))}function k(){var a=this._currentHover;a&&(e(a,"hover1"),e(a,"hover2"),this.callHooks("onHoverOut")),this._currentHover=null}function l(){throw DlEvent.releaseGlobals(this._dragHandlers),new DlExStopEventBubbling}function m(a){var b=a.computePos(this),c=b.y-2;throw c<0?c=0:c>119&&(c=119),this.getHueBarElement().style.top=c+"px",this.__cphsvTimeout&&clearTimeout(this.__cphsvTimeout),this.__cphsvTimeout=this._refresh.$(this,a).delayed(5),new DlExStopEventBubbling}var d,e=c.delClass,f=c.condClass;a.DEFAULT_EVENTS=["onSelect","onHover","onHoverOut","onHueChange"],d=String.buffer("<table cellspacing='1' cellpadding='0' border='0'>","<tbody>","<tr>","<td></td>".repeat(11),"<td rowspan='11' class='DlColorPickerHSV-Sep'></td>","<td rowspan='11' class='DlColorPickerHSV-HSV' hueCell='1'>","<div class='DlColorPickerHSV-HSV-bar'></div>","</td>","</tr>",("<tr>"+"<td></td>".repeat(11)+"</tr>").repeat(10),"</tbody></table>").get(),b.getHueBarElement=function(){return this.getElement().rows[0].cells[12].firstChild},b._createElement=function(){a.BASE._createElement.call(this,d),this.setUnselectable()},b.initDOM=function(){a.BASE.initDOM.call(this),this.addEventListener({onMouseUp:h,onMouseDown:i,onMouseOver:j,onMouseLeave:k}),this._dragHandlers={onMouseMove:m.$(this),onMouseUp:l.$(this),onMouseOver:DlException.stopEventBubbling,onMouseOut:DlException.stopEventBubbling,onMouseEnter:DlException.stopEventBubbling,onMouseLeave:DlException.stopEventBubbling},this._redraw(360)},b._refresh=function(a){var b=Math.limit(a.relPos.y-2,0,119),c=Math.round((1-b/120)*360);c=this._redraw(c),this.applyHooks("onHueChange",[c]),this.__cphsvTimeout=null},b.setHSV=function(a){this._redraw(a[0])},b._redraw=function(a){var b,c,d,e,f=this.getHueBarElement(),g=this.getElement(),h=g.rows,i=h.length-1,j=h[0].cells.length-3;f.style.top=120-a/3+"px",a==360&&(a=0);for(b=i;b>=0;--b){e=h[b].cells;for(d=j;d>=0;--d)c=e[d],c.hsv=[a,1-b/i,d/j],c.rgb=DlColor.HSV2RGB(c.hsv),c.style.backgroundColor=DlColor.RGB2color(c.rgb)}return a}}),DEFINE_CLASS("DlEntry",DlContainer,function(a,b,c){function e(){this.addClass("DlEntry-Focus"),this._focused=!0,a.BASE.focus.call(this),this._isEmpty&&(this.getInputElement().value="",this.delClass("DlEntry-empty"),this._isEmpty=!1)}function f(){this.delClass("DlEntry-Focus"),this._focused=!1,a.BASE.blur.call(this),this.__setEmpty()}function g(){this.destroyed||(this.__setEmpty(),this.callHooks("onChange"))}function h(){this.validate()}function i(a){this._isEmpty=!1,a.keyCode==DlKeyboard.ENTER?this.applyHooks("onKey-ENTER",[a]):a.keyCode==DlKeyboard.ESCAPE&&this.applyHooks("onKey-ESCAPE",[a])}var d=c.createElement;a.FIXARGS=function(a){a.tagName="table",this._isTextArea=a.type=="textarea"},a.DEFAULT_EVENTS=["onChange","onKey-ENTER","onKey-ESCAPE","onValidationError","onValidation","onPaste","onCopy","onCut"],a.DEFAULT_ARGS={_domType:["type","text"],_value:["value",null],_size:["size",null],_rows:["rows",null],_readonly:["readonly",!1],_emptyText:["emptyText",""],_emptyValue:["emptyValue",""],_width:["width",null],_name:["name",null],_validators:["validators",[]],_allowEmpty:["allowEmpty",null],_focusable:["focusable",2],_maxlen:["maxlength",null],_noSelect:["noSelect",!1],_trim:["trim",!1],_noWrap:["noWrap",!1]},b.validate=function(a){var b,c,d,e;a==null&&(a=this.getValue(!0));if(this._allowEmpty!=null&&!/\S/.test(a))return this.condClass(!this._allowEmpty,"DlEntry-ValidationError"),this.applyHooks("onValidation",[!this._allowEmpty]),this._allowEmpty;b=this._validators,e=!1;for(c=0;c<b.length;++c){d=b[c];if(!d.ok(a)){e=d.getError()||!0;break}}return d&&!e&&this.setValue(d.getLastVal(),!0),this.validationError=e,!this._noSelect&&this._focused&&!this.readonly()&&this._domType!="textarea"&&this.select(),this.condClass(e,"DlEntry-ValidationError"),this.applyHooks("onValidation",[e]),e&&(this.setInvalidTooltip(e.message),this.applyHooks("onValidationError",[e])),!e},b.setInvalidTooltip=function(a){this._invalidTooltip.setTooltip(a)},b.timerFocus=function(a){return this.focus.clearingTimeout(a||10,this)},b.select=function(){try{is_gecko?this.setSelectionRange(0,this.getValue(!0).length):this.getInputElement().select()}catch(a){}},b.focus=function(){this.getInputElement().focus(),!this._noSelect&&!this.readonly()&&this._domType!="textarea"&&this.select()},b.blur=function(){this.getInputElement().blur()},b.__setEmpty=function(a){return a==null&&(a=this.getInputElement().value),this._isEmpty=this.__checkEmpty(a),this._isEmpty?this._focused?this.getInputElement().value=a:(this.addClass("DlEntry-empty"),this.getInputElement().value=""):this.delClass("DlEntry-empty"),this._isEmpty},b.__checkEmpty=function(a){return a==null&&(a=this.getInputElement().value),a===""},b._createElement=function(){var b,c;a.BASE._createElement.apply(this,arguments),b=this.getElement(),b.appendChild(DlElementCache.get("TBODY_RC")),b.cellSpacing=b.cellPadding=b.border=0,b=b.rows[0].cells[0],b.className="DlEntry-cell",c=this._isTextArea?document.createElement("textarea"):c=document.createElement("input"),c.id=this.id+"-input",c.setAttribute("autocomplete","off",1),this._noWrap&&c.setAttribute("wrap","off"),this._isTextArea&&this._rows&&(c.rows=this._rows),this._maxlen!=null&&c.setAttribute("maxlength",this._maxlen);switch(this._domType){case"password":case"file":case"hidden":c.type=this._domType}is_gecko&&gecko_version<1.9&&!this._no_gecko_bug&&(b=d("div",null,{className:"Gecko-Bug-226933"},b)),b=d("div",{position:"relative",overflow:"hidden"},null,b),this._emptyText&&d("label",null,{htmlFor:this.id+"-input",className:"DlEntry-emptyText",innerHTML:this._emptyText.htmlEscape()},b),b.appendChild(c),this.refNode("_invalidTooltip",new DlWidget({className:"DlEntry-invalidIcon",parent:this,appendArgs:b}))},b.getInputElement=function(){return this.getElement().getElementsByTagName(this._isTextArea?"textarea":"input")[0]},b.getContentElement=b.getInputElement,b.setIfEmpty=function(a,b){this._isEmpty&&a&&this.setValue(a,b)},b.isEmpty=function(){return this.__checkEmpty()},b.setValue=function(a,b){var c;this.__setEmpty(a)||(this._maxlen!=null&&(a=(a+"").substr(0,this._maxlen)),c=this.getInputElement(),c.value=a,c.defaultValue=a),b||this.callHooks("onChange")},b.isDirty=function(){var a=this.getInputElement();return a.value!=a.defaultValue},b.clear=function(a){return this.setValue("",a),this},b.getValue=function(a){var b=!a&&this.isEmpty()?this._emptyValue:this.getInputElement().value;return this._trim&&typeof b=="string"&&(b=b.trim()),b},b.getSelectionRange=function(){return c.getSelectionRange(this.getInputElement())},b.setSelectionRange=function(a,b){c.setSelectionRange(this.getInputElement(),a,b)},b.moveEOF=function(){var a=this.getValue(!0).length;this.setSelectionRange(a,a)},b.moveBOF=function(){this.setSelectionRange(0,0)},b.collapse=function(a){var b=this.getSelectionRange();b=a?b.start:b.end,this.setSelectionRange(b,b)},b.insertReplacingSelection=function(a,b){var c=this.getSelectionRange(),d=this.getValue();this.setValue(d.substr(0,c.start)+a+d.substr(c.end)),this.setSelectionRange(c.start,b?c.start+a.length:c.start)},b.initDOM=function(){var b;a.BASE.initDOM.call(this),b=this.getInputElement(),c.addEvent(b,{focus:this._on_element_focus=e.$(this),blur:this._on_element_blur=f.$(this),change:this._on_element_change=g.clearingTimeout(10,this)}),this.addEventListener({onChange:h,onKeyPress:i}),this._value!=null?this.setValue(this._value,!0):this.clear(!0),this._width!=null?b.style.width=this._width:this._size!=null&&this.setSize({x:this._size*9+7-this._size}),this._name!=null&&(b.name=this._name),this.readonly(this._readonly)},b.readonly=function(a){var b=this.getInputElement();return a!=null&&(b.readOnly=a,a?b.setAttribute("readonly",!0,1):b.removeAttribute("readonly"),this.condClass(a,"DlEntry-Readonly")),b.getAttribute("readonly")},b.disabled=function(b,c){var d=a.BASE.disabled.call(this,b,c);return b!=null&&(this.getInputElement().disabled=!!b),d},b.setSize=b.setOuterSize=function(a){var b=this.getInputElement(),d=a.x,e=a.y,f=c.getPaddingAndBorder(this.getElement()),g=c.getPaddingAndBorder(b),h=this._btn?this._btn.getSize().x:0;h?c.setOuterSize(b,a.x-f.x-g.x-h+2):(d!=null&&(d-=g.x+4),e!=null&&(e-=g.y+4),this._domType!="textarea"&&(e=null),c.setInnerSize(b,d,e),d!=null&&(d+=8,c.setInnerSize(this.getElement(),d)))},b._makeButton=function(a,b,c,e){var f;return!e&&!c&&(c="DlEntry-dropDownBtn",e={hover:"DlEntry-dropDownBtn-hover",active:"DlEntry-dropDownBtn-active"}),f=d("td",null,null,this.getElement().rows[0]),this._btn=new DlAbstractButton({parent:this,appendArgs:f,label:a,iconClass:b,className:c,classes:e})}}),DEFINE_CLASS("DlCompletionEntry",DlEntry,function(a,b,c){function g(){return d||(d=DlCompletionPopup.get()),d}function h(){return e&&(f=null,e.destroy()),e=new DlVMenu({})}function i(){return e&&e.parent.visible}function j(a,b){var c=e.children().find(this);c!=f&&f!=null&&e.children(f).callHooks("onMouseLeave"),f=c,(a._electric||!b)&&a._applyCompletion(this.userData)}function k(a){a._hideMenu(),a._applyCompletion(this.userData,!0),a.applyHooks("onSelect",[this.userData]),a.focus.delayed(0,a)}function l(a,b){this.__origData={value:this.getValue(),range:this.getSelectionRange()},this.__forced=b,this.addClass("DlCompletionEntry-busy"),this.applyHooks("onCompletion",[this.getSelectionRange(),a,b])}function m(a){var b,c,d;if(!i())return!1;b=f;switch(a.keyCode){case DlKeyboard.ARROW_UP:f==null&&(f=0),f=e.children().rotateIndex(--f);break;case DlKeyboard.ARROW_DOWN:case DlKeyboard.TAB:f==null&&(f=-1),f=e.children().rotateIndex(++f);break;case DlKeyboard.ENTER:f!=null&&(this.collapse(!1),e.children(f).callHooks("onSelect")),DlException.stopEventBubbling();case DlKeyboard.ESCAPE:this._hideMenu(),d=this.__origData,d&&(this.setValue(d.value),this.setSelectionRange(d.range)),DlException.stopEventBubbling()}b!=f?(b!=null&&(c=e.children(b),c.callHooks("onMouseLeave")),c=e.children(f),c.callHooks("onMouseEnter"),DlException.stopEventBubbling()):this._hideMenu()}function n(a){if(is_ie)return m.call(this,a)}function o(){this.cancelCompletion()}var d,e,f;a.DEFAULT_EVENTS=["onCompletion","onSelect"],a.DEFAULT_ARGS={__timeout:["timeout",500],_shiftMenu:["shift",null],__smart:["smart",!0],__noTab:["noTab",!1],_noSelect:["noSelect",!0],_sizeToFit:["sizeToFit",!1],_electric:["electric",!0]},b.ALIGN={prefer:"Br",fallX1:"_r",fallX2:"_L",fallY1:"B_",fallY2:"T_"},b._setListeners=function(){this.__on_itemHover=j.$(null,this),this.__on_itemSelect=k.$(null,this),a.BASE._setListeners.call(this),this.addEventListener({onKeyDown:n,onBlur:o,onDestroy:this.__clearTimer})},b._hideMenu=function(){g().hide(50),this.__clearTimer()},b.__clearTimer=function(){this.__timer&&clearTimeout(this.__timer),this.__timer=null},d=null,e=null,f=null,b._applyCompletion=function(a,b){var c,d,e,f;if(!a.nomodify||b){c=this.getSelectionRange(),d=a.completion||a.label,b&&a.after&&(d+=a.after),e=this.getValue(),f=a.start!=null?a.start:c.start,e=e.substr(0,f)+d+e.substr(c.end),this.setValue(e),c.end=f+d.length,a.rstart!=null&&(c.start=a.rstart);if(a.noselect||b)c.start=c.end;this.setSelectionRange(c)}},b._on_menuHide=function(){e&&(e.destroy(),e=null,f=null)},b.completionReady=function(a){var b,d,e;(this.__timer||this.__forced)&&a!=null&&a.length>0&&(this.__smart&&a.length==1?(this._applyCompletion(a[0],!0),this.applyHooks("onSelect",[a[0]])):(b=h(),d=null,a.foreach(function(a){var c=new DlMenuItem({parent:b,label:a.label,data:a});c.addEventListener({onSelect:this.__on_itemSelect,onMouseEnter:this.__on_itemHover}),a.selected&&(d=c)},this),g().popup({timeout:0,content:b,align:this.ALIGN,anchor:this.getElement(),isContext:!0,widget:this,onHide:this._on_menuHide.$(this),shift:this._shiftMenu}),this._sizeToFit&&(e=this.getSize().x,b.getSize().x<e&&b.setSize({x:e-c.getPaddingAndBorder(g().getElement()).x})),d&&d.callHooks("onMouseEnter"))),this.cancelCompletion()},b.cancelCompletion=function(){this.delClass("DlCompletionEntry-busy"),this.__clearTimer(),this.__forced=null},b._handle_focusKeys=function(b){if(!DlKeyboard.KEYS_CONTROL[b.keyCode])this._hideMenu(),this.__timeout!=null&&(this.__timer=l.delayed(this.__timeout,this,b,!1));else if(!is_ie){if(!(!this.__noTab&&b.keyCode==DlKeyboard.TAB&&!i()&&!this.isEmpty()))return m.call(this,b);l.call(this,b,!0),b.domStop=!0,DlException.stopEventBubbling()}return a.BASE._handle_focusKeys.call(this,b)},b.completeFromWords=function(b,c){return a.completeFromWords.call(a,this,b,c)},a.completeFromWords=function(a,b,c){return c==null&&(c={}),c.sep==null&&(c.sep=/\s+/g),function(d){var e,f=[],g=a.getValue(),h=g.lastIndexOfRegexp(c.sep,d.start);g=g.substring(h,d.start);if(g)for(e=0;e<b.length;++e)b[e].indexOf(g)==0&&f.push({label:b[e],noselect:c.noselect,after:c.addSep,start:h});f.length>0?a.completionReady(f):a.cancelCompletion()}}}),DEFINE_CLASS("DlCompletionPopup",DlPopup,function(a){a.FIXARGS=function(a){a.zIndex=1e3,a.focusable=!1}}),DEFINE_CLASS("DlComboBox",DlCompletionEntry,function(a,b){function c(a){a.button==0&&(this._forcePopup(),DlException.stopEventBubbling())}a.DEFAULT_ARGS={_noSelect:["noSelect",!1],__smart:["smart",!1],__noTab:["noTab",!0],_options:["options",null],_sizeToFit:["sizeToFit",!0],_electric:["electric",!1]},b._createElement=function(){a.BASE._createElement.apply(this,arguments),this._makeButton(null,null,"DlComboBox-dropDownBtn",{hover:"DlComboBox-dropDownBtn-hover"}).addEventListener("onMouseDown",c.$(this)),this.addEventListener("onCompletion",this.doCompletion)},b._on_menuHide=function(){a.BASE._on_menuHide.call(this),this._btn.delClass("DlComboBox-dropDownBtn-active")},b._forcePopup=function(){this._btn.addClass("DlComboBox-dropDownBtn-active"),this.__forced=!0,this.doCompletion(null),this.focus.delayed(0,this)},b.doCompletion=function(a){var b,c="",d=[];if(a){c=this.getValue().trim().toLowerCase();if(!c)return this.cancelCompletion()}b=this._options;if(b instanceof Function){b=b.apply(this,arguments);if(b==null)return}b.foreach(function(a){a.toLowerCase().indexOf(c)==0&&d.push({label:a.htmlEscape(),start:0,completion:a})}),d.length>0?this.completionReady(d):this.cancelCompletion()}}),DEFINE_CLASS("DlDrag",DlEventProxy,function(a,b,c){a.DEFAULT_EVENTS=["onDrop","onStartDrag"],a.DEFAULT_ARGS={delta:["delta",3],dragging:["_dragging",!1],draggingClass:["draggingClass","DlWidget-dragging"],_animArgs:["animation",{length:30,fps:50}],cursor:["cursor",{noDrop:"CURSOR-NO-DROP",okDrop:"CURSOR-DROP"}]},b.dropOK=function(a,b,c){return this.target=c,this.canDrop=!0},b._handleDrop=function(a,b,c){this.applyHooks("onDrop",[a,b,c])},b.doDrop=function(){throw new DlExAbstractBaseClass},b.startOK=function(){return!0},b.moving=function(){},b.reset=function(a){var b,d,e,f=this.elementCopy;f&&f.parentNode&&(a&&this._animArgs?(b=new DlAnimation(this._animArgs.length,this._animArgs.fps),d=this.startElPos||this.startPos,e=c.getPos(f),b.addEventListener({onUpdate:function(){var a=this.getPos();f.style.left=a.mapInt(e.x,d.x)+"px",f.style.top=a.mapInt(e.y,d.y)+"px",c.setOpacity(f,this.t.map(1,.2))},onStop:function(){c.trash(f),f=null}}),b.start(null,null,"accel_ab")):f.parentNode.removeChild(f)),this.dragging=!1,this.canDrop=!1,this.target=null,this.elementCopy=null,this.startPos=null,this.source=null},b.makeElementCopy=function(a,b){var d=this.elementCopy;return d||(d=this.elementCopy=a.getElement().cloneNode(!0),c.addClass(d,"DlWidget-dragged-clone"),d.style.top=b.pos.y+"px",d.style.left=b.pos.x+"px",document.body.appendChild(d),d.style.width=d.offsetWidth+"px"),d}}),DEFINE_CLASS("DlDragTreeItem",DlDrag,function(a,b){function h(a){return/DlTree-IconWidth/.test(a.target.className)}var c,d,e,f,g;a.DEFAULT_ARGS={_noReparent:["noReparent",!1]},c="DlTreeItem-dropTarget",d="DlTreeItem-dropTarget-upper",e="DlTreeItem-dropTarget-lower",f=/DlTreeItem-dropTarget[^\s]*/g,g=/DlTreeItem-dropTarget-[^\s]*/g,b.startOK=function(a,b){return!h(b)},b.dropOK=function(a,b,d,e){var g;while(d&&!(d instanceof DlTreeItem))d=d.parent;return g=!e&&d,g&&(g=!this._noReparent||a.parent===d.parent),this.target=g?d:null,this.canDrop=!!g,this.oldTarget&&this.oldTarget!==this.target&&this.oldTarget.delClass(f),g&&this.target.addClass(c),this.oldTarget=this.target,g},b.doDrop=function(a,b){var c;this._noReparent||h(b)?(c=this.target.getIndex(),this.dropBefore||++c,this.target.parent.appendWidget(a,c),this._handleDrop(a,this.target,this.dropBefore?"before":"after")):this.target.getSubtreeWidget()!==a.parent&&(this.target.addSubItem(a),this._handleDrop(a,this.target))},b.moving=function(a,b){var c,f,i,j=this.target;this.canDrop&&j&&(this._noReparent||h(b))?(c=b.computePos(j),f=j.getDivElement().offsetHeight/2,i=c.y<=f,j.condClass(i,d,e),this.dropBefore=i):j&&(this.dropBefore=null,j.delClass(g))},b.reset=function(){this.target&&this.target.delClass(f),this.oldTarget&&this.oldTarget.delClass(f),a.BASE.reset.apply(this,arguments),this.oldTarget=null}}),DEFINE_CLASS("DlLayout",DlContainer,function(a,b,c){a.DEFAULT_ARGS={_outerSpace:["outerSpace",0],_fillParent:["fillParent",!0]},a.setFill=function(a,b){var c=a._dllayout_args.fill;a._dllayout_args.fill=b,b!=c&&a.parent.doLayout()},a.getArgs=function(a){return a._dllayout_args},b._appendWidgetElement=function(b,d){var e;if(d==null)return a.BASE._appendWidgetElement.apply(this,arguments);e=c.createElement("div",null,{className:"DlLayout-positioned"},this.getElement()),d.zIndex&&(e.style.zIndex=d.zIndex),d.overflow&&(e.style.overflow=d.overflow),e.appendChild(b.getElement()),b._dllayout_args=d},b._removeWidgetElement=function(a){var b,c;this._widgets.contains(a)&&(b=a.getElement(),c=b.parentNode,c&&(c.parentNode.removeChild(c),c.removeChild(b)))},b.packWidget=function(a,b){this.appendWidget(a,b)},b.replaceWidget=function(a,b){var c,d,e=this._widgets.find(a);e>=0&&(b.parent&&b.parent.removeWidget(b),this._widgets.splice(e,1,b),b._dllayout_args=a._dllayout_args,a._dllayout_args=null,c=a.getElement(),d=c.parentNode,d.insertBefore(b.getElement(),c),d.removeChild(c),b.parent=this,a.parent=null)},b.doLayout=function(){function t(){typeof s=="number"?a=b=c=d=s:s instanceof Array?(d=s[0],b=s[1],c=s[2],a=s[3]):(d=s.top||0,b=s.right||0,c=s.bottom||0,a=s.left||0)}var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=this.getInnerSize(),s=this._outerSpace;t(),e=this._widgets,f=Array(e.length),g={};for(h=0;h<e.length;++h){i=e[h],j=i._dllayout_args;if(!j||!i.display())continue;k=i.getElement().parentNode,l=j.before=j.before||0,m=j.after=j.after||0,n=j.fill,j.resetSize&&(i.getElement().style.height="",i.getElement().style.width=""),o=i.getOuterSize();switch(j.pos){case"top":d+=l,n==null&&(n=o.y),f[h]={sy:n},typeof n=="number"&&(d+=n),d+=m;break;case"right":b+=l,n==null&&(n=o.x),f[h]={sx:n},typeof n=="number"&&(b+=n),b+=m;break;case"bottom":c+=l,n==null&&(n=o.y),f[h]={sy:n},typeof n=="number"&&(c+=n),c+=m;break;case"left":a+=l,n==null&&(n=o.x),f[h]={sx:n},typeof n=="number"&&(a+=n),a+=m}f[h].w=i,f[h].args=j,f[h].div=k}p=r.x-a-b,q=r.y-d-c,t(),f.foreach(function(e){function h(){var a=d,b=r.y-d-c,h={x:e.sx};switch(f.valign){case"top":break;case"center":a+=(b-g.getOuterSize().y)/2;break;case"bottom":a+=b-g.getOuterSize().y;default:h.y=b}e.div.style.top=a+"px",g.setSize(h)}var f,g;e||$CONTINUE(),f=e.args,g=e.w;if(!g.display())return;switch(f.pos){case"top":case"bottom":typeof e.sy!="number"&&(e.sy=="*"?e.sy=q:/%/.test(e.sy)&&(e.sy=Math.floor(parseFloat(e.sy)*q/100)),f.min!=null&&e.sy<f.min&&(e.sy=f.min),f.max!=null&&e.sy>f.max&&(e.sy=f.max),q-=e.sy);break;case"left":case"right":typeof e.sx!="number"&&(e.sx=="*"?e.sx=p:/%/.test(e.sx)&&(e.sx=Math.floor(parseFloat(e.sx)*p/100)),f.min!=null&&e.sx<f.min&&(e.sx=f.min),f.max!=null&&e.sx>f.max&&(e.sx=f.max),p-=e.sx)}switch(f.pos){case"top":d+=f.before,e.div.style.left=a+"px",e.div.style.top=d+"px",g.setSize({x:r.x-a-b,y:e.sy}),d+=e.sy+f.after;break;case"bottom":c+=f.before,e.div.style.left=a+"px",e.div.style.top=r.y-c-e.sy+"px",g.setSize({x:r.x-a-b,y:e.sy}),c+=e.sy+f.after;break;case"left":a+=f.before,e.div.style.left=a+"px",h(),a+=e.sx+f.after;break;case"right":b+=f.before,e.div.style.left=r.x-b-e.sx+"px",h(),b+=e.sx+f.after}})},b.__doLayout=function(){this.doLayout()},b.sizeToFit=function(){var a,b,c,d,e=this._widgets,f=0,g=0;for(a=0;a<e.length;++a){b=e[a],c=b._dllayout_args,d=b.getOuterSize();switch(c.pos){case"top":case"bottom":f+=d.y,d.x>g&&(g=d.x);break;case"left":case"right":g+=d.x,d.h>f&&(f=d.h)}}this.setOuterSize({x:g,y:f})}}),DEFINE_CLASS("DlResizeBar",DlWidget,function(a,b,c){function e(a){var b,d,e,f=DlElementCache.DRAGGING_LINE,g=this.getPos();this._dragPos=this.isHoriz()?g.y:g.x,b=this.isHoriz()?a.pos.y:a.pos.x,this._mposDiff=b-this._dragPos,d=this.getSize(),f.style.top=g.y+"px",f.style.left=g.x+"px",f.style.width=d.x+"px",f.style.height=d.y+"px",this._widget&&(e=this._widget instanceof DlWidget?this._widget.getSize():c.getOuterSize(this._widget),this._dragSize=this.isHoriz()?e.y:e.x),document.body.appendChild(f),this._setResizeCaptures(!0),DlException.stopEventBubbling()}function f(a){this._setResizeCaptures(!1),this._doResize(a),document.body.removeChild(DlElementCache.DRAGGING_LINE),this.callHooks("onStop")}function g(a){var b,c,d,e,f,g,h=DlElementCache.DRAGGING_LINE,i=this.isHoriz()?a.pos.y:a.pos.x;i-=this._mposDiff,b=this._invert*(i-this._dragPos),c=this._min,d=this._max,e=this._widget;if(e){f=DlLayout.getArgs(e),f&&(c==null&&(c=f.min),d==null&&(d=f.max));if(c!=null||d!=null)g=this._dragSize+b;c!=null&&g<c?i+=this._invert*(c-g):d!=null&&g>d&&(i+=this._invert*(d-g))}this.isHoriz()?h.style.top=i+"px":h.style.left=i+"px",this._cont&&this._doResize(a)}var d;a.DEFAULT_EVENTS=["onResizing","onStop"],d=c.condClass,a.FIXARGS=function(a){a.invert=a.invert?-1:1},a.DEFAULT_ARGS={_isHoriz:["horiz",null],_widget:["widget",null],_invert:["invert",!1],_min:["min",null],_max:["max",null],_cont:["continuous",!1],_keepPrc:["keepPercent",!1]},a.getDragBar=function(){return DlElementCache.DRAGGING_LINE},b.initDOM=function(){a.BASE.initDOM.call(this),this.condClass(this.isHoriz(),"DlResizeBar-Horizontal","DlResizeBar-Vertical"),this.setUnselectable(null,!0)},b.isHoriz=function(){var a;return this._isHoriz==null&&(a=DlLayout.getArgs(this),a&&(this._isHoriz=/top|bottom/.test(a.pos))),this._isHoriz},b._setListeners=function(){a.BASE._setListeners.call(this),this._resizeHandlers={onMouseMove:g.$(this),onMouseUp:f.$(this),onMouseOver:DlException.stopEventBubbling,onMouseOut:DlException.stopEventBubbling,onMouseEnter:DlException.stopEventBubbling,onMouseLeave:DlException.stopEventBubbling},this.addEventListener("onMouseDown",e)},b._setResizeCaptures=function(
a){var b;(a?DlEvent.captureGlobals:DlEvent.releaseGlobals)(this._resizeHandlers),b=DlDialog.activateEventStopper(a),d(b,a,this.isHoriz()?"CURSOR-RESIZE-S":"CURSOR-RESIZE-E")},b._doResize=function(){var a,b,d,e,f,g=this.isHoriz(),h=c.getPos(DlElementCache.DRAGGING_LINE);h=g?h.y:h.x,a=this._invert*(h-this._dragPos),b=this._widget,b&&(d=this._dragSize,b instanceof DlWidget?(e=DlLayout.getArgs(b),e?(e=e.fill,f=/%$/.test(e),f&&!this._keepPrc||e==null||typeof e=="number"?DlLayout.setFill(b,d+a):f&&(e=parseFloat(e),DlLayout.setFill(b,e*(d+a)/d+"%"))):this._isHoriz?b.setSize({y:d+a}):b.setSize({x:d+a})):this._isHoriz?c.setOuterSize(b,null,d+a):c.setOuterSize(b,d+a,null),this.callHooks("onResizing",b))}}),DEFINE_CLASS("DlWM",DlContainer,function(a,b,c){function d(a){a.on_dlgShow(this)}function e(a){a.on_dlgHide(this)}function f(a,b){return a.x<b.x?-1:a.x>b.x?1:0}function g(a,b){return a.y<b.y?-1:a.y>b.y?1:0}function h(a,b){var c=a.length,d=Math.floor(b.x/c),e=0;a.mergeSort(f).foreach(function(a,f){a.y=0,a.x=e,a.h=b.y,f==c-1?a.w=b.x-e:a.w=d,e+=d})}function i(a,b){var c=a.length,d=Math.floor(b.y/c),e=0;a.mergeSort(g).foreach(function(a,f){a.x=0,a.y=e,a.w=b.x,f==c-1?a.h=b.y-e:a.h=d,e+=d})}b.getInnerSize=b.getOuterSize=b.getSize=function(){return this.parent?this.parent.getInnerSize():c.getWindowSize()},b.initDOM=function(){var b;a.BASE.initDOM.apply(this,arguments),this.getElement().innerHTML="<div class='DlWM-modalStopper'></div>",this.dialogsVisible=[],this.modalsVisible=0,this._manageEvents={onShow:d.$(null,this),onHide:e.$(null,this)},b=this.on_parentResize.$(this),this.parent?this.parent.addEventListener("onResize",b):c.addEvent(window,"resize",b)},b.getModalStopperElement=function(){return this.getElement().childNodes[0]},b.activatePrev=function(){var a=this.dialogsVisible;a.length>1&&(a.peek().deactivate(),a.unshift(a.pop()),top=a.pop(),top.activate())},b.activateNext=function(){var a=this.dialogsVisible;a.length>1&&a[0].activate()},b.getActiveDialog=function(){return this.dialogsVisible.peek()},b.updateZIndex=function(){this.dialogsVisible.r_foreach(function(a,b){a.zIndex((a.__modal?900:500)+b)})},b.getVisibleDialogs=function(){return this.dialogsVisible},b.getAllDialogs=function(){return this.children().grep(function(a){return a instanceof DlDialog})},b.appendWidget=function(b){a.BASE.appendWidget.apply(this,arguments),b instanceof DlDialog&&this.manage(b)},b.removeWidget=function(b){a.BASE.removeWidget.apply(this,arguments),b instanceof DlDialog&&this.unmanage(b)},b.manage=function(a){a.addEventListener(this._manageEvents)},b.unmanage=function(a){a.removeEventListener(this._manageEvents)},b.on_dlgShow=function(a){a.__modal&&this.modalsVisible++,this.condClass(this.modalsVisible>0,"DlWM-hasModals")},b.on_dlgHide=function(a){a.__modal&&this.modalsVisible--,this.condClass(this.modalsVisible>0,"DlWM-hasModals"),this.dialogsVisible.length==0&&this.parent&&this.parent.focus()},b.on_parentResize=function(){this.dialogsVisible.foreach(function(a){a.__maximized&&a.__doMaximize()}),this.callHooks("onResize")},b.rearrange=function(a){var b=this.dialogsVisible.map(function(a){var b=a.getOffsetPos(),c=a.getOuterSize();return{dlg:a,x:b.x,y:b.y,w:c.x,h:c.y}});a(b,this.getInnerSize()),b.foreach(function(a){a.dlg.setPos(a.x,a.y),a.dlg.setSize({x:a.w,y:a.h})})},b.tileHoriz=function(){this.rearrange(h)},b.tileVert=function(){this.rearrange(i)},DlContainer.prototype._makeWindowManager=function(){return this.__wm||(this.__wm=new DlWM({parent:this})).addEventListener("onDestroy",function(){this.__wm=null}.$(this)),this.__wm}}),DEFINE_CLASS("DlDialog",DlContainer,function(a,b,c){function l(){var a=c.CE_CACHE["DlDialog.EVENT_STOPPER"];return a||(a=c.CE_CACHE["DlDialog.EVENT_STOPPER"]=k("div",null,{className:"DYNARCH-EVENT-STOPPER"},document.body)),a.style.visibility="",a}function m(){var a=c.CE_CACHE["DlDialog.EVENT_STOPPER"];return a&&(a.className="DYNARCH-EVENT-STOPPER",a.style.visibility="hidden"),a}function n(a){var b,d,e;if(!this.dragging&&!this.__maximized){DlPopup.clearAllPopups(),this.activate(),this.dragging=!0,a||(a=window.event),b=a instanceof DlEvent?a:new DlEvent(a),this.addClass("DlDialog-Dragging"),this._dragPos=b.computePos(this),this._setDragCaptures(!0),h(l(),"CURSOR-DRAGGING"),this.__moveDelay!=null&&(d=this.getResizeRect(),h(d,"Dl-ResizeRect-moving"),e=this.getOuterSize(),c.setPos(d,b.elPos.x,b.elPos.y),c.setOuterSize(d,e.x,e.y),d.style.display="");if(b!==a)return c.stopEvent(a)}}function o(a){a.ctrlKey&&a.shiftKey&&(a.button==0&&this._dragHandlers?n.call(this,a):a.button==2&&a.dl_type=="onContextMenu"&&this._resizable&&(u.call(this,a),g()))}function p(a){var b,c;this.dragging&&(b=this.getResizeRect(),this.dragging=!1,this.delClass("DlDialog-Dragging"),this._setDragCaptures(!1),this.__moveDelay!=null&&(a?(c=q.call(this,a),this.__doDrag.doItNow(c.x,c.y)):this.__doDrag.cancel()),i(b,"Dl-ResizeRect-moving"),b.style.display="none",m())}function q(a){var b,c,d,e,f=this.parent;return a.computePos(f.getContentElement()),b=a.relPos.x-this._dragPos.x,c=a.relPos.y-this._dragPos.y,d=this.getOuterSize(),e=f.getInnerSize(),b<0?b=0:b+d.x>e.x&&(b=e.x-d.x),c<0?c=0:c+d.y>e.y&&(c=e.y-d.y),{x:b,y:c}}function r(a){var b=a.x,d=a.y;a=c.getPos(this.parent.getContentElement()),b+=a.x,d+=a.y,c.setPos(this.getResizeRect(),b,d)}function s(a,b){this.setPos(a,b),this.__oldDlgPos=this.getOffsetPos()}function t(a){var b=q.call(this,a);this.__moveDelay!=null&&r.call(this,b),this.__doDrag(b.x,b.y),g()}function u(a){var b,d,e,f;this.resizing||(this.resizing=!0,a||(a=window.event),b=a instanceof DlEvent?a:new DlEvent(a),this._dragPos=b.computePos(this),d=this.getOuterSize(),this._dragPos.x-=d.x,this._dragPos.y-=d.y,e=this.getPos(),f=this.getResizeRect(),c.setPos(f,e.x,e.y),c.setOuterSize(f,d.x,d.y),f.style.display="",this.addClass("DlDialog-Resizing"),this._setResizeCaptures(!0),h(l(),"CURSOR-DRAGGING"),w.call(this,b,!0),b!==a&&c.stopEvent(a))}function v(){var b,d;this.resizing&&(this.disableHooks("onResize"),this.getElement().style.overflow="hidden",b=this.getResizeRect(),d=c.getOuterSize(b),c.setPos(b,0,0),b.style.display="none",this.delClass("DlDialog-Resizing"),this.setOuterSize({x:d.x,y:d.y}),is_gecko&&a.BASE.setOuterSize.call(this,{x:"auto",y:"auto"}),this.resizing=!1,this._setResizeCaptures(!1),this.getElement().style.overflow="",m(),this.enableHooks("onResize"),this.callHooks("onResize"))}function w(a,b){var d,e;this.resizing&&(d=this.getResizeRect(),e=c.getPos(d),e.x=a.pos.x-this._dragPos.x-e.x-2,e.x<100&&(e.x=100),e.y=a.pos.y-this._dragPos.y-e.y-2,e.y<100&&(e.y=100),this._resizable===1&&(e.y=null),this._resizable===2&&(e.x=null),c.setInnerSize(d,e.x,e.y),b||g())}function x(a){var b,c=DlSystem();a?(this.callHooks("onShow"),this.activate(),this.setModal(this.__modal,!0),c.applyHooks("on-dialog-show",[this]),this.__maximized&&this.__doMaximize.delayed(1,this)):(b=this.parent.getVisibleDialogs(),b.remove(this),this.callHooks("onHide"),this.deactivate(),c.applyHooks("on-dialog-hide",[this]),b.length>=1&&b.peek().activate())}function y(a){var b;if(a.shiftKey||a.altKey)b=this.__dlgOpacity,b==null&&(b=100),a.wheelDelta>0?b+=.05:b-=.05,b=this.__dlgOpacity=b.limit(.1,1),this.opacity(b),g()}function z(a,b){var c=a.getRelElement().childNodes;return c[c.length-b]}var d,e,f,g=DlException.stopEventBubbling,h=c.addClass,i=c.delClass,j=c.condClass,k=c.createElement;a.DEFAULT_EVENTS=["onShow","onHide","onActivate","onQuitBtn"],a.DEFAULT_ARGS={_title:["title","DlDialog"],_noEmptyTitle:["noEmptyTitle",!0],_fixed:["fixed",!1],_resizable:["resizable",!1],_focusable:["focusable",!0],_iconClass:["iconClass",null],_focusedWidget:["focusDefault",null],__noShadows:["noShadows",!1],__quitBtn:["quitBtn",!1],__maxBtn:["maxBtn",!0],__modal:["modal",!1],__moveDelay:["moveDelay",5e3]},a.FIXARGS=function(b){b.parent||(b.parent=a.getTopWM()),b.parent instanceof DlWM||(b.parent instanceof DlDialog&&(b.noShadows=!0),b.parent=b.parent._makeWindowManager())},a.CONSTRUCT=function(){this.__doDrag=this.__moveDelay!=null?s.clearingTimeout(this.__moveDelay,this):s.$(this),this.active=!1},a.getTopWM=function(){return d||(d=new DlWM({className:"DlTopWindowManager"}),document.body.appendChild(d.getElement())),d},e="<table cellspacing='0' cellpadding='0'><tr><td><div class='DlDialog-Rel'><div class='DlDialog-WindowButtons'></div><div class='DlDialog-Title'><div></div></div><div class='DlDialog-Content'></div></div></td></tr></table>",f={x:-3e4,y:-3e4},b._setDragCaptures=function(a){DlEvent[a?"captureGlobals":"releaseGlobals"](this._dragHandlers)},b._setResizeCaptures=function(a){DlEvent[a?"captureGlobals":"releaseGlobals"](this._resizeHandlers)},a.activateEventStopper=function(a){return a?l():m()},b.setOuterSize=b.setSize=function(a){a=Object.makeCopy(a),a.y!=null&&(a.y-=this.getTitleElement().offsetHeight),this.setInnerSize(a)},b.hide=function(){this.display()&&c.elementIsVisible(this.getElement())&&(this.__oldDlgPos=this.getOffsetPos(),this.display(!1),this.setPos(f))},b.show=function(a){this.__wasDisplayed||this.setStyle({visibility:""}),!this.display()||!this.__wasDisplayed?(this.__oldDlgPos?this.setPos(this.__oldDlgPos):a&&this.centerOnParent(),this.display(!0)):this.activate(),this.__wasDisplayed=!0},b.activate=function(){var a=this.parent.getVisibleDialogs(),b=a.peek();this.active||(b&&b.active&&b.deactivate(!0),this.addClass("DlDialog-Active"),a.remove(this),a.push(this),this.parent.updateZIndex(),this.active=!0,this.focus(),this._focusedWidget&&!this._focusedWidget.destroyed&&this._focusedWidget.focus(),this.applyHooks("onActivate",[!0]))},b.deactivate=function(){this.active&&(this.delClass("DlDialog-Active"),this.active=!1,this.blur(),this.applyHooks("onActivate",[!1]))},b._createElement=function(){var b,c,d;a.BASE._createElement.call(this),this.setPos(f),this.setStyle({visibility:"hidden"}),this.getElement().innerHTML=e,b=this.getRelElement(),!this.__noShadows&&!is_ie6?b.insertBefore(DlElementCache.get("SHADOWS"),b.firstChild):(this.__noShadows=!0,h(b,"DlDialog-noShadows")),this.title(this._title),this.setUnselectable(this.getTitleElement()),c=this.__quitBtn,c&&(d=this.__quitBtn=new DlAbstractButton({parent:this,className:"DlDialog-QuitBtn",appendArgs:this.getButtonsElement(),classes:{hover:"DlDialog-QuitBtn-hover",active:"DlDialog-QuitBtn-active"}}),c=="destroy"?c=this.destroy.$(this):c=="hide"&&(c=this.hide.$(this)),c instanceof Function?d.addEventListener("onClick",c):d.connectEvents("onClick",this,"onQuitBtn")),this._resizable&&this.makeResizable(),this.setIconClass(this._iconClass),this._fixed||this.makeDraggable(),this.addEventListener({onMouseDown:this.activate,onMouseWheel:y,onDisplay:x,onDestroy:this.hide})},b.setIconClass=function(a){var b=this.getTitleElement().firstChild;j(b,a!=null,"DlDialog-Title-withIcon"),this.iconClass&&i(b,this.iconClass),a&&h(b,a),this.iconClass=a},b.getState=function(){var a=this.__maximized&&this.__maximizeSavePos;return a?a=Object.makeDeepCopy(a):a={pos:this.getOffsetPos(),size:this.getOuterSize()},a.max=!!this.__maximized,a},b.maximize=function(a){var b,c;a==null&&(a=this.__maxBtn.checked()),this.__maximized=a,a&&(b=this.getOffsetPos(),c=this.getOuterSize(),this.__maximizeSavePos={pos:b,size:c}),this.condClass(a,"DlDialog-Maximized"),a?this.__doMaximize():(b=this.__maximizeSavePos,c=b.size,b=b.pos,this.setOuterSize({x:c.x,y:c.y}),this.setPos(b.x,b.y)),this.__maxBtn.checked(a,!0),this._focusedWidget&&!this._focusedWidget.destroyed&&this._focusedWidget.focus()},b.__doMaximize=function(){var a;this.setPos(0,0),a=this.parent.getInnerSize(),this.setOuterSize({x:a.x,y:a.y})},b.setModal=function(a,b){b||(this.__modal=a),this.display()&&this.parent.updateZIndex()},b.modal=function(){return this.__modal},b.makeResizable=function(){var a,b;this._resizeHandlers||(this.getContentElement().style.overflow="hidden",a=this.getRelElement(),b=k("div",null,{className:"ResizeHandle"},null),a.insertBefore(b,a.firstChild),this._resizeHandlers={onMouseMove:w.$(this),onMouseUp:v.$(this),onMouseOver:g,onMouseOut:g,onMouseEnter:g,onMouseLeave:g},c.addEvent(b,"mousedown",u.$(this)),this.resizing=!1,this.__maxBtn&&(this.__maxBtn=new DlAbstractButton({parent:this,className:"DlDialog-MaximizeBtn",appendArgs:this.getButtonsElement(),type:DlAbstractButton.TYPE.TWOSTATE,classes:{hover:"DlDialog-MaximizeBtn-hover",active:"DlDialog-MaximizeBtn-active",checked:"DlDialog-MaximizeBtn-1"}}),this.__maxBtn.addEventListener("onChange",this.maximize.$0(this,null))))},b.makeDraggable=function(a){a||(a=this.getTitleElement(),a.style.cursor="default",this.addEventListener(["onMouseDown","onContextMenu"],o)),this._dragHandlers||(this._dragHandlers={onMouseMove:t.$(this),onMouseUp:p.$(this),onMouseOver:g,onMouseOut:g,onMouseEnter:g,onMouseLeave:g},this.dragging=!1),c.addEvent(a,"mousedown",n.$(this))},b.title=function(a){return a!=null&&(a instanceof Array&&(a=a.join("")),this._title=a,this.getTitleElement().firstChild.innerHTML=a,this._noEmptyTitle&&(this.getTitleElement().style.display=/\S/.test(a)?"":"none")),this._title},b._handle_focusKeys=function(a){var b;!a.altKey&&!a.ctrlKey&&(a.keyCode==DlKeyboard.ESCAPE?!this.dragging&&this.__quitBtn?this.__quitBtn.keyClicked(a):this.dragging&&p.call(this):a.keyCode==DlKeyboard.TAB&&(b=a.focusedWidget,b=a.shiftKey?this.getPrevFocusWidget(b):this.getNextFocusWidget(b),b&&b.focus(),a.domStop=!0,g())),this._handleKeybinding(a)},b.getRelElement=function(){return this.getElement().firstChild.rows[0].cells[0].firstChild},b.getContentElement=function(){return z(this,1)},b.getTitleElement=function(){return z(this,2)},b.getButtonsElement=function(){return z(this,3)},b.centerOnParent=function(){var a=this.getOuterSize(),b=this.parent.getOuterSize();this.setPos((b.x-a.x)/2,(b.y-a.y)/2)},b.getWM=function(){return this.parent},DlWidget.prototype.getParentDialog=function(){var b=this.parent;while(b&&!(b instanceof a))b=b.parent;return b}}),DEFINE_CLASS("DlDialogPopup",DlPopup,function(a){a.FIXARGS=function(a){a.autolink=!1,a.zIndex=5e3}}),DEFINE_CLASS("DlRecord",DlEventProxy,function(a,b){a.DEFAULT_EVENTS=["onChange"],a.DEFAULT_ARGS={_data:["data",null],_set:["recordSet",null]},b.id=function(){return this._data.id},b.get=function(a){return this._data[a]},b.set=function(a,b,c){var d,e=this._data[a];this._data[a]=b,c||(d=[this,a,b,e],this.applyHooks("onChange",d),this._set&&this._set.applyHooks("onChange",d))},b.compareTo=function(a,b){var c=this.get(b),d=a.get(b);return c<d?-1:c==d?0:1}}),DEFINE_CLASS("DlRecordCache",DlEventProxy,function(a,b){a.DEFAULT_EVENTS=["onChange","onInsert","onBeforeDelete","onDelete","onRefresh"],a.DEFAULT_ARGS={_data:["data",null]},a.CONSTRUCT=function(){this._init()},b.get=function(a){return this._data[a]},b.hasRecord=function(a){return this.get(a)},b.getRecords=function(a,b,c){b.call(c,a.map(this.get,this))},b.getAllIds=function(){return Array.hashKeys(this._data)},b.getAllRecords=function(){return Array.hashValues(this._data)},b.getHash=function(){return this._data},b.formatHTML=function(a,b,c,d){var e=d?d.format(a,this):null;e==null&&(e=(a.get(b)+"").htmlEscape()),c(e)},b.getRecClass=function(){},b.getCellClass=function(){},b.getInsertPos=function(){},b.insert=function(a,b){b==null&&(b=this.getInsertPos(a)),this._data[a.id()]=a,a._set=this,this.applyHooks("onInsert",[a,b])},b.remove=function(a){this.applyHooks("onBeforeDelete",[this.get(a)]),a instanceof Array?a.foreach(function(a){delete this._data[a]},this):delete this._data[a],this.applyHooks("onDelete",[a])},b.sort=function(a,b,c,d,e,f){var g;b==c&&d!==null?g=a.reverse():g=a.mergeSort(function(a,c){return a=this.get(a),c=this.get(c),a.compareTo(c,b)}.$(this),d),e.call(f,g)},b._init=function(){var a;this._data?(a={},this._data.foreach(function(b){a[b.id()]=b,b._set=this},this),this._data=a):this._data={}}}),DEFINE_CLASS("DlDataGridHeadLabel",DlButton,function(a,b,c){function f(a){var b=a._resizeHandle;return b||(b=a._resizeHandle=new DlWidget({parent:a,className:"DlDataGrid-resizeHandle"}),b.display(!1),b.grid=a.parent,b.addEventListener({onMouseLeave:b.display.$(b,!1),onMouseDown:g}),b._resizeCaptures={onMouseMove:h.$(b),onMouseUp:i.$(b),onMouseOver:e,onMouseOut:e,onMouseEnter:e,onMouseLeave:e}),b}function g(a){var b,d,f;this.dragging=!0,b=DlResizeBar.getDragBar(),d=b.style,this.sl=this.grid.getBodyDiv().scrollLeft,d.left=this.pos-this.sl-1+"px",d.height="100%",d.width=this.getElement().offsetWidth-4+"px",d.top="0px",this.grid.getElement().appendChild(b),f=DlDialog.activateEventStopper(!0),c.addClass(f,"CURSOR-RESIZE-E"),DlEvent.captureGlobals(this._resizeCaptures),this.origW=this.grid.getColWidth(this.col),this.origM=a.pos.x,this.col._button.addClass("DlDataGridHeadLabel-resizing"),e()}function h(a){var b,c=DlResizeBar.getDragBar(),f=this.pos+a.pos.x-this.origM-1,g=f-this.pos,h=this.origW+g;h<d&&(f+=d-h,h=d),f-=this.sl,c.style.left=f+"px",this.width=h,this.diff=g,is_ie||(b=this.col._button.getElement(),b.style.width=b.parentNode.style.width=b.parentNode.parentNode.style.width=h+"px"),e()}function i(a){var b,d;this.dragging=!1,this.grid.getElement().removeChild(DlResizeBar.getDragBar()),b=DlDialog.activateEventStopper(!1),c.delClass(b,"CURSOR-RESIZE-E"),DlEvent.releaseGlobals(this._resizeCaptures),this.width&&(this.grid.setColWidth(this.col,this.width),this.grid._computeColPos()),this.col._button.delClass("DlDataGridHeadLabel-resizing"),is_ie||(d=this.col._button.getElement(),d.style.width=d.parentNode.style.width=d.parentNode.parentNode.style.width=""),this.width=this.diff=this.found=this.col=null,this.parent.callHooks("onMouseMove",a),e()}var d,e;a.FIXARGS=function(a){"contextMenu"in a||(a.contextMenu=this._getContextMenu)},a.CONSTRUCT=function(){var a;this.isSortable()||(a=this._classes=Object.makeCopy(this._classes),a.active=a.hover=null)},d=20,b.setWidth=function(a){this.setOuterSize({x:a})},b.isSortable=function(){return this.col.isSortable()},b._onClick=function(){this.isSortable()&&this.parent._onHeadClick(this.col,this)},b._getContextMenu=function(){var a,b=this._dgContextMenu,c=this.parent;return b?(a=b.buttons,c._cols.foreach(function(b,c){a[c].checked(b.isVisible(),!0)})):(this._dgContextMenu=b=new DlVMenu({}),a=b.buttons=[],c._cols.foreach(function(c,d){var e;c.getMenuLabel()&&(e=a[d]=new DlCheckbox({parent:b,label:c.getMenuLabel(),checked:c.isVisible()}),e.addEventListener("onChange",function(){c.setVisible(this.checked())}))})),b},a.DEFAULT_ARGS={col:["col",null],_focusable:["focusable",!1],_noCapture:["noCapture",!0],_classes:["classes",{active:"DlDataGridHeadLabel-active",hover:"DlDataGridHeadLabel-hover",checked:"DlDataGridHeadLabel-1",unchecked:"DlDataGridHeadLabel-0",empty:"DlDataGridHeadLabel-empty",disabled:"DlDataGridHeadLabel-disabled"}]},e=DlException.stopEventBubbling,a._on_headMouseMove=function(a){var b,c,d,e,g;if(!this._colPos||this.dragging)return;b=this.parent,c=b.getBodyDiv().scrollLeft,d=a.computePos(this).x+c,this._colPos.foreach(function(a){Math.abs(d-a.pos)<4&&(a.col.isResizable()&&(e=a),$BREAK())}),g=f(this),e?(e.col!==g.col&&(g.found=e,g.col=e.col,g.pos=e.pos,g.setPos(e.pos-c)),g.display(!0)):(g.display(!1),g.found=g.col=null)},a._on_headMouseLeave=function(){f(this).display(!1)}}),DEFINE_CLASS("DlGridCol",DlEventProxy,function(a,b){var c;a.DEFAULT_EVENTS=["onChange","onVisibility"],a.DEFAULT_ARGS={_field_id:["id",null],_width:["width",null],_fill:["fill",null],_style:["style",null],_label:["label",null],_menuLabel:["menuLabel",null],_tooltip:["tooltip",null],_iconClass:["iconClass",null],_isSortable:["sortable",!0],_isResizable:["resizable",!0],_cssRule:["cssRule",null],_isVisible:["visible",!0],_format:["format",null]},c={},b.id=function(){return this._field_id},b.getWidth=function(){return this._width},b.getFill=function(){return this._fill},b.getLabel=function(){return this._label},b.getMenuLabel=function(){return this._menuLabel||this._label},b.getTooltip=function(){return this._tooltip},b.getIconClass=function(){return this._iconClass},b.getStyle=function(a,b){return(this._style||c)[a]||b},b.isSortable=function(){return this._isSortable},b.isResizable=function(){return this._isResizable},b.isVisible=function(){return this._isVisible},b.setVisible=function(a){this._isVisible=a,this.applyHooks("onVisibility",[a])},b.sort=function(){},b.format=function(a,b){if(this._format)return this._format(a,b,this.id())}}),DEFINE_CLASS("DlGridDragCol",DlDrag,function(a,b,c){function e(){var a=d;return a||(a=d=c.createElement("div",{display:"none"},{className:"DlDataGrid-drop-col"},document.body)),a}var d;a.CONSTRUCT=function(){this.addEventListener("onStartDrag",function(a){this.grid_pos=a.parent.getPos(),a._onMouseLeave()})},b.startOK=function(){return!0},b.dropOK=function(a,b,c,d){return!d&&c instanceof DlDataGridHeadLabel&&a.parent===c.parent?(this.target=c,this.canDrop=!0):this.canDrop=!1},b.doDrop=function(a){a.parent.reorderColumn(a.col,this.target.col,!this.dropBefore)},b.moving=function(a,b){var c,d,f,g,h,i=this.target,j=e(),k=j.style;this.canDrop&&i?(c=b.computePos(i),d=i.getElement(),f=d.offsetWidth,g=c.x<=f/2,h=i.col.index,g&&h--,h<0?h=0:h=a.parent._headCont._colPos[h].pos-a.parent.getBodyDiv().scrollLeft,k.display="block",k.left=h+this.grid_pos.x+"px",k.top=c.elPos.y+"px",this.dropBefore=g):i&&(this.dropBefore=null,k.display="none")},b.reset=function(){d&&(d.style.display="none"),a.BASE.reset.apply(this,arguments)}}),DEFINE_CLASS("DlSelectionModel",DlEventProxy,function(a,b){a.DEFAULT_EVENTS=["onChange","onReset"],a.CONSTRUCT=function(){this.sel||(this.sel={})},a.DEFAULT_ARGS={multiple:["multiple",!0],sel:["sel",null]},b.reset=function(a,b){var c=this.sel;this.sel=a.toHash(!0),b||this.applyHooks("onReset",[c,this.sel])},b.clear=function(a){this.reset([],a)},b.get=function(){return this.sel},b.getArray=function(){return Array.hashKeys(this.sel)},b.getFirst=function(){var a;for(a in this.sel)return a},b.isSelected=function(a){return this.sel[a]},b.size=function(){var a,b=0;for(a in this.sel)b++;return b},b.filter=function(a){var b,c=[];for(b in this.sel)b in a||c.push(b);this.unselect(c)},b.select=function(a,b){var c,d=this.sel,e=null;return a instanceof Array?(c={},a.foreach(function(a){d[a]||(d[a]=c[a]=!0,e=!0)},this),!b&&e!=null&&this.applyHooks("onReset",[{},c])):d[a]||(d[a]=!0,b||this.applyHooks("onChange",[a,!0]),e=!0),e},b.unselect=function(a,b){var c,d=this.sel,e=null;return a instanceof Array?(c={},a.foreach(function(a){d[a]&&(delete d[a],c[a]=!0,e=!1)},this),!b&&e!=null&&this.applyHooks("onReset",[c,{}])):d[a]&&(delete d[a],b||this.applyHooks("onChange",[a,!1]),e=!1),e},b.toggle=function(a,b){return this.sel[a]?this.unselect(a,b):this.select(a,b)}}),DEFINE_CLASS("DlDataGrid",DlContainer,function(a,b,c){function j(a){var b,c,d,e,f,g=a.target;try{while(g&&g.tagName){f=g.tagName.toLowerCase();if(f=="div"&&(d=g.getAttribute("recid"))!=null){b=g;break}!e&&f=="td"&&(c=g,e=g.getAttribute("colid")),g=g.parentNode}}catch(h){}return b?{row:b,col:c,id:d,col_id:e}:null}function k(){var a,b,d,e,f,g,h,i,j;if(this._processing_scroll)return;this._processing_scroll=!0,a=this.getBodyDiv(),b=a.scrollTop,this.getHeaderTable().style.marginLeft=-a.scrollLeft+"px";if(this._vScroll&&this._records&&b!=this._oldScroll){d=this.getRowsContainer(),e=this._records.array,f=this._info_display,g=this.getBoundRecords(),h=g.first,i=g.last,g=g.h;if(h<f.first_row_index||i>f.last_row_index)i<f.first_row_index||h>f.last_row_index?(j=e.slice(h,h+this._rpp),this._display_ids(j,g*h)):h<f.first_row_index?(j=e.slice(h,f.first_row_index),this.__scrollConts++,this.__cont=function(a){var b,e,i,j,k,l=String.buffer("<div>"),m=a.length;a.foreach(this._fetchRowHTML.$(this,l)),l("</div>"),b=l.get(),e=c.createFromHtml(b);try{j=document.createRange(),k=d.childNodes,j.selectNodeContents(e),i=j.extractContents(),j.detach(),j=document.createRange(),j.setStartBefore(k[k.length-m]),j.setEndAfter(k[k.length-1]),j.deleteContents()}catch(n){i||(i=document.createDocumentFragment());while(e.firstChild)d.removeChild(d.lastChild),i.appendChild(e.firstChild)}d.insertBefore(i,d.firstChild),this._setVScroll(g*h),f.first_row_index=h,f.last_row_index-=m},this._fetch_data(j,-1,function(a){this.__scrollConts--,this.__scrollConts==0&&this.__cont(a)})):i>f.last_row_index&&(j=e.slice(f.last_row_index+1,i+1),this.__scrollConts++,this.__cont=function(a){var b,e,h,j,k=String.buffer("<div>"),l=a.length;a.foreach(this._fetchRowHTML.$(this,k)),k("</div>"),b=k.get(),e=c.createFromHtml(b);try{j=document.createRange(),j.selectNodeContents(e),h=j.extractContents(),j.detach(),j=document.createRange(),j.setStartBefore(d.firstChild),j.setEndBefore(d.childNodes[l]),j.deleteContents()}catch(m){h||(h=document.createDocumentFragment());while(e.firstChild)d.removeChild(d.firstChild),h.appendChild(e.firstChild)}d.appendChild(h),this._setVScroll(this._getVSScrollDiv().offsetHeight+g*l),f.first_row_index+=l,f.last_row_index=i},this._fetch_data(j,1,function(a){this.__scrollConts--,this.__scrollConts==0&&this.__cont(a)}));this._oldScroll=b}this.callHooks("onBodyScroll"),this._processing_scroll=!1}var d,e,f=c.addClass,g=c.delClass,i=c.condClass;a.DEFAULT_EVENTS=["onBodyDblClick","onBodyScroll","onRowClick","onRowDblClick","onResetIds"],a.CONSTRUCT=function(){this.__scrollConts=0},d=DlException.stopEventBubbling,a.DEFAULT_ARGS={_records:["records",null],_selection:["selection",null],_data:["data",null],_page:["page",0],_rpp:["rpp",60],_minReqRows:["minReq",null],_threshold:["threshold",null],_vScroll:["virtualScrolling",!0],_cols:["cols",null],_headType:["headType",DlDataGridHeadLabel],_focusable:["focusable",!0],_rtClickKeepSel:["rightClickKeepsSel",!1],_noReselect:["noReselect",!1],_rarify:["rarifyScroll",null]},e=String.buffer("<div class='DlDataGrid-Headers'>","<table class='DlDataGrid-rowTable' cellspacing='0' cellpadding='0'>","<tbody><tr></tr></tbody>","</table></div>","<div class='DlDataGrid-Body'>","<div class='DlDataGrid-VSHeight'>","<div class='DlDataGrid-VSHeight-before'></div>","<div class='DlDataGrid-RowsCont'></div>","</div>","</div>").get(),b.getHeaderDiv=function(){return this.getElement().firstChild},b.getHeaderTable=function(){return this.getHeaderDiv().firstChild},b.getHeaderRow=function(){return this.getHeaderDiv().firstChild.rows[0]},b.getBodyDiv=function(){return this.getElement().childNodes[1]},b._getVSHeightDiv=function(){return this.getBodyDiv().firstChild},b._getVSScrollDiv=function(){return this._getVSHeightDiv().firstChild},b.getRowsContainer=function(){return this._getVSHeightDiv().childNodes[1]},b.resetIDS=function(a){var b={},c=this._selection;a.foreach(function(a,c){b[a]=c}),this._records={array:a,id_to_pos:b},c.filter(b),c.getArray().length==0&&(c._last=null),this.callHooks("onResetIds")},b._fetch_data=function(a,b,c){var d,e,f,g,h,i,j,k=this._minReqRows,l=a.length,m=this._data;if(k!=null&&k>l){d=a.slice(0),e=this._records.array,g=this._threshold||Math.ceil(this._rpp/2);if(b<=0){h=this._records.id_to_pos[a[0]],i=g;while(i-->0)if(!m.hasRecord(e[--h]))break;if(i>0)for(f=h;f>=0&&d.length<k;f--)j=e[f],m.hasRecord(j)||d.push(j)}if(b>=0){h=this._records.id_to_pos[a.peek()],i=g;while(i-->0)if(!m.hasRecord(e[++h]))break;if(i>0)for(f=h;f<e.length&&d.length<k;f++)j=e[f],m.hasRecord(j)||d.push(j)}m.getRecords(d,function(a){c.call(this,a.slice(0,l))},this)}else m.getRecords(a,c,this)},b._display_ids=function(a,b){this._info_display={length:a.length,first_row_index:this._records.id_to_pos[a[0]],last_row_index:this._records.id_to_pos[a.peek()]},this._fetch_data(a,0,function(a){var c=String.buffer();a.foreach(this._fetchRowHTML.$(this,c)),this.getRowsContainer().innerHTML=c.get(),b!=null&&this._setVScroll(b),this._resetVSHeight(),a.length>1?this.scrollToRecord(a[1].id()):this._setVScroll(this.getBodyDiv().scrollTop=0),this.getBoundRecords()})},b.displayPage=function(a){var b,c;a==null&&(a=0),this._page=a,b=this._records.array,this._rpp&&(c=a*this._rpp,b=b.slice(c,c+this._rpp)),this._display_ids(b)},b._resetVSHeight=function(){this._vScroll&&this._info_display&&(h=Math.floor(this.getRowsContainer().offsetHeight*this.getNRecords()/this._info_display.length),this._getVSHeightDiv().style.height=isNaN(h)?"":h+"px")},b._setVScroll=function(a){var b=this._getVSScrollDiv();a?(b.style.height=a+"px",b.style.display="block"):b.style.display="none"},b.initWidths=function(){var a,b,c,d,e,f,g={};this._cols.foreach(function(a){g[a.id()]=this.getColWidth(a)},this),a=this.getRowsContainer();for(b=a.firstChild;b;b=b.nextSibling){c=b.firstChild.rows[0].cells;for(d=c.length;--d>=0;)e=c[d],f=e.getAttribute("colid"),g[f]=Math.max(g[f]||0,e.offsetWidth)}this._cols.foreach(function(a){this.setColWidth(a,g[a.id()])},this)},b.resetColumns=function(a){var b,c=this.getHeaderRow(),d=c.cells,e=[];this._cols=a.map(function(a,b){var c=this._colsById[a.id];return e.push(c._cell),c.index=b,c._width=a.width,c._isVisible=a.visible,c},this),b=document.createDocumentFragment(),e.foreach(function(a){b.appendChild(a)}),c.appendChild(b),this.refreshDisplay(),this._cols.foreach(function(a){this.setColVisible(a,a.isVisible()),this.setColWidth(a,a.getWidth())},this)},b.reorderColumn=function(a,b,c){var a,b,d,e,f,g=a.index,h=b.index;c&&h++,d=this._cols,d.splice(g,1),d.splice(g<h?h-1:h,0,a);for(e=0;e<d.length;++e)d[e].index=e;for(e=this.getRowsContainer().firstChild;e;e=e.nextSibling)f=e.firstChild.rows[0].cells,a=f[g],b=f[h],a.parentNode.insertBefore(a,b||null);f=this.getHeaderRow().cells,a=f[g],b=f[h],a.parentNode.insertBefore(a,b||null),this._computeColPos()},b.getNRecords=function(){return this._records?this._records.array.length:0},b.getNPages=function(){return this._rpp?Math.ceil(this.getNRecords()/this._rpp):1},b.rec_isSelected=function(a){return this._selection.isSelected(a.id())},b._computeColPos=function(){var a=-1;this._headCont._colPos=this._cols.map(function(b){return a+=this.getColWidth(b),{pos:a,col:b}},this)},b._createElement=function(){var b;a.BASE._createElement.call(this),this.getElement().id=this.id,this._ss=new DlStyleSheet,this._cssPrefix="#"+this.id,this.setContent(e),this._initHeaders(),this.getBodyDiv().onscroll=this._rarify?k.rarify(this._rarify.calls,this._rarify.timeout,this):k.$(this),b=this._headCont=new DlContainer({parent:this,element:this.getHeaderDiv()}),b.addEventListener({onMouseMove:DlDataGridHeadLabel._on_headMouseMove,onMouseLeave:DlDataGridHeadLabel._on_headMouseLeave,onMouseEnter:this._computeColPos.$(this)}),this._bodyCont=new DlContainer({parent:this,element:this.getBodyDiv(),drag:this._dragArgs}),this._dragArgs=null,"onMouseOver onMouseOut onMouseDown onMouseUp onMouseLeave onDblClick".qw().foreach(function(a){this.addEventListener(a,this["_body_"+a])},this),this._cacheEvents={onChange:this._data_onChange.$(this),onInsert:this._data_onInsert.$(this),onDelete:this._data_onDelete.$(this),onRefresh:this._data_onRefresh.$(this)},this.setCache(this._data),this.addEventListener("onDestroy",this._onDestroy),this._records&&this.resetIDS(this._records),this._sel_events={onChange:this._sel_onChange.$(this),onReset:this._sel_onReset.$(this)},this._selection||(this._selection=new DlSelectionModel({})),this.setSelectionModel(this._selection)},b._onDestroy=function(){this._ss.destroy(),this.setCache(null)},b.setCache=function(a){this._data&&this._data.removeEventListener(this._cacheEvents),this._data=a,a&&a.addEventListener(this._cacheEvents)},b._data_onChange=function(a){var b,d,e=this.getRowElement(a.id());e&&(b=String.buffer(),this._fetchRowHTML(b,a),b=b.get(),is_ie?e.outerHTML=b:(d=c.createFromHtml(b),c.trash(e.parentNode.replaceChild(d,e))))},b._data_onInsert=function(a,b){var c=this._records.array;b==null&&(b=c.length),c.splice(b,0,a.id()),this.resetIDS(c),this.refreshDisplay()},b._data_onDelete=function(a){var b=this._records.array;a instanceof Array?a.foreach(function(a){this.remove(a)},b):b.remove(a),this.resetIDS(b),this.refreshDisplay()},b._data_onRefresh=function(){},b._recompDynamicWidths=function(){var a=this.getBodyDiv().clientWidth,b=[];this._cols.foreach(function(c){c.getFill()==null?a-=this.getColWidth(c):b.push(c)},this),a-=1,b.foreach(function(b){this.setColWidth(b,a*b.getFill())},this)},b._initHeaders=function(){this._colsById={},this._cols.foreach(function(a,b){var c,d,e,f,g,h;a instanceof DlGridCol||(a=this._cols[b]=new DlGridCol(a)),a.addEventListener("onVisibility",this.setColVisible.$(this,a)),a.index=b,this._colsById[a.id()]=a,c="DlDataGrid-col-"+a.id(),d=this._cssPrefix+" ."+c,d=d+","+d+" .DlDataGrid-cellData",e=[],f=a.getWidth(),typeof f=="number"&&e.push("width:"+f+"px"),e=e.join(";"),a._cssRule=this._ss.insertRule(d,e),a.isVisible()||this._ss.modifyRule(a._cssRule,{display:"none"}),g=a._cell=document.createElement("td"),g.innerHTML="<div class='DlDataGrid-cellData'></div>",g.className=c,this.getHeaderRow().appendChild(g),h=this._makeHeadLabel({parent:this,appendArgs:g.firstChild,iconClass:a.getIconClass(),label
:a.getLabel(),col:a,className:"DlGrid-align-"+a.getStyle("textAlign","left"),tooltip:a.getTooltip.$(a),drag:this._getDragObject()}),a._button=h},this)},b.findRowFromEvent=function(a){return j(a)},b._sel_onChange=function(a,b){var c=this.getRowElement(a);c&&i(c,b,"DlDataGridRow-selected")},b._sel_onReset=function(a,b){var c,d;for(c in a)b[c]||(d=this.getRowElement(c),d&&g(d,"DlDataGridRow-selected"));for(c in b)a[c]||(d=this.getRowElement(c),d&&f(d,"DlDataGridRow-selected"))},b.setSelectionModel=function(a){this._selection&&this._selection.removeEventListener(this._sel_events),this._selection=a,a.addEventListener(this._sel_events)},b._body_onDblClick=function(a){var b;this.callHooks("onBodyDblClick"),b=j(a),b&&this.callHooks("onRowDblClick",b)},b._body_onMouseOver=function(a){var b=j(a);b&&this.__tooltip instanceof Function&&(this._tooltipRow=b,DlWidget.getTooltip().popup({timeout:this.__tooltipTimeout,content:this.__tooltip.$(this,b),anchor:this.getElement(),align:"mouse",onPopup:this.__onTooltipShow,onHide:this.__onTooltipHide,widget:this}))},b._body_onMouseOut=function(a){var b=j(a);b&&(DlWidget.getTooltip().hide(),this._tooltipRow=null)},b._body_onMouseLeave=function(){},b.__handleSelectClick=function(a,b){var c,d,e,f=this._selection,g=this._records;if(f.multiple)b.button==2?this._rtClickKeepSel||(b.ctrlKey?(this.callHooks("onRowClick",a,b,{rtc:!0,ctrl:!0,type:"select",ids:[a.id]}),f.select([a.id])):f.isSelected(a.id)||(this.callHooks("onRowClick",a,b,{rtc:!0,type:"reset",ids:[a.id]}),f.reset([a.id]))):b.ctrlKey?(this.callHooks("onRowClick",a,b,{ctrl:!0,type:"toggle",ids:[a.id]}),f.toggle(a.id),f._last=a.id):b.shiftKey?f._last!=null?(c=g.id_to_pos[f._last],d=g.id_to_pos[a.id],e=g.array.slice(Math.min(c,d),Math.max(c,d)+1),this.callHooks("onRowClick",a,b,{shift:!0,type:"reset",ids:e}),f.reset(e)):(this.callHooks("onRowClick",a,b,{shift:!0,type:"toggle",ids:[a.id]}),f.toggle(a.id),f._last=a.id):(this.callHooks("onRowClick",a,b,{type:"reset",ids:[a.id]}),f.reset([a.id]),f._last=a.id);else if(!this._noReselect||!f.isSelected(a.id))this.callHooks("onRowClick",a,b,{type:"reset",ids:[a.id]}),f.reset([a.id]),f._last=a.id},b._body_onMouseUp=function(a){var b=j(a),c=this.__handleOnMouseUp;b&&c&&b.id==c.id&&this.__handleSelectClick(b,a)},b._body_onMouseDown=function(a){var b=j(a),c=this._selection;b&&(this.__handleOnMouseUp=!c.isSelected(b.id)||!this._bodyCont._dragArgs||a.ctrlKey||a.shiftKey?null:b,this.__handleOnMouseUp||this.__handleSelectClick(b,a),a.button!=2&&d())},b.scrollToRecord=function(a,b){var c=this.getRowsContainer(),d=Math.floor(c.offsetHeight/c.childNodes.length),e=d*this._records.id_to_pos[a||this._selection._last],f=this.getBodyDiv(),g=f.scrollTop,h=f.clientHeight;if(b==null)e<g?(f.scrollTop=e,this._setVScroll(d*this._info_display.first_row_index)):e+d>g+h&&(f.scrollTop=e+d-h,this._setVScroll(d*this._info_display.first_row_index));else switch(b){case"top":f.scrollTop=e;break;case"bottom":f.scrollTop=e+d-h;break;case"center":f.scrollTop=(2*e+d-h)/2}},b.scrollHome=function(){this.getBodyDiv().scrollTop=0},b.scrollEnd=function(){this.getBodyDiv().scrollTop=this._getVSHeightDiv().offsetHeight},b.scrollPage=function(a){var b=this.getBodyDiv();b.scrollTop+=a*b.clientHeight-20},b._handle_focusKeys=function(b){var c,e,f,g=this._selection,h=b.keyCode,i=b.charCode,j=this._records;switch(h){case DlKeyboard.ARROW_DOWN:c=-1,g._last!=null&&(c=j.id_to_pos[g._last]),b.shiftKey&&g.multiple?(e=j.array.slice(c,c+2),g.select(e),g._last=e.peek()):(c=j.array.limitIndex(c+1),f=j.array[c],g.reset([f]),g._last=f),this.scrollToRecord(),d();break;case DlKeyboard.ARROW_UP:c=j.array.length,g._last!=null&&(c=j.id_to_pos[g._last]),b.shiftKey&&g.multiple?(e=j.array.slice(c-1,c),g.select(e),g._last=e.peek()):(c=j.array.limitIndex(c-1),f=j.array[c],g.reset([f]),g._last=f),this.scrollToRecord(),d();break;case DlKeyboard.HOME:this.scrollHome(),d();break;case DlKeyboard.END:this.scrollEnd(),d();break;case DlKeyboard.PAGE_UP:this.scrollPage(-1),d();break;case DlKeyboard.PAGE_DOWN:this.scrollPage(1),d()}a.BASE._handle_focusKeys.call(this,b)},b._makeHeadLabel=function(a){return new this._headType(a)},b._onHeadClick=function(a){var b,c;a.isSortable()&&(a=a.id(),b=this.__sortCol||null,c=null,a==b&&(c=!0,this.__sortRev&&(c=!c)),this.__sortRev=c,this.sort(this._records.array,a,b,c,this._handleSort.$(this,a,c)))},b.sort=function(){this._data.sort.apply(this._data,arguments)},b._handleSort=function(a,b,c){this.resetIDS(c),this.refreshDisplay(),this.setSortColumn(a,b)},b.setSortColumn=function(a,b){var c=this.__sortCol;c&&(c=this._colsById[c],c._button.delClass(/DlDataGridHeadLabel-sort-[^\s]+/g)),this.__sortCol=a,a&&this._colsById[a]._button.condClass(b,"DlDataGridHeadLabel-sort-down","DlDataGridHeadLabel-sort-up")},b.getSortColumn=function(){return this.__sortCol},b.getSortReverse=function(){return this.__sortRev},b.getCol=function(a){return a instanceof DlGridCol||(a=this._colsById[a]),a},b.getRec=function(a){return a instanceof DlRecord||(a=this._data.get(a)),a},b.setColWidth=function(a,b){a=this.getCol(a),a._width=b,this._ss.modifyRule(a._cssRule,{width:b+"px"})},b.setColVisible=function(a,b){a=this.getCol(a),this._ss.modifyRule(a._cssRule,{display:b?"":"none"}),a._isVisible=!!b},b.getColWidth=function(a){return a=this.getCol(a),this.getHeaderRow().cells[a.index].offsetWidth},b._getDragObject=function(){return this.__drag||(this.__drag=new DlGridDragCol({})),this.__drag},b._fetchRowContentHTML=function(a,b){var c,d,e,f,g,h,i;a("<table class='DlDataGrid-rowTable' cellspacing='0' cellpadding='0'><tr>"),c=this._cols,d=c.length,e=this._data;for(i=0;i<d;++i)f=c[i],g=f.id(),a("<td colid='",g,"' class='DlDataGrid-col-",g),h=e.getCellClass(b,f.id()),h&&a(" ",h),a("'>"),is_ie&&a("<div class='DlDataGrid-cellData'>"),e.formatHTML(b,f.id(),a,f),is_ie&&a("</div>"),a("</td>");a("</tr></table>")},b._fetchRowHTML=function(a,b){var c="DlDataGrid-row",d=this._data.getRecClass(b);d&&(c+=" "+d),this.rec_isSelected(b)&&(c+=" DlDataGridRow-selected"),a("<div id='",this.id,":",b.id(),"' class='",c,"' recid='",b.id(),"'>"),this._fetchRowContentHTML(a,b),a("</div>")},b.getRowElement=function(a){return document.getElementById(this.id+":"+a)},b.refreshDisplay=function(){var a,b,c,d,e,f,g,h,i;this._oldScroll=null,a=this.getBodyDiv(),b=a.scrollTop,c=this.getRowsContainer(),d=this._records.array,e=this._info_display,this._rpp&&d.length<this._rpp&&this.displayPage(0),this._rpp&&(f=Math.floor(c.offsetHeight/c.childNodes.length),g=Math.ceil(b/f)-1,g<0&&(g=0),h=Math.floor((b+a.clientHeight)/f),h>=d.length&&(h=d.length-1),i=d.slice(g,g+this._rpp),this._display_ids(i,f*g))},b.__doLayout=function(){var a=this.getInnerSize(),b=this.getBodyDiv(),d=this.getHeaderDiv();c.setOuterSize(b,a.x,a.y-d.offsetHeight),c.setOuterSize(d,a.x,null),this._resetVSHeight(),this._records&&this._records.array.length>0&&(this._oldScroll=null,k.call(this)),this._recompDynamicWidths()},b.getBoundRecords=function(){var a,b,c,d=this.getBodyDiv(),e=d.scrollTop,f=this.getRowsContainer(),g=this._records.array,h=f.offsetHeight;return h==0?this.__boundRecords:(a=Math.floor(h/f.childNodes.length),b=Math.ceil(e/a)-1,b<0&&(b=0),c=Math.floor((e+d.clientHeight)/a),c>=g.length&&(c=g.length-1),this.__boundRecords={first:b,last:c,count:c-b+1,h:a})}}),DEFINE_CLASS("DlDragDataGrid",DlDrag,function(a,b){b.startOK=function(a,b){var c=a.parent,d=!1,e=b.target;while(e&&e!=a.getElement()){if(e==c._getVSHeightDiv()){d=!0;break}e=e.parentNode}return d&&c._selection.getArray().length>0?this.grid=c:d=!1,d},b.reset=function(){this.grid=null,a.BASE.reset.apply(this,arguments)}}),DEFINE_CLASS("DlDesktop",DlContainer,function(a,b){var c,d;a.DEFAULT_ARGS={_bounds:["bounds",new DlRect(50,30,800,600)]},b._createElement=function(){var b;a.BASE._createElement.call(this),b=this.getElement(),this._bounds.positionDiv(b),document.body.appendChild(b)},is_ie&&(c=Dynarch.ID("IEsux"),d=function(){var a=document.getElementById(c);a||(a=document.createElement("div"),a.style.position="absolute",a.style.right=a.style.bottom=a.style.width=a.style.height="0px",a.style.zIndex="-100",document.body.appendChild(a)),this.setSize({x:a.offsetLeft,y:a.offsetTop+a.offsetHeight})}),b.fullScreen=function(){var a,b=this.getElement().style;b.top="0px",b.left="0px",b.width="100%",b.height="100%",is_ie?a=d.$(this):a=this.callHooks.$(this,"onResize"),DynarchDomUtils.addEvent(window,"resize",a.clearingTimeout(25))}}),DEFINE_CLASS("DlTable",DlContainer,function(a,b,c){var d=c.createElement;a.FIXARGS=function(a){a.tagName="table",this._colSpan=0},a.DEFAULT_ARGS={__cellSpacing:["cellSpacing",null],__cellPadding:["cellPadding",null],__align:["align",null]},b._createElement=function(){var b;a.BASE._createElement.call(this),b=this.getElement(),this.__cellPadding!=null&&(b.cellPadding=this.__cellPadding),this.__cellSpacing!=null&&(b.cellSpacing=this.__cellSpacing),this.__align!=null&&(b.align=this.__align),d("tbody",null,null,b)},b.getContentElement=function(){return this.getElement().firstChild},b.addRow=function(){return new DlTableRow({parent:this})},b.getRow=function(a){return this.children(a)},b.addCell=function(a,b,c){var d,e,f=new DlTableCell({parent:a});return b!=null&&f.addClass("DlAlign-"+b),c!=null&&(d=f.getElement().style,d.verticalAlign=c),e=f.getElement().cellIndex+1,e>this._colSpan&&(this._colSpan=e),f},b.getColSpan=function(){return this._colSpan},b.setColSpan=function(a){this._colSpan=a},b.addSeparator=function(a){a==null&&(a=this.getColSpan()),d("div",null,{innerHTML:"&nbsp;"},d("td",null,{colSpan:a},d("tr",null,{className:"DlTable-RowSeparator"},this.getContentElement())))}}),DEFINE_CLASS("DlTableRow",DlContainer,function(a){a.DEFAULT_ARGS={_tagName:["tagName","tr"]}}),DEFINE_CLASS("DlTableCell",DlContainer,function(a){a.DEFAULT_ARGS={_tagName:["tagName","td"]}}),DEFINE_CLASS("DlFieldGrid",DlTable,function(a,b){a.CONSTRUCT=function(){this.__fields={}},b.addField=function(a,b,c){var d,e,f,g,h,i,j=a.widget||new DlEntry(a),k=a.label;return b||(b={}),k&&(k instanceof DlWidget?k instanceof DlLabel&&k.setWidget(j):k=new DlLabel({label:a.label.makeLabel(),widget:j})),d=this.addRow(),e=this.addCell(d,"right",a.valign),e.addClass("DlFieldGrid-labelCell"),a.valign=="top"&&k instanceof DlLabel&&(e.getElement().style.paddingTop=a.vtop||"4px"),k&&e.appendWidget(k),b.middleText&&(f=this.addCell(d),f.setContent(b.middleText)),g=this.addCell(d),g.appendWidget(j),h=a.id||a.name,h!=null&&(this.__fields[h]=j.getWidgetId(),delete a.id),b&&(i=g.getElement(),b.colSpan&&(i.colSpan=b.colSpan),b.rowSpan&&(i.rowSpan=b.rowSpan)),c&&(c.row=d,c.c1=e,c.c2=g,c.label=k,c.entry=j),j},b.getField=function(a){return a?DlWidget.getById(this.__fields[a]):this.__fields},b.setField=function(a,b){this.__fields[a]=b.getWidgetId()},b.getValue=function(){var a,b,c,d,e={};for(a in this.__fields)b=this.getField(a),c=b.getFormValue||b.getValue,c instanceof Function&&(b instanceof DlAbstractButton&&b._checkTwoState(!0)?(d=c.call(b),typeof d=="boolean"?e[a]=d:d==null?e[a]=b.checked():b.checked()&&(e[a]=d)):e[a]=c.call(b));return e},b.getValues=b.getValue,b.setValue=function(a){var b,c,d,e;for(b in a)c=this.getField(b),d=a[b],c&&(e=c.setFormValue||c.setValue,e instanceof Function&&(c instanceof DlAbstractButton&&c._checkTwoState(!0)?c.checked(typeof d=="string"?d!="0":!!d):e.call(c,d)))},b.setValues=b.setValue}),DEFINE_CLASS("DlFieldset",DlContainer,function(a,b,c){a.DEFAULT_ARGS={_label:["label","DlFieldset"]},b._createElement=function(){a.BASE._createElement.call(this),this.getElement().innerHTML=["<span class='DlFieldset-label'>",this._label,"</span>","<div class='DlFieldset-content'></div>"].join("")},b.getContentElement=function(){return this.getElement().childNodes[1]},b.getLabelElement=function(){return this.getElement().firstChild},b.setOuterSize=b.setSize=function(a){var b=c.getPos(this.getLabelElement()),d=c.getPos(this.getContentElement()),e=d.y-b.y;c.setOuterSize(this.getElement(),a.x,a.y-e),a=c.getInnerSize(this.getElement()),c.setOuterSize(this.getContentElement(),a.x,a.y),this.callHooks("onResize")}}),function(){var a={},b={};window.DlSingleton={get:function(c,d){return b[c]||!d&&(b[c]=new a[c])},register:function(b,c,d){a[b]=c,d&&(window[b]=this.get.$C(b))}}}(),DEFINE_SINGLETON("DlFlashUtils",DlEventProxy,function(a,b){var c,d,e,f,g;a.DEFAULT_EVENTS=["onLoad","onStorageStatus"],c=is_ie?String.template('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0" width="215" height="138" id="DlFlashUtils-MOVIE" align="middle">','<param name="allowScriptAccess" value="always" />','<param name="movie" value="$url" />','<param name="quality" value="high" />',"</object>"):String.template('<embed id="DlFlashUtils-MOVIE" src="$url" quality="high" bgcolor="#ffffff" width="215" height="138" ','allowScriptAccess="always" ','type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" />'),d=null,window.DlFlashUtils_init=function(){DlFlashUtils().callHooks("onLoad")},b.init=function(){var a;d||(a=c({url:Dynarch.getFileURL("swf/flash.swf")}),document.write("<div style='position: absolute; z-index: 31000; left: -256px; top: 50%; margin-left: -108px; margin-top: -69px; width: 216px; height: 138px;'>"+a+"</div>"),d=document.getElementById("DlFlashUtils-MOVIE"))},b.getObject=function(){return d},b.display=function(a){d.parentNode.style.left=a?"50%":"-256px"};function h(a){var b=null;try{b=a.GetVariable("$version")}catch(c){}return b}e={"ShockwaveFlash.ShockwaveFlash.7":h,"ShockwaveFlash.ShockwaveFlash.6":function(a){var b="Win 6,0,21";try{a.AllowScriptAccess="always",b=h(a)}catch(c){}return b},"ShockwaveFlash.ShockwaveFlash":h},b.isSupported=function(){var a,b,c,d=navigator.plugins;if(d&&d.length){d=d["Shockwave Flash"];if(d&&d.description&&/^Shockwave Flash\s+([^\s]+)/i.test(d.description))return parseFloat(RegExp.$1)>=8}else if(is_ie)for(a in e)try{b=new ActiveXObject(a);if(b){c=e[a](b);if(c!=null)return c=c.split(/\s+/)[1],parseFloat(c)>=8}}catch(f){}return!1},b.loadPolicyFile=function(a){return this.getObject().DlSocket_loadPolicyFile(a)},f=b.decodeString=function(a){return a.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")},g=b.decodeObject=function(a){var b,c;if(a instanceof Array)for(b=a.length;--b>=0;)a[b]=g(a[b]);else if(typeof a=="object"){if(a==null)return a;c={};for(b in a)c[f(b)]=g(a[b]);a=c}else typeof a=="string"&&(a=f(a));return a}}),DlFlashStore={set:function(a,b){DlFlashUtils().getObject().DlStorage_set(a,b)},get:function(a){return DlFlashUtils().decodeObject(DlFlashUtils().getObject().DlStorage_get(a))},getAllKeys:function(){return DlFlashUtils().decodeObject(DlFlashUtils().getObject().DlStorage_getAllKeys())},remove:function(a){DlFlashUtils().getObject().DlStorage_remove(a)},clear:function(){DlFlashUtils().getObject().DlStorage_clear()},flush:function(a){var b=DlFlashUtils().getObject().DlStorage_flush();return a&&b=="pending"&&DlFlashUtils().display(!0),b},_onStatus:function(a){DlFlashUtils().display(!1),DlFlashUtils().applyHooks("onStorageStatus",[a])}},DEFINE_CLASS("DlGridLayout",DlLayout,function(a,b,c){var d,e=c.createElement,f=c.addClass;a.DEFAULT_ARGS={__layout:["layout",null],__layoutHTML:["layoutHTML",null],__cellSpacing:["cellSpacing",0],__cellPadding:["cellPadding",1]},d=["width","padding","paddingLeft","paddingRight","paddingTop","paddingBottom","verticalAlign","textAlign","whiteSpace"],b._createElement=function(){var b,c;a.BASE._createElement.call(this),this.__layoutHTML?(this.setContent(this.__layoutHTML),b=this.getElement().getElementsByTagName("table")[0]):(b=e("table",null,{cellSpacing:this.__cellSpacing,cellPadding:this.__cellPadding,className:"DlGridLayout-table"}),e("tbody",null,null,b),c=this.__layout,c.foreach(function(a){var c=a.props,e=b.insertRow(-1);c&&c.minHeight&&(f(e,"DlGridLayout-tr-minHeight"),e.minHeight=!0),a.cells.foreach(function(a,b){var g=e.insertCell(-1);b==0&&c&&c.height&&(g.style.height=c.height),a&&(a.colSpan&&(g.colSpan=a.colSpan),a.className&&(g.className=a.className),a.rowSpan&&(g.rowSpan=a.rowSpan),a.minWidth&&f(g,"DlGridLayout-td-minWidth"),a.minHeight&&(g.minHeight=!0,f(g,"DlGridLayout-td-minHeight")),d.r_foreach(function(b){var c=a[b];c!=null&&(this[b]=c)},g.style))})}),this.getElement().appendChild(b)),this.refNode("__table",b)},b._appendWidgetElement=function(b,c){var d;c.inCell?(d=this.getCellElement(c.row,c.col),d.appendChild(b.getElement()),b._dllayout_args=c):a.BASE._appendWidgetElement.call(this,b,c)},b._removeWidgetElement=function(b){var c;this._widgets.contains(b)&&(b._dllayout_args.inCell?(c=b.getElement(),c.parentNode.removeChild(c)):a.BASE._removeWidgetElement.call(this,b))},b.getTableElement=function(){return this.__table},b.getCellElement=function(a,b){return this.getTableElement().rows[a].cells[b]},b.doLayout=function(){var a=this.children();2..times(function(b){a.foreach(function(a){var c,d,e,f,g,h,i,j=a._dllayout_args;j.inCell||(c=this.getCellElement(j.row,j.col),d=c.offsetLeft,e=c.offsetTop,f=c.offsetWidth,g=c.offsetHeight,b==0?(h=a.getOuterSize(),(c.minHeight||c.parentNode.minHeight)&&g<h.y&&(c.style.height=h.y+"px")):(i=a.getElement().parentNode.style,i.left=d+"px",i.top=e+"px",a.setOuterSize({x:f,y:g})))},this)},this)},b.showWidgets=function(a){arguments.length==0&&(a=!0),this.children().r_foreach(function(b){b.display(a)})}}),DlHtmlUtils={_blockTags:"body form textarea fieldset ul ol dl dd dt li div blockquote p h1 h2 h3 h4 h5 h6 quote pre table thead tbody tfoot tr td iframe address".hashWords(),_quickTags:"br hr input link meta img".hashWords(),_headingTags:"h1 h2 h3 h4 h5 h6".hashWords(),_descTags:"p blockquote td div li".hashWords(),isBlockElement:function(a){return a&&a.nodeType==1&&a.tagName.toLowerCase()in DlHtmlUtils._blockTags},needsClosingTag:function(a){return a&&a.nodeType==1&&!(a.tagName.toLowerCase()in DlHtmlUtils._quickTags)},htmlEncode:function(a){return(a+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\x22/g,"&quot;").replace(/\u00A0/g,"&#xa0;")},getHTML:function(a,b,c){function q(a,b){var d,e,r,s,t,u,v;switch(a.nodeType){case 11:b=!1;case 1:e=a.tagName.toLowerCase();if(a.className=="DynarchLIB-REMOVE-ME")break;if(b){r=!a.hasChildNodes()&&!h(a);if(e=="br"){if(a.previousSibling&&!a.nextSibling)break;if(p){f[g++]="\n";break}}c&&(k==null&&e in o?(k=j(a),m=0):l==null&&e in n&&(l=j(a))),f[g++]="<",f[g++]=e,s=a.attributes;for(d=0;d<s.length;++d){t=s.item(d);if(!t.specified)continue;u=t.nodeName.toLowerCase();if(/^_moz|^_msh/.test(u))continue;u!="style"?typeof a[t.nodeName]!="undefined"&&u!="href"&&u!="src"&&!/^on/.test(u)?v=a[t.nodeName]:v=t.nodeValue:v=a.style.cssText;if(/(_moz|^$)/.test(v))continue;f[g++]=" "+u+'="'+i(v)+'"'}f[g++]=r?" />":">"}e=="pre"&&++p;for(d=a.firstChild;d;d=d.nextSibling)q(d,!0);e=="pre"&&--p,b&&!r&&(f[g++]="</"+e+">"),m===0&&(m=g);break;case 3:/^(script|style)$/i.test(a.parentNode.tagName)?a.data.indexOf("/*<![CDATA[*/")!=0?(f[g++]="/*<![CDATA[*/",f[g++]=a.data,f[g++]="/*]]>*/"):f[g++]=a.data:f[g++]=a.data.htmlEscape();break;case 4:case 8:f[g++]="<!--",f[g++]=a.data,f[g++]="-->"}}var d,e=DlHtmlUtils,f=[],g=0,h=e.needsClosingTag,i=e.htmlEncode,j=e.getInnerText,k=null,l=null,m=null,n=e._descTags,o=e._headingTags,p=0;return q(a,b),d=f.join(""),c&&(d={title:k,description:l,content:d,contentButTitle:""},m&&(d.contentButTitle=f.slice(m).join(""))),d},getInnerText:function(a){if(a.innerText!=null)return a.innerText;if(a.textContent!=null)return a.textContent},getText:function(a){var b,c,d,e,f=a.cloneNode(!0),g=f.getElementsByTagName("*");for(b=g.length;--b>=0;)c=g[b],DlHtmlUtils.isBlockElement(c)&&(d=c.ownerDocument.createTextNode(" "),c.insertBefore(d,c.firstChild),c.appendChild(d.cloneNode(!0)));return e=DlHtmlUtils.getInnerText(f),DynarchDomUtils.trash(f),e},_can_t_DeleteFull_tags:"td".hashWords(),canDeleteFullNode:function(a){return!(a.toLowerCase()in DlHtmlUtils._can_t_DeleteFull_tags)},_can_t_DeleteContent_tags:"ul ol dd table tr img br hr".hashWords(),canDeleteContent:function(a){return!(a.toLowerCase()in DlHtmlUtils._can_t_DeleteContent_tags)},_can_t_StripNode_tags:"ul ol li dd dt dl img br hr table tr td object applet iframe form textarea".hashWords(),canStripNode:function(a){return!(a.toLowerCase()in DlHtmlUtils._can_t_StripNode_tags)}},DEFINE_CLASS("DlIconListView",DlContainer),DEFINE_CLASS("DlIconListItem",DlAbstractButton,function(a,b){var c;a.DEFAULT_ARGS={__itemSize:["itemSize",{x:100,y:null}],__itemSpacing:["itemSpacing",0],__spaceEvenly:["spaceEvenly",!1],__iconSize:["iconSize",{x:40,y:40}],__iconAbove:["iconAbove",!0],_btnType:["type",DlAbstractButton.TYPE.TWOSTATE],_tagName:["tagName","table"],_classes:["classes",{active:"DlIconListItem-active",hover:"DlIconListItem-hover",checked:"DlIconListItem-1",unchecked:"DlIconListItem-0",empty:"DlIconListItem-empty",disabled:"DlIconListItem-disabled"}],_iconClass:["iconClass",null]},c=["DlIconListItem-iconCell","DlIconListItem-labelCell"],b._createElement=function(){var a;DlWidget.prototype._createElement.call(this),a=this.getElement(),a.cellSpacing=a.cellPadding=0,this.__spaceEvenly?a.style.margin=this.__itemSpacing+"px":a.style.marginRight=a.style.marginBottom=this.__itemSpacing+"px",a.insertRow(-1).insertCell(-1),a.insertRow(-1).insertCell(-1),a.align="left",this.setIconAbove(this.__iconAbove,!0),this.setIconClass(this._iconClass),this.label(this._label,!0),this.setIconSize(this.__iconSize),this._updateState()},b.setIconClass=function(a){this.getIconCell().className=c[0]+" "+a},b.getIconCell=function(){return this.getElement().rows[this.__iconAbove?0:1].cells[0]},b.getLabelCell=function(){return this.getElement().rows[this.__iconAbove?1:0].cells[0]},b.setIconSize=function(a){DynarchDomUtils.setInnerSize(this.getIconCell(),a.x,a.y),this.__iconSize=a},b.getIconSize=function(){return this.__iconSize},b.setIconAbove=function(a,b){var d=this.getElement().rows;b?(d[0].cells[0].className=c[a?0:1],d[1].cells[0].className=c[a?1:0]):a!==this.__iconAbove&&d[1].parentNode.insertBefore(d[1],d[0]),this.__iconAbove=a},b.label=function(a,b){return a!=null&&(b||a!==this._label)&&(this._label=a,this.getLabelCell().innerHTML=String.buffer("<div class='DlIconListItem-labelDiv' style='width:",this.__itemSize.x,"px'>",a,"</div>").get(),this.applyHooks("onUpdateLabel",[this._label])),this._label}}),DlJSON={RE_strings:/(\x22(\\.|[^\x22\\])*\x22|\x27(\\.|[^\x27\\])*\x27)/g,RE_forbid:/([\n;()+=\x2f*-])/g,encode:function(a){var b,c;if(a==null)b="null";else if(a.dynarchlib_toJSON)b=a.dynarchlib_toJSON();else if(a instanceof Array)b="["+a.map(DlJSON.encode).join(",")+"]";else if(a instanceof Date)b=DlJSON.encode(a.toUTCString());else if(typeof a=="object"){b=[];for(c in a)b.push(DlJSON.encode(c)+":"+DlJSON.encode(a[c]));b="{"+b.join(",")+"}"}else typeof a=="string"?b='"'+a.replace(/\x5c/g,"\\\\").replace(/\r?\n/g,"\\n").replace(/\t/g,"\\t").replace(/\x22/g,'\\"')+'"':b=a+"";return b},encodeIndented:function(a,b){function d(a){return++c,a=a(),--c,a}function e(a){return" ".repeat(c*b)+a}var c;return b==null&&(b=2),c=0,function f(a){var b;return a==null?b="null":a.dynarchlib_toJSON?b=a.dynarchlib_toJSON():a instanceof Array?b="[ "+a.map(f).join(", ")+" ]":a instanceof Date?b=f(a.toUTCString()):typeof a=="object"?(b=d(function(){var b,c=[];for(b in a)c.push(f(b)+" : "+f(a[b]));return c.map(e).join(",\n")+"\n"}),b="{\n"+b+e("}")):typeof a=="string"?b='"'+a.replace(/\x5c/g,"\\\\").replace(/\r?\n/g,"\\n").replace(/\t/g,"\\t").replace(/\x22/g,'\\"')+'"':b=a+"",b}(a)},decode:function(a,b){var c;if(!b){a=a.trim(),c=a.replace(DlJSON.RE_strings,"");if(DlJSON.RE_forbid.test(c))throw new DlSecurityException("Character "+RegExp.$1+" not allowed in JSON input!")}try{return Dynarch.evalClean(a)}catch(d){throw new DlDataException("Malformed data in JSON input: "+d)}},domToObject:function(a){var b,c,d,e={},f=String.buffer();for(b=a.firstChild;b;b=b.nextSibling)b.nodeType==1?(c=DlJSON.domToObject(b),d=b.nodeName,d in e?(e[d]instanceof Array||(e[d]=[e[d]]),e[d].push(c)):e[d]=c):b.nodeType==3&&f(b.nodeValue);return e.$text=f.get(),e}},DlKeyboard={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,DASH:45,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,INSERT:45,DELETE:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,parseKey:function(a){var b={},c;a=a.toUpperCase();if(c=/^([a-z]+)\s+\x27(.)\x27$/i.exec(a))b[c[1]]=!0,b.key=c[2];else if(c=/^([a-z]+)-([a-z]+)\s+\x27(.)\x27$/i.exec(a))b[c[1]]=b[c[2]]=!0,b.key=c[3];else if(c=/^([a-z]+)-([a-z]+)-([a-z]+)\s+\x27(.)\x27$/i.exec(a))b[c[1]]=b[c[2]]=b[c[3]]=!0,b.key=c[4];return b},checkKey:function(a,b){return typeof b=="string"&&(b=DlKeyboard.parseKey(b)),(!b.CTRL&&!a.ctrlKey||b.CTRL&&a.ctrlKey)&&(!b.ALT&&!a.altKey||b.ALT&&a.altKey)&&(!b.SHIFT&&!a.shiftKey||b.SHIFT&&a.shiftKey)&&a.keyStr.toUpperCase()==b.key.toUpperCase()}},DlKeyboard.KEYS_CONTROL=["BACKSPACE","TAB","DELETE","ESCAPE","ENTER","PAGE_UP","PAGE_DOWN","END","HOME","ARROW_LEFT","ARROW_UP","ARROW_RIGHT","ARROW_DOWN"].keys_map(DlKeyboard).toHash(!0),DlKeyboard.KEYS_MOVE=["ARROW_LEFT","ARROW_UP","ARROW_RIGHT","ARROW_DOWN"].keys_map(DlKeyboard).toHash(!0),DlKeyboard.KEYS_MOVE_PREV=["ARROW_LEFT","ARROW_UP"].keys_map(DlKeyboard).toHash(!0),DEFINE_CLASS("DlLabel",DlAbstractButton,function(a,b){a.DEFAULT_ARGS={_activateWidget:["widget",null],_tagName:["tagName","span"]},b._onMouseDown=function(a){var b=this._activateWidget;b&&(b.focus(),a.domStop=!0,DlException.stopEventBubbling())},b.setWidget=function(a){this._activateWidget=a},b.getWidget=function(){return this._activateWidget},b._handle_accessKey=function(a){this._onMouseDown(a)}}),DEFINE_CLASS("DlLiteTree",DlContainer,function(a,b,c){var d,e;a.DEFAULT_EVENTS="onItemMouseDown onItemDblClick".qw(),a.DEFAULT_ARGS={items:["items",null],sort:["sort",Function.identity],_opt_toggleSelection:["toggleSelection",!1],_focusable:["focusable",!0]},a.FIXARGS=function(a){Object.mergeUndefined(a,{fillParent:!0})},a.CONSTRUCT=function(){this.addEventListener({onMouseDown:this._onMouseDown,onDblClick:this._onDblClick})},b.reset=function(a){this.top_items=this.sort(a),this.setContent(this._buildHTML(this.top_items,0)),this._selection&&this._selection.filter(this._itemsById)},b.setSelectionModel=function(a){this._selection?this._selection.removeEventListener(this._selListeners):this._selListeners||(this._selListeners={onChange:this.$("_on_selChange"),onReset:this.$("_on_selReset")}),this._selection=a,a.addEventListener(this._selListeners)},b.isSelected=function(a){return this._selection&&this._selection.isSelected(a)},b.refreshItems=function(a){a.foreach(function(a){var b,c,d,e=this._getItemElement(a);e&&(b=["item-label"],c=this._itemsById[a],this.isSelected(a)&&b.push("selected"),c.addClassNames(b),e.className=b.join(" "),d=String.buffer("<span class='expander'></span>"),c.formatHTML(d),e.innerHTML=d.get())},this)},b.getItemById=function(a){return this._itemsById[a]},b._buildHTML=function(a,b){var c;return a.length==0?"":(b==null&&(b=0),b==0&&(this._itemsById={}),c=String.buffer("<ul>"),a.foreach(function(a){var d,e,f=a.children(),g=f.length>0;c("<li>"),d=["item-label"],e=a.id(),a.addClassNames(d),this.isSelected(e)&&d.push("selected"),g&&d.push("expanded"),c("<div id='",this._makeId(e),"' lite-tree-item='",e,"' class='",d.join(" "),"'><span class='expander'></span>"),a.formatHTML(c),c("</div>",this._buildHTML(f,b+1),"</li>"),this._itemsById[a.id()]=a},this),c("</ul>"),c.get())},b._makeId=function(a){return this.id+":"+a},b._findItemFromEvent=function(a){var b,c={},d=a.target;while(d&&d.nodeType==1){b=d.getAttribute("lite-tree-item");if(b!=null)return c.el=d,c.id=b,c.item=this._itemsById[b],c;d.className=="expander"&&(c.expander=d),d=d.parentNode}},b.scrollToRecord=function(a){c.scrollIntoView(this._getItemElement(a))},b._getItemElement=function(a){return document.getElementById(this._makeId(a))},b.__handleSelectClick=function(a,b,d){var e,f,g=this._selection,h=this._itemsById[a.id],i=[h,a,b];if(d){g&&!g.isSelected(a.id)&&this.canSelectItem(h)&&g.reset([a.id]),this.applyHooks("onItemDblClick",i);return}!g||a.expander||!this.canSelectItem(a.item)?(e=a.el.nextSibling,e&&(f=c.hasClass(e,"hidden"),c.condClass(e,!f,"hidden"),c.condClass(a.el,f,"expanded","collapsed")),this.applyHooks("onItemMouseDown",i)):g&&this.canSelectItem(a.item)&&(g.multiple?b.ctrlKey?g.toggle(a.id):g.reset([a.id]):this._opt_toggleSelection&&g.isSelected(a.id)?g.toggle(a.id):g.reset([a.id]),this.applyHooks("onItemMouseDown",i))},b.canSelectItem=function(a){return a.isSelectable()},d=(new Date).getTime(),e=null,b._onMouseDown=function(a){var b=this._findItemFromEvent(a),c=(new Date).getTime();c-d<Dynarch.dblClickTimeout&&b&&e&&b.id==e.id?this.__handleSelectClick(b,a,!0):b&&(d=c,this.__handleSelectClick(b,a,!1)),e=b},b._on_selChange=function(a,b){c.condClass(this._getItemElement(a),b,"selected")},b._on_selReset=function(a,b){Object.foreach(a,function(a,b){c.delClass(this._getItemElement(b),"selected")},this),Object.foreach(b,function(a,b){c.addClass(this._getItemElement(b),"selected")},this)},a.Item=DEFINE_HIDDEN_CLASS(null,DlEventProxy,function(a,b){a.DEFAULT_ARGS={_name:["name",null],_id:["id",null],_children:["children",null]},a.CONSTRUCT=function(){this._children==null&&(this._children=[])},b.formatHTML=function(a){a((this._name+"").htmlEscape())},b.addClassNames=Function.noop,b.id=function(){return this._id},b.children=function(){return this._children},b.isSelectable=Function.returnTrue})}),DEFINE_CLASS("DlMacBarIcon",DlAbstractButton,function(a,b){function d(){this.__anim.destroy()}function e(){this.__anim.sw=this.__currentWidth,this.__anim.sh=this.__currentHeight}function f(){var a,b=this.__anim,c=this.getImgElement(),d=b.getPos(),e=b.getPos(function(a){return 1-Math.cos(a*2.5*Math.PI)/Math.exp(5*a)});c.width=this.__currentWidth=d.mapInt(b.sw,b.ew),c.height=this.__currentHeight=e.mapInt(b.sh,b.eh),b=this.__align,a=this.__minWidth-this.__currentWidth,b.center&&(a/=2);if(b.left||b.center)c.style.marginRight=a+"px";if(b.right||b.center)c.style.marginLeft=a+"px";a=this.__minHeight-this.__currentHeight,b.middle&&(a/=2);if(b.top||b.middle)c.style.marginBottom=a+"px";if(b.bottom||b.middle)c.style.marginTop=a+"px"}var c;a.BEFORE_BASE=function(){this.__currentWidth=this.__minWidth,this.__currentHeight=this.__minHeight,this.__align=this.__align.split(/\s+/).toHash()},c={active:"DlMacBarIcon-active",hover:"DlMacBarIcon-hover",checked:"DlMacBarIcon-1",unchecked:"DlMacBarIcon-0",empty:"DlMacBarIcon-empty",disabled:"DlMacBarIcon-disabled"},a.DEFAULT_ARGS={_classes:["classes",c],__image:["img",null],__minWidth:["minWidth",32],__minHeight:["minHeight",32],__maxWidth:["maxWidth",64],__maxHeight:["maxHeight",64],__align:["align","bottom"],__tooltipTimeout:["tooltipTimeout",900]},b._createElement=function(){DlWidget.prototype._createElement.call(this),this.setContent(String.buffer("<img src='",this.__image,"' width='",this.__minWidth,"' height='",this.__minHeight," ' />").get())},b.getImgElement=function(){return this.getElement().firstChild},b.flash=function(a){this._onMouseEnter(),this._onMouseLeave.delayed(a||100,this)},b.initDOM=function(){a.BASE.initDOM.call(this),this.addEventListener({onDestroy:d}),this.__anim=new DlAnimation(25,40),this.__anim.addEventListener({onUpdate:f.$(this),onStart:e.$(this)})},b._onMouseEnter=function(){var b;a.BASE._onMouseEnter.apply(this,arguments),b=this.__anim,b.ew=this.__maxWidth,b.eh=this.__maxHeight,b.start(30,50,DlAnimation.easing.elastic_b)},b._onMouseLeave=function(){var b;a.BASE._onMouseLeave.apply(this,arguments),b=this.__anim,b.ew=this.__minWidth,b.eh=this.__minHeight,b.start(50,50,DlAnimation.easing.accel_b)}}),DEFINE_CLASS("DlNotebook",DlContainer,function(a,b){var c=["onChange"];b._createElement=function(){a.BASE._createElement.call(this),this.getElement().innerHTML="<div class='TabContent-inner'></div>"},b.appendWidget=function(b,c){var d,e;b.registerEvents(["onNotebookShow"]),a.BASE.appendWidget.call(this,b),d=b.getElement(),e=this.getContentElement(),c!=null?c=this.__widgetsPosition:this.__widgetsPosition=c,c==null&&(c=this.__widgetsPosition=DynarchDomUtils.getPadding(e).x/2),d.style.position="absolute",d.style.visibility="hidden",d.style.left=d.style.top=c+"px",e.appendChild(d),this._panes.push(b)},b.initDOM=function(){this._panes=[],this._currentPane=null,this.registerEvents(c),a.BASE.initDOM.call(this)},b.getPane=function(a){return this._panes[a]},b.getAllPanes=function(){return this._panes},b.getCurrentPane=function(){return this.getPane(this._currentPane)},b.getCurrentPaneIndex=function(){return this._currentPane},b.length=function(){return this._panes.length},b.showPane=function(a){var b
,c=this._currentPane;return c!=null&&(this.getPane(c).visibility(!1),this.getPane(c).setPos({x:-3e4,y:-3e4})),this._currentPane=a,b=this.getPane(a),b._dl_notebook_has_size||(b.setSize(this.getInnerSize()),b._dl_notebook_has_size=!0),b.setStyle({left:"",top:""}),b.visibility(!0),a!==c&&this.applyHooks("onChange",[a,c]),b.callHooks("onNotebookShow"),this},b.firstPane=function(){this.showPane(0)},b.lastPane=function(){this.showPane(this.length()-1)},b.nextPane=function(){var a=this._currentPane;return a==null?a=0:++a,a>=this._panes.length&&(a=0),this.showPane(a)},b.prevPane=function(){var a=this._currentPane;return a==null?a=this._panes.length-1:--a,a<0&&(a=this._panes.length-1),this.showPane(a)},b.isFirstPane=function(){return this._currentPane==0},b.isLastPane=function(){return this._currentPane==this._panes.length-1},b.getContentElement=function(){return this.getElement().firstChild},b.setSize=b.setOuterSize=function(b){var c,d;a.BASE.setOuterSize.call(this,b),c=this.getElement(),b=DynarchDomUtils.getInnerSize(c),DynarchDomUtils.setOuterSize(this.getContentElement(),b.x,b.y),c.style.width=c.style.height="",b=DynarchDomUtils.getInnerSize(this.getContentElement()),this._currentPane==null&&this.showPane(0),d=this.getCurrentPane(),this._panes.foreach(function(a){a._dl_notebook_has_size=!1}),d.setSize(b),d._dl_notebook_has_size=!0},b.setIdealSize=function(){var a={x:0,y:0};this._panes.r_foreach(function(b){var c=b.getOuterSize();c.x>a.x&&(a.x=c.x),c.y>a.y&&(a.y=c.y)}),this.setInnerSize(a)}}),DEFINE_CLASS("DlProgressBar",DlWidget,function(a,b){var c=DynarchDomUtils.createElement;a.DEFAULT_ARGS={__progress_minVal:["min",0],__progress_maxVal:["max",100],__progress_val:["val",0],__label:["label",null]},b._createElement=function(){var b;a.BASE._createElement.call(this),b=this.getElement(),c("div",null,{className:"DlProgressBar-fill"},b),c("div",null,{className:"DlProgressBar-label",innerHTML:"&nbsp;"},b),this.setLabel(this.__label),this.setValue(this.__progress_val)},b._getLabelElement=function(){return this.getElement().lastChild},b._getFillElement=function(){return this.getElement().firstChild},b.getValue=function(){return this.__progress_val},b.getMaxVal=function(){return this.__progress_maxVal},b.getMinVal=function(){return this.__progress_minVal},b.setValue=function(a){var b,c,d;this.__progress_val=a,a>this.__progress_maxVal&&(a=this.__progress_maxVal),b=this.__progress_maxVal-this.__progress_minVal,c=a-this.__progress_minVal,d=100*c/b,!isNaN(d)&&d>=0&&(this._getFillElement().style.width=d+"%",this._updateLabel(d))},b.setLabel=function(a){this.__label=a,this._updateLabel()},b._updateLabel=function(a){var b=this.__label;a==null&&(a=0),b!=null&&(typeof b=="function"?b=b(this,a,this.__progress_val):b=b.replace(/%d/g,Math.round(a)).replace(/%f/g,a.toFixed(2)).replace(/%v/g,this.__progress_val),/\S/.test(b)||(b="&nbsp;"),this._getLabelElement().innerHTML=b)},b.reset=function(a,b,c,d){c==null&&(c=a),this.__progress_minVal=a,this.__progress_maxVal=b,arguments.length>3&&(this.__label=d),this.setValue(c)}}),DEFINE_CLASS("DlRadioButton",DlCheckbox,function(a,b){a.FIXARGS=function(a){a.alwaysCheck=!0},a.DEFAULT_ARGS={_groupId:["group",0],_classes:["classes",{active:"DlRadioButton-active",hover:"DlRadioButton-hover",checked:"DlRadioButton-1",unchecked:"DlRadioButton-0",empty:"DlRadioButton-empty",disabled:"DlRadioButton-disabled"}]},b.FINISH_OBJECT_DEF=function(){a.BASE.FINISH_OBJECT_DEF.call(this),this._className.remove("DlCheckbox")}}),DEFINE_CLASS("DlRadioSelect",DlButtonMenu,function(a,b){function c(a){this.value(a.userData),DlPopup.clearAllPopups(),a._onMouseLeave()}a.DEFAULT_ARGS={_options:["options",[]],_value:["value",null],_connected:["connected",!0]},a.DEFAULT_EVENTS=["onChange"],a.CONSTRUCT=function(){this._radioGroup=DlRadioGroup.get(),this._options.length&&this.setOptions(this._options),this.value(this._value,!0),this.addEventListener("onDestroy",function(){this._radioGroup.reset()})},b.value=function(a,b,c){var d=this._value;if(b||typeof a!="undefined"&&a!==d)this._value=a,this._updateLabel(),c||this.applyHooks("onChange",[d,a]);return d},b.getValue=function(){return this.value()},b.setValue=b.value,b._updateLabel=function(){var a,b,c=null,d=this._options;for(a=d.length;--a>=0;){b=d[a];if(b==null)continue;this._value==b.value?(this.getButton().label(b.label),b.widget.checked(!0,!0)):b.widget.checked(!1,!0)}},b.setOptions=function(a){var b,d,e,f,g=this._radioGroup;g.reset(),g.addEventListener("onChange",c.$(this)),b=new DlVMenu({className:"DlSelect-menu"}),d={parent:b,group:g,noCapture:!0},a.foreach(function(a){var c;a==null?b.addSeparator():(d.label=a.label,d.data=d.value=a.value,d.className=a.className,c=a.widget=new DlRadioButton(d))},this),e=b.getElement(),e.style.position="absolute",b.zIndex(-100),document.body.appendChild(e),f=b.getOuterSize().x,document.body.removeChild(e),b.zIndex(""),e.style.position="",function(){this.getButton().setOuterSize({x:f-this.getArrow().getOuterSize().x})}.$(this).delayed(10),this.setMenu(b),this._options=a},b.addOption=function(a,b){var c;return b==null&&(b=this._options.length),c=a.widget=new DlRadioButton({parent:this._menu,group:this._radioGroup,noCapture:!0,label:a.label,data:a.value,value:a.value,className:a.className}),this._options.splice(b,0,a),c}}),DlRegexp={EMAIL:/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,MIME_WEB_IMAGE:/^image\x2f.*(png|jpe?g|gif|tiff?)/i,UNICODE_LETTER:"\\u0041-\\u005A\\u0061-\\u007A\\u00AA\\u00B5\\u00BA\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u0523\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0621-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971\\u0972\\u097B-\\u097F\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C33\\u0C35-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D28\\u0D2A-\\u0D39\\u0D3D\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC\\u0EDD\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8B\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10D0-\\u10FA\\u10FC\\u1100-\\u1159\\u115F-\\u11A2\\u11A8-\\u11F9\\u1200-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u1676\\u1681-\\u169A\\u16A0-\\u16EA\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u1900-\\u191C\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19A9\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u2094\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2183\\u2184\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2C6F\\u2C71-\\u2C7D\\u2C80-\\u2CE4\\u2D00-\\u2D25\\u2D30-\\u2D65\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005\\u3006\\u3031-\\u3035\\u303B\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31B7\\u31F0-\\u31FF\\u3400\\u4DB5\\u4E00\\u9FC3\\uA000-\\uA48C\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA65F\\uA662-\\uA66E\\uA67F-\\uA697\\uA717-\\uA71F\\uA722-\\uA788\\uA78B\\uA78C\\uA7FB-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA90A-\\uA925\\uA930-\\uA946\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAC00\\uD7A3\\uF900-\\uFA2D\\uFA30-\\uFA6A\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC"},DEFINE_SINGLETON("DlSystem",DlEventProxy,function(a){a.DEFAULT_EVENTS=["on-dialog-create","on-dialog-show","on-dialog-hide","on-dialog-minimize","on-dialog-restore","on-rpc-start","on-rpc-stop","on-rpc-timeout"]}),DEFINE_CLASS("DlRPC",DlEventProxy,function(a,b){function c(a){var b;if(a.readyState==4){delete a.onreadystatechange,this._request=null,this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null);try{b={success:a.status==200,status:a.status,statusText:a.statusText,timeout:!1,xml:a.responseXML,text:a.responseText}}catch(c){}DlSystem().applyHooks("on-rpc-stop",[this,b,a]),this.applyHooks("onStop",[this,b,a]),this.callback&&this.callback(b)}}function d(a){this._request=null,a.abort(),DlSystem().applyHooks("on-rpc-timeout",[this,a]),this.applyHooks("onTimeout",[this,a]),this.callback&&this.callback({success:!1,timeout:!0})}a.CONSTRUCT=function(){this.method==null&&(this.method=this.data!=null?"POST":"GET"),this._timeoutID=0},a.DEFAULT_EVENTS="onStart onStop onTimeout onUploadProgress onUploadDone onUploadError onUploadAbort".qw(),a.DEFAULT_ARGS={url:["url",null],args:["args",null],callback:["callback",null],method:["method",null],data:["data",null],timeout:["timeout",null]},b.abort=function(){this._request.abort()},b.call=function(a){var b,d,e,f,g,h;a!=null&&Object.merge(this,a),d=!1;if(window.XMLHttpRequest)b=new XMLHttpRequest;else{if(!window.ActiveXObject)throw"Browser does not support XMLHttpRequest";b=new ActiveXObject("Microsoft.XMLHTTP")}this._request=b,b.onreadystatechange=c.$(this,b),b.upload&&(b.upload.addEventListener("progress",this.$("callHooks","onUploadProgress"),!1),b.upload.addEventListener("load",this.$("callHooks","onUploadDone"),!1),b.upload.addEventListener("error",this.$("callHooks","onUploadError"),!1),b.upload.addEventListener("abort",this.$("callHooks","onUploadAbort"),!1)),f=this.args;if(f){d=[];for(e in f)d.push(escape(e)+"="+escape(f[e]));d.length==0?d=!1:d=d.join("&")}g=this.url;switch(this.method){case"POST":h=this.data,d&&h&&(g+="?"+d),b.open("POST",g,!0),h?(typeof h!="string"&&(h=DlJSON.encode(h),this.data=h,b.setRequestHeader("Content-Type","text/javascript; charset=UTF-8")),this._start(h)):(b.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),this._start(d));break;case"GET":d&&(g+="?"+d),b.open("GET",g,!0),this._start(null)}},b._start=function(a){this.timeout?this._timeoutID=d.delayed(this.timeout,this,this._request):this._timeoutID=0,DlSystem().applyHooks("on-rpc-start",[this]),this.applyHooks("onStart",[this]),this._request.send(a)}}),DEFINE_CLASS("DlRteFrame",DlWidget,function(a,b,c){function m(a){var b,d,e;a||(a=this.getIframeWin().event),b=new DlEvent(a),b.type=="oncontextmenu"&&c.stopEvent(a),b.origTarget=b.target,d=b.origPos=b.pos,e=c.getPos(this.getIframeElement()),b.pos={x:d.x+e.x,y:d.y+e.y},b.target=this.getElement();try{DlEvent._genericEventHandler(b,a)}catch(f){f instanceof DlExStopFrameEvent&&c.stopEvent(a)}/onMouseDown|onMouseUp|onKey/.test(b.dl_type)&&this.callUpdateHooks(b,a)}function n(a){var b=this.getIframeDoc();this.__hasFrameEvents=!0,c.addEvents(b,j,this.__eventProxy),this.__rte_onFocus=p.$(this),this.__rte_onBlur=q.$(this),is_ie?(b=this.getIframeElement(),b.onfocus=this.__rte_onFocus):c.addEvent(b,"focus",this.__rte_onFocus),b.onblur=this.__rte_onBlur,a&&a.call(this),this.__pendingHTML&&(this.getIframeBody().innerHTML=this.__pendingHTML,this._onSetHTML(),this.moveBOF(),this.__pendingHTML=null)}function o(){var a=this.getIframeDoc();c.removeEvents(a,j,this.__eventProxy),is_ie?(a=this.getIframeElement(),delete a.onfocus,a.onfocus=null):c.removeEvent(a,"focus",this.__rte_onFocus),delete a.onblur,a.onblur=null}function p(){f(this.getIframeDoc().documentElement,"DlRteFrame-Focused"),a.BASE.focus.call(this)}function q(){g(this.getIframeDoc().documentElement,"DlRteFrame-Focused"),a.BASE.blur.call(this,!0)}var d,e=c.createElement,f=c.addClass,g=c.delClass,h=c.condClass,i=c.ID,j=["mouseover","mouseout","mousemove","mousedown","mouseup","click","keydown","keyup","keypress","contextmenu"],k=is_gecko?"<br type='_moz' />":"",l='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html class="DlRteFrame-HTML"><head><title>DynarchLIB Rich Text Editor</title></head><body class="DlRteFrame-Body"><p>'+k+"</p></body></html>";a.BEFORE_BASE=function(){this.__eventProxy=m.$(this),this.callUpdateHooks=this.callUpdateHooks.clearingTimeout(40,this)},a.CONSTRUCT=function(){this.__sections&&this.setSections(this.__sections)},a.DEFAULT_EVENTS=["onUpdate","onSectionChange"],a.DEFAULT_ARGS={__paragraphsMode:["useParagraphs",!0],__sections:["sections",null],_focusable:["focusable",2],_tabChar:["tabChar","    "]},b.COMMANDS={backcolor:{id:is_ie?"backcolor":"hilitecolor"},forecolor:{id:"forecolor"},bold:{id:"bold",key:"CTRL 'B'"},italic:{id:"italic",key:"CTRL 'I'"},underline:{id:"underline",key:"CTRL 'U'"},strike:{id:"strikethrough",key:"CTRL '-'"},subscript:{id:"subscript"},superscript:{id:"superscript"},removeformat:{id:"removeformat",key:"ALT-CTRL '0'"},justifyleft:{id:"justifyleft",key:"ALT-CTRL 'l'"},justifyright:{id:"justifyright",key:"ALT-CTRL 'r'"},justifycenter:{id:"justifycenter",key:"ALT-CTRL 'e'"},justifyfull:{id:"justifyfull",key:"ALT-CTRL 'j'"},orderedlist:{id:"insertorderedlist",key:"ALT-CTRL 'o'"},unorderedlist:{id:"insertunorderedlist",key:"ALT-CTRL-SHIFT 'o'"},unorderedlist1:{id:"insertunorderedlist",key:"ALT-CTRL 'u'"},indent:{id:"indent",key:"CTRL '.'"},outdent:{id:"outdent",key:"CTRL ','"},undo:{id:"undo"},redo:{id:"redo"},"<hr>":{id:"inserthorizontalrule",key:"CTRL ' '"},"<h1>":{id:"formatblock",key:"CTRL '1'",arg:"h1"},"<h2>":{id:"formatblock",key:"CTRL '2'",arg:"h2"},"<h3>":{id:"formatblock",key:"CTRL '3'",arg:"h3"},"<h4>":{id:"formatblock",key:"CTRL '4'",arg:"h4"},"<h5>":{id:"formatblock",key:"CTRL '5'",arg:"h5"},"<h6>":{id:"formatblock",key:"CTRL '6'",arg:"h6"},"<p>":{id:"formatblock",key:"CTRL 'm'",arg:"p"},"<pre>":{id:"formatblock",key:"CTRL-ALT 'n'",arg:"pre"},"<address>":{id:"formatblock",arg:"pre"},"<blockquote>":{id:"formatblock",key:"CTRL 'q'",arg:"blockquote"},_nextSection:{id:"_nextSection",key:"CTRL ']'"},_prevSection:{id:"_prevSection",key:"CTRL '['"},showHtml:{id:"showHtml",key:"CTRL-ALT-SHIFT 'h'"}},d="h1 h2 h3 h4 h5 h6 p pre address blockquote".hashWords(),b.SEMANTIC_TAGS={bold:!0,italic:!0,strike:!0,subscript:!0,superscript:!0,indent:!0,underline:!0,outdent:!0,strikethrough:!0,strike:!0},b.callUpdateHooks=function(a,b){this.destroyed||this.applyHooks("onUpdate",[a,b])},b.execCommand=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;if(this.readonly())return;this.focus(),d=this.getIframeDoc(),is_gecko&&d.execCommand("styleWithCSS",!1,!(a in this.SEMANTIC_TAGS)),this.COMMANDS[a]&&(a=this.COMMANDS[a],typeof b=="undefined"&&(b=a.arg||""),a=a.id);if(a=="formatblock"&&is_ie){e=this.getAncestorsHash();if(e.pre){if(b=="pre")return;f=this.getSelection(),g=this.getRange(f),h=this.createRange(),h.moveToElementText(e.pre),g.setEndPoint("EndToEnd",h),g.select(),j=String.buffer("<",b,">dummy</",b,">").get(),g.compareEndPoints("StartToStart",h)==0?(e.pre.insertAdjacentHTML("beforeBegin",j),i=e.pre.previousSibling):(k=g.htmlText,l=g.text,g.moveStart("character",-1),g.text.charAt(0)!=l.charAt(0)&&g.moveStart("character",1),e.pre.insertAdjacentHTML("afterEnd","<br />"),g.pasteHTML(""),e.pre.parentNode.removeChild(e.pre.nextSibling),e.pre.insertAdjacentHTML("afterEnd",j),i=e.pre.nextSibling,/\S/.test(l)&&(m=e.pre.cloneNode(!0),m.innerHTML=k,i.parentNode.insertBefore(m,i.nextSibling))),g.moveToElementText(i),g.collapse(),g.select(),i.innerHTML="";return}b="<"+b+">"}switch(a){case"showHtml":try{alert(this.getHTML())}catch(n){alert("ERROR: "+n)}break;case"_nextSection":this.nextSection();break;case"_prevSection":this.prevSection();break;default:c=d.execCommand(a,!1,b)}return this.focus(),this.callUpdateHooks(),c},b.queryCommandState=function(a){if(!this.readonly()){this.COMMANDS[a]&&(a=this.COMMANDS[a].id);try{return this.getIframeDoc().queryCommandState(a)}catch(b){}}},b.queryCommandValue=function(a){var b,c,e;if(!this.readonly()){this.COMMANDS[a]&&(a=this.COMMANDS[a].id);if(!is_gecko&&/^formatblock$/i.test(a)){b=this.getAllAncestors();for(c=0;c<b.length;++c){e=b[c].tagName.toLowerCase();if(e in d)return e}}try{return this.getIframeDoc().queryCommandValue(a)}catch(f){}}},b.getInnerHTML=function(){return this.getIframeBody().innerHTML},b.getHTML=function(a,b){var c,d;return!is_ie&&!b&&(this.collapse(!0),c=this.getIframeDoc().createElement("span"),c.id="DYNARCHLIB_RTEFRAME_CARET",this.insertNode(c)),d=DlHtmlUtils.getHTML(this.getIframeBody(),!1,a),!is_ie&&!b&&this.deleteNode(c),d},b.getInnerText=function(){return DlHtmlUtils.getInnerText(this.getIframeBody())},b.getText=function(){return DlHtmlUtils.getText(this.getIframeBody())},b.setSections=function(a){var b;this.__sections=a,b=this.__sectionsHash={},a.foreach(function(a,c){a.index=c,b[a.name]=a;if(a.current||c==0)this.__currentSection=c,this.setHTML(a.content)}.$(this))},b.setSectionContent=function(a,b){var c=this.getSection(a,!0);c.content=b,c.index==this.__currentSection&&this.setHTML(b)},b.getSections=function(){var a=this.getHTML(!0);return Object.merge(this.getCurrentSection(),a),this.__sectionsHash},b.getSection=function(a,b){var c,d=this.__sectionsHash[a];return d.index==this.__currentSection&&!b&&(c=this.getHTML(!0),Object.merge(d,c)),d},b.getCurrentSection=function(){return this.__sections[this.__currentSection]},b._setCurrentSection=function(a){var b,c=this.getCurrentSection();c!==a&&(b=this.getHTML(!0),Object.merge(c,b),this.__currentSection=a.index,this.setHTML(a.content),this.applyHooks("onSectionChange",[c,a]))},b.setCurrentSection=function(a){var b=this.__sectionsHash[a];this._setCurrentSection(b)},b.setCurrentSectionIndex=function(a){var b;a!=this.__currentSection&&(b=this.__sections[a],this._setCurrentSection(b))},b.prevSection=function(){this.setCurrentSectionIndex(this.__sections.rotateIndex(this.__currentSection-1))},b.nextSection=function(){this.setCurrentSectionIndex(this.__sections.rotateIndex(this.__currentSection+1))},b._setListeners=function(){a.BASE._setListeners.call(this),this.addEventListener(is_ie?"onKeyDown":"onKeyPress",function(a){this._onKeypress(a)}),this.addEventListener({onDestroy:o})},b._createElement=function(){var b;a.BASE._createElement.call(this),b=e("iframe",{display:"block"},{frameBorder:0,marginHeight:0,marginWidth:0,src:is_ie?"javascript:'';":"about:blank"},this.getElement()),this.__hasFrameEvents=!1,this.updateKeymap()},b.updateKeymap=function(){var a,b,c=this.__rte_keymap=[];for(a in this.COMMANDS)b=this.COMMANDS[a],b.key&&c.push([DlKeyboard.parseKey(b.key),a])},b.setOuterSize=b.setSize=function(a){var b=c.getBorder(this.getElement()),d=c.getBorder(this.getContentElement());this.setInnerSize({x:a.x-b.x-d.x,y:a.y-b.y-d.y})},b.getIframeElement=function(){return this.getElement().firstChild},b.getContentElement=b.getIframeElement,b.getIframeWin=function(){return this.getIframeElement().contentWindow},b.getIframeDoc=function(){return this.getIframeWin().document},b.getIframeBody=function(){return this.getIframeDoc().body},b.initDesignMode=function(a){var b=this.getIframeDoc();b.open(),b.write(l),b.close(),b.designMode="on",this.__hasFrameEvents||n.delayed(5,this,a)},b.readonly=function(a){var b=this.getIframeDoc();return arguments.length>0&&(b.designMode=a?"off":"on",h(b.documentElement,a,"DlRteFrame-ReadOnly")),b.designMode=="off"},b.setHTML=function(a){a instanceof Array&&(a=a.join("")),a=a.trim();if(this.__hasFrameEvents){is_ie&&(a=a.replace(/(<pre[^>]*>)((.|\n)+?)(<\x2fpre>)/gi,function(a,b,c,d,e){return c=c.replace(/\x20/g,"").replace(/\t/g,"".repeat(4)),b+c+e})),this.getIframeBody().innerHTML=a,this._onSetHTML();try{this.moveBOF()}catch(b){}this.callUpdateHooks()}else this.__pendingHTML=a},b._onSetHTML=function(){var a,b,c,d=this.getIframeDoc().getElementsByTagName("pre");for(a=d.length;--a>=0;)b=d[a],b.innerHTML=b.innerHTML.replace(/\n/g,"<br>");is_ie||(c=this.getIframeDoc().getElementById("DYNARCHLIB_RTEFRAME_CARET"),c&&function(a){try{this.selectNodeContents(a),this.collapse(!0),this.deleteNode(a)}catch(b){}}.delayed(10,this,c))},b.clear=function(){this.setHTML("")},b.focus=function(){this.getIframeWin().focus(),a.BASE.focus.call(this)},b.loadStyle=function(a){var b,c,d=this.getIframeDoc(),e=a.replace(/\x2f/g,"_");d.getElementById(e)||(b=d.getElementsByTagName("head")[0],c=d.createElement("link"),c.type="text/css",c.rel="stylesheet",c.href=a,c.id=e,b.appendChild(c),c.disabled=!0,c.disabled=!1)},b.createRange=function(){return is_ie?this.getIframeBody().createTextRange():this.getIframeDoc().createRange()},b.getSelection=function(){return is_ie?this.getIframeDoc().selection:this.getIframeWin().getSelection()},b.getRange=function(a){return a==null&&(a=this.getSelection()),is_ie?a.createRange():a.getRangeAt(0)},b.getParentElement=function(){var a,b=this.getSelection(),c=this.getRange(b);if(is_ie)switch(b.type){case"Text":case"None":return c.parentElement();case"Control":return c.item(0);default:return null}else try{a=c.commonAncestorContainer,!c.collapsed&&c.startContainer==c.endContainer&&c.startOffset-c.endOffset<=1&&c.startContainer.hasChildNodes()&&(a=c.startContainer.childNodes[c.startOffset]);while(a.nodeType==3)a=a.parentNode;return a}catch(d){return null}},b.getAllAncestors=function(){var a,b,c=this.getParentElement();c&&c.nodeType==1&&(c=this.getParentElement()),a=this.getIframeBody(),b=[];while(c&&c!==a&&c.nodeType==1)b.push(c),c=c.parentNode;return b.push(a),b},b.getAncestorsHash=function(){var a,b=this.getAllAncestors(),c={__all:b};return b.foreach(function(b){a=b.tagName.toLowerCase(),c[a]||(c[a]=b)}),c},b.getSelectedText=function(){var a=this.getRange();return is_ie?a.text:a+""},b.selectRange=function(a){var b;is_ie?a.select():(b=this.getSelection(),b.removeAllRanges(),b.addRange(a))},b.isCollapsed=function(){var a=this.getRange();return is_w3?a.collapsed:a.compareEndPoints("StartToEnd",a)==0},b.collapse=function(a){var b=this.getSelection(),c=this.getRange(b);is_w3&&b.removeAllRanges(),c.collapse(!!a),this.selectRange(c)},b.insertNode=function(a,b){var c,d,e=this.getSelection(),f=this.getRange(e);return is_w3?(f.deleteContents(),f.insertNode(a),b&&(e.removeAllRanges(),f.selectNode(a),e.addRange(f))):(c=i("rteframe"),f.pasteHTML(["<span id='",c,"'></span>"].join("")),d=this.getIframeDoc().getElementById(c),d.parentNode.insertBefore(a,d),d.parentNode.removeChild(d),b&&a.nodeType!=3&&(f.moveToElementText(a),f.select())),a},b.insertText=function(a,b){var c=this.getIframeDoc().createTextNode(a);return this.insertNode(c,b)},b.selectNodeContents=function(a){var b=this.createRange();is_w3?b.selectNodeContents(a):b.moveToElementText(a),this.selectRange(b)},b.selectNode=function(a){var b;is_w3?(b=this.createRange(),b.selectNode(a),this.selectRange(b)):this.selectNodeContents(a)},b.createLink=function(a,b){var c,d,e,f;b&&this.insertText(b,!0),c="javascript:"+i("link"),this.execCommand("createlink",c),d=this.getIframeDoc().getElementsByTagName("a");for(f=d.length;--f>=0;)if(d[f].href==c){e=d[f];break}return e.href=a,e},b.createAnchor=function(a){var b=this.getSelectedText()?null:"Anchor",c=this.createLink("#",b);return c.removeAttribute("href"),f(c,b?"DlAnchor-Empty":"DlAnchor"),c.setAttribute("name",a),b&&(c.innerHTML=""),c},b.getAnchors=function(){var a,b=this.getIframeDoc().getElementsByTagName("a"),c=b.length,d=[];while(--c>=0)a=b[c],a.name&&d.unshift(a);return d},b.unlink=function(){this.execCommand("unlink")},b.getSelectedImage=function(){var a=this.getParentElement();return a&&!/^img$/i.test(a.tagName)&&(a=null),a},b.insertImage=function(a){var b,c,d,e=this.getSelectedImage();if(!e){b="javascript:"+i("img"),this.execCommand("insertimage",b),c=this.getIframeDoc().getElementsByTagName("img");for(d=c.length;--d>=0;)if(c[d].src==b){e=c[d];break}}return e.src=a.url,a.width&&(e.width=a.width),a.height&&(e.height=a.height),a.align&&(e.align=a.align),a.alt&&(e.alt=a.alt),a.marginLeft&&(e.style.marginLeft=a.marginLeft),a.marginTop&&(e.style.marginTop=a.marginTop),a.marginRight&&(e.style.marginRight=a.marginRight),a.marginBottom&&(e.style.marginBottom=a.marginBottom),e},b.moveBOF=function(a){var b,c,d=this.getIframeBody(),e=a?d.lastChild:d.firstChild;if(!e)return;is_w3?(c=this.getRange(b=this.getSelection()),b.removeAllRanges(),e.nodeType==1?c.selectNodeContents(e):c.selectNode(e),c.collapse(!a),b.addRange(c)):(c=d.createTextRange(),c.collapse(!a),c.select())},b.moveEOF=function(a){return this.moveBOF(!a)},b.setParagraphsMode=function(a){this.__paragraphsMode=a},b.addBlockClass=function(a,b,d){var e=this.getAncestorsHash()[a];if(e){if(c.hasClass(e,b)){if(d)return c.delClass(e,b),!1}else c.addClass(e,b);return!0}return null},b.canDeleteFullNode=function(a){return DlHtmlUtils.canDeleteFullNode(a.tagName)},b.canDeleteContent=function(a){return DlHtmlUtils.canDeleteContent(a.tagName)},b.canStripNode=function(a){return DlHtmlUtils.canStripNode(a.tagName)},b.deleteNodeContents=function(a){a.innerHTML=DlHtmlUtils.isBlockElement(a)?k:""},b.deleteNode=function(a){a.parentNode.removeChild(a)},b.stripNode=function(a){var b=a.ownerDocument.createDocumentFragment();while(a.firstChild)b.appendChild(a.firstChild);a.parentNode.insertBefore(b,a),a.parentNode.removeChild(a),this.callUpdateHooks()},b._onKeypress=function(a){var b,c,d,e=a.keyCode;this.__rte_keymap.r_foreach(function(b){if(DlKeyboard.checkKey(a,b[0]))throw this.execCommand(b[1]),new DlExStopFrameEvent},this);if(e==DlKeyboard.TAB){b=this.queryCommandValue("formatblock");if(b=="pre")throw this.insertText(this._tabChar,!0),this.collapse(!1),new DlExStopFrameEvent}else if(e==DlKeyboard.ENTER&&is_ie&&!a.shiftKey){b=this.queryCommandValue("formatblock");if(b=="pre")throw c=this.getSelection(),d=this.getRange(c),d.pasteHTML("<br/><div class='DynarchLIB-REMOVE-ME'></div>"),new DlExStopFrameEvent}}}),DEFINE_CLASS("DlSocket",DlEventProxy,function(a,b){function d(){return DlFlashUtils().getObject()}function e(){d().DlSocket_destroy(this.id),delete c[this.id]}var c;a.DEFAULT_EVENTS=["onConnect","onRelease","onData"],a.DEFAULT_ARGS={_host:["host",null],_port:["port",null],_json:["json",!1]},a.FIXARGS=function(a){a.host||(a.host=document.domain)},a.CONSTRUCT=function(){this.addEventListener("onDestroy",e),DlEvent.atUnload(this.destroy.$(this))},c={},b.send=function(a){d().DlSocket_send(this.id,a)},b.sendJSON=function(a){d().DlSocket_send(this.id,DlJSON.encode(a))},b.connect=function(){this.id=d().DlSocket_connect(this._host,this._port),c[this.id]=this},b.reconnect=function(){d().DlSocket_reconnect(this.id)},b.disconnect=function(){d().DlSocket_disconnect(this.id)},window.DlSocket_onConnect=function(a,b){c[a].applyHooks("onConnect",[b])},window.DlSocket_onData=function(a,b){var d;b=DlFlashUtils.decodeString(b),d=c[a],d._json&&(b=DlJSON.decode(b)),d.applyHooks("onData",[b])},window.DlSocket_onDisconnect=function(a,b){c[a].applyHooks("onRelease",[b])}}),DEFINE_CLASS("DlSound",DlEventProxy,function(a,b){function d(){return DlFlashUtils().getObject()}function e(){delete c[this.id]}function f(a){this.__fileLoaded=a,a&&this.__shouldPlay&&(this.play.apply(this,this.__shouldPlay),this.__shouldPlay=null)}var c={};a.DEFAULT_EVENTS=["onLoad","onComplete"],a.DEFAULT_ARGS={_volume:["volume",null],_pan:["pan",null],_url:["url",null],_stream:["stream",!1]},a.CONSTRUCT=function(){this.addEventListener({onDestroy:e,onLoad:f}),this.id=d().DlSound_create(),this._volume!=null&&this.setVolume(this._volume),this._pan!=null&&this.setPan(this._pan),c[this.id]=this},b.load=function(a,b){a==null&&(a=this._url),b==null&&(b=this._stream),this.__fileLoaded=!1,this.__loadCalled=!0,d().DlSound_load(this.id,this._url=a,this._stream=b)},b.play=function(a,b){this.__fileLoaded?d().DlSound_play(this.id,a,b):this.__loadCalled||(this.__shouldPlay=[a,b],this.load())},b.stop=function(){d().DlSound_stop(this.id)},b.getBytesLoaded=function(){return d().DlSound_getBytesLoaded(this.id)},b.getBytesTotal=function(){return d().DlSound_getBytesTotal(this.id)},b.getDuration=function(){return d().DlSound_getDuration(this.id)},b.getPosition=function(){return d().DlSound_getPosition(this.id)},b.setPan=function(a){d().DlSound_setPan(this.id,this._pan=a)},b.setVolume=function(a){d().DlSound_setVolume(this.id,this._volume=a)},b.getPan=function(){return this._pan},b.getVolume=function(){return this._volume},b.getURL=function(){return this._url},window.DlSound_onLoad=function(a,b){c[a].applyHooks("onLoad",[b])},window.DlSound_onSoundComplete=function(a){c[a].callHooks("onComplete")}}),DEFINE_CLASS("DlSpinner",DlEntry,function(a,b,c){function e(){this.select()}function f(){this._clearTimer()}function g(a){throw this._spinnerUpdateVal(a.wheelDelta>0),new DlExStopEventBubbling}function h(a){switch(a.keyCode){case DlKeyboard.ARROW_DOWN:throw k.call(this,{_direction:!1}),new DlExStopEventBubbling;case DlKeyboard.ARROW_UP:throw k.call(this,{_direction:!0}),new DlExStopEventBubbling}}function i(){this._clearTimer()}function j(){var a=this.getValue(),b=a==this._maxVal,c=a==this._minVal;this._buttonUp.disabled(b||!!this.readonly()),this._buttonDown.disabled(c||!!this.readonly()),(b||c)&&this._clearTimer()}function k(a){throw this._spinnerUpdateVal(a._direction),(this._timerState=Array.$(this.intervals)).r_foreach(function(a){a.step*=this.step},this),this._timerPos=0,this._startTimer(a._direction,250),new DlExStopEventBubbling}function l(){this._clearTimer()}var d=c.createElement;a.FIXARGS=function(a){a.validators=[new DlValidator(DlValidator.Number,a.minVal,a.maxVal,a.integer,a.decimals)],a.type="text"},a.CONSTRUCT=function(){this._timer=null,this._timerStep=null,this._timerState=null,this._timerPos=null},a.DEFAULT_EVENTS=["onSpin"],a.DEFAULT_ARGS={_step:["step",1],_size:["size",4],_value:["value",0],_minVal:["minVal",null],_maxVal:["maxVal",null],_decimals:["decimals",null],_integer:["integer",!1]},b.intervals=[{pos:1,step:1,speed:125},{pos:10,step:1,speed:70},{pos:20,step:1,speed:35},{pos:50,step:1,speed:20},{pos:100,step:1,speed:10},{pos:200,step:2,speed:10}],b._createElement=function(){var b,c,e,f,g;this._no_gecko_bug=!0,a.BASE._createElement.call(this),b=this.getElement(),c=b.rows[0].cells[0],c.rowSpan=2,c=c.parentNode,e=d("tr",null,null,c.parentNode),f=d("td",null,{className:"DlSpinner-Button DlSpinner-Button-Up"},c),g=d("td",null,{className:"DlSpinner-Button DlSpinner-Button-Down"},e),this._buttonUp=new DlButton({parent:this,appendArgs:f}),this._buttonDown=new DlButton({parent:this,appendArgs:g}),this._btn=this._buttonUp},b._setListeners=function(){a.BASE._setListeners.call(this),this.addEventListener({onFocus:e,onBlur:f,onMouseWheel:g,onKeyDown:h,onKeyUp:i,onChange:j})},b.initDOM=function(){a.BASE.initDOM.call(this),this._setupSpinnerBtn(this._buttonUp,!0),this._setupSpinnerBtn(this._buttonDown,!1)},b.readonly=function(b){return b!=null&&(this._buttonUp.disabled(b),this._buttonDown.
disabled(b)),a.BASE.readonly.apply(this,arguments)},b.getFormValue=function(){var a=this.getValue(),b=parseFloat(a);return isNaN(b)?a:b},b._spinnerUpdateVal=function(a){var b,c,d,e;this._readonly||(b=new Number(this.getValue()),c=this._timerStep||this._step,b=a?b+c:b-c,this._minVal!=null&&b<this._minVal&&(b=this._minVal),this._maxVal!=null&&b>this._maxVal&&(b=this._maxVal),this.setValue(b),this.applyHooks("onSpin",[b]),this.focus(),this.select(),this._timer&&(d=++this._timerPos,this._timerState.length&&d==this._timerState[0].pos&&(e=this._timerState.shift(),this._clearTimer(!0),this._timerStep=e.step,this._startTimer(a,e.speed))))},b._clearTimer=function(a){this._timer&&clearInterval(this._timer),a||(this._timerState=null,this._timerStep=null,this._timerPos=null),this._timer=null},b._startTimer=function(a,b){this._timer&&clearInterval(this._timer),this._timer=setInterval(this._spinnerUpdateVal.$(this,a),b)},b._setupSpinnerBtn=function(a,b){var c;a._direction=b,c=l.$(this,a),a.addEventListener({onMouseDown:k.$(this,a),onMouseUp:c})},b.setMinVal=function(a,b){var c;this._minVal=a,c=this.getFormValue(),c!=null&&!isNaN(c)&&c<a&&this.setValue(a,b)},b.setMaxVal=function(a,b){var c;this._maxVal=a,c=this.getFormValue(),c!=null&&!isNaN(c)&&c>a&&this.setValue(a,b)}}),DEFINE_CLASS("DlStyleSheet",DlEventProxy,function(a,b,c){function d(){c.trash(this._el),this._s=null,this._el=null}a.CONSTRUCT=function(){this._init()},b.insertRule=function(a,b,d){var e,f,g,h,i=this._s;d==null&&(d=this.getRules().length);if(typeof b=="object"){e=[];for(f in b)e.push(f+":"+b[f]);b=e.join(";")}else b instanceof Array&&(b=b.join(";"));if(is_ie){a=a.split(/\s*,\s*/);if(a.length!=1){g=c.ID(),h=this._ier[g]=[];for(f=0;f<a.length;++f)i.addRule(a[f],b,d+f),h.push(this.getRules()[d+f]);return g}i.addRule(a,b,d)}else i.insertRule(a+"{"+b+"}",d);return this.getRules()[d]},b.deleteRule=function(a){var b,c;if(is_ie&&typeof a=="string")this._ier[a].foreach(this.deleteRule.$(this)),delete this._ier[a];else{b=this.getRules();for(c=b.length;--c>=0;)if(b[c]===a)return is_ie?this._s.removeRule(c):this._s.deleteRule(c),c}},b.modifyRule=function(a,b){var c;if(is_ie&&typeof a=="string")this._ier[a].foreach(function(a){this.modifyRule(a,b)},this);else for(c in b)a.style[c]=b[c]},b.refresh=function(){var a=this.disabled();this.disabled(!a),this.disabled(a)},b.getRules=function(){return is_ie?this._s.rules:this._s.cssRules},b.disabled=function(a){var b=is_ie?this._s:this._el;return a!=null&&(b.disabled=a),!!b.disabled},b._init=function(){is_ie&&(this._ier={}),this._el=c.createElement("style",null,{type:"text/css"},document.getElementsByTagName("head")[0]),this._s=document.styleSheets[document.styleSheets.length-1],this.addEventListener("onDestroy",d)}}),DEFINE_CLASS("DlTabs",DlContainer,function(a,b){function c(a,b,c){var d=b!=null?this._panes[b]:null;d&&d._tab.checked(!0),a.applyHooks("onChange",[b,c])}function d(a){a.checked()&&this._tabContent.showPane(a.userData)}function e(){throw this.checked(!0),new DlExStopEventProcessing}a.DEFAULT_EVENTS=["onChange"],a.DEFAULT_ARGS={_tabPos:["tabPos","top"]},b.addTab=function(a,b,c){return this._tabContent.appendWidget(a,c),a._tab=new DlButton({label:b,parent:this._tabBar,group:this._tabGroup,type:DlButton.TYPE.TWOSTATE,data:this._tabContent.length()-1}),a._tab.addEventListener("onClick",e,!0),a.addEventListener("onDestroy",a._tab.destroy.$(a._tab)),a},b.addTab2=function(a){var b=this.addTab(a.widget,a.title,a.pos);return a.iconClass&&b._tab.setIconClass(a.iconClass),b},b.getTabBar=function(){return this._tabBar},b.getNotebook=function(){return this._tabContent},b.getTabButton=function(a){return this.getNotebook().getPane(a)._tab},b.getTabContent=b.getNotebook,b.initDOM=function(){a.BASE.initDOM.call(this),this._tabGroup=DlRadioGroup.get(this.id),this._tabBar=new DlHbox({className:"TabBar"}),this._tabContent=new DlNotebook({className:"TabContent"});switch(this._tabPos){case"top":case"left":this.appendWidget(this._tabBar),this.appendWidget(this._tabContent);break;case"bottom":case"right":this.appendWidget(this._tabContent),this.appendWidget(this._tabBar)}this._tabContent.addEventListener("onChange",c.$(this._tabContent,this)),this._tabGroup.addEventListener("onChange",d.$(this)),this.addClass("DlTabs-"+this._tabPos)},b.setTabPos=function(a){var b,c=this._tabBar.getElement(),d=this._tabContent.getElement();c.parentNode&&c.parentNode.removeChild(c),b=a=="top"||a=="left"?b=d:null,d.parentNode.insertBefore(c,b),this.addClass("DlTabs-"+a,"DlTabs-"+this._tabPos),this._tabPos=a},b.setTabAlign=function(a){return this._tabBar.setAlign(a)},b.setOuterSize=b.setSize=function(b){var c;a.BASE.setSize.call(this,b),b=this.getInnerSize(),c=this._tabBar.getSize();switch(this._tabPos){case"top":case"bottom":b.y-=c.y;break;case"left":case"right":b.x-=c.x}this._tabContent.setSize(b)},b.showPane=function(a){return this._tabContent.showPane(a)},b.nextPane=function(){return this._tabContent.nextPane()},b.prevPane=function(){return this._tabContent.prevPane()},b.isFirstPane=function(){return this._tabContent.isFirstPane()},b.isLastPane=function(){return this._tabContent.isLastPane()},b.getCurrentPane=function(){return this._tabContent.getCurrentPane()},b.getCurrentPaneIndex=function(){return this._tabContent.getCurrentPaneIndex()},b._handle_focusKeys=function(a){var b;a.shiftKey?a.keyCode==DlKeyboard.PAGE_UP?(this.prevPane(),this.getCurrentPane()._tab.focus(),DlException.stopEventBubbling()):a.keyCode==DlKeyboard.PAGE_DOWN&&(this.nextPane(),this.getCurrentPane()._tab.focus(),DlException.stopEventBubbling()):a.keyCode==DlKeyboard.TAB&&this._tabBar.focusInside()&&(b=this.getCurrentPane().getFirstFocusWidget(),b&&(b.focus(),DlException.stopEventBubbling()))}}),DlTextUtils=function(){function h(b){function o(){return this.scrollLeft=g.x,this.scrollTop=g.y,c.stopEvent(b)}var e,g,h,i,j,k,l,m,n;b||(b=window.event),e=c.getSelectionRange(this),g={x:this.scrollLeft,y:this.scrollTop};if(b.altKey&&b.charCode==113)return h=a.fillText(this.value,72,e.start),this.value=h.text,c.setSelectionRange(this,h.pos,h.pos),o.call(this);if(b.ctrlKey&&b.keyCode in f)return i=b.keyCode==d.ARROW_UP,j=a.getParagraph(this.value,i?e.start:e.end),k=(i?j.start-1:j.end+1).limit(0,this.length),c.setSelectionRange(this,b.shiftKey?i?e.end:e.start:k,k),c.stopEvent(b);if(b.altKey&&b.keyCode==d.ENTER)return l=this.value,j=a.getParagraph(l,e.start),m=a.getFillPrefix(j.text),n=m[0],typeof n=="function"?n=n(m):n=n[0],l=l.substr(0,j.end)+"\n\n"+n+l.substr(j.end),this.value=l,c.setSelectionRange(this,j.end+2+n.length),o.call(this)}function i(a,b,c){var d,e,f=-1;b.lastIndex=0,b.global=!0,e=-1;while(d=b.exec(a)){if(b.lastIndex>=c)break;f=b.lastIndex;if(f==e)throw"Repeated! "+f;e=f}return f}function j(a,b,c){var d;return b.lastIndex=c,b.global=!0,d=b.exec(a),d?d.index:null}var a,b,c=DynarchDomUtils,d=DlKeyboard,e=[/^(\s*[-*]+\s+)/,function(a){return[a," ".x(a[0].length),a[0].length]},/^(\s*)([0-9]+)(\.\s+)/,function(a){return[function(){var b=parseInt(a[2],10)+1;return a[1]+b+a[3]}," ".x(a[0].length),a[0].length]},/^(\s*)([a-z])(\)\s+)/i,function(a){return[function(){var b=String.fromCharCode(a[2].charCodeAt(0)+1);return a[1]+b+a[3]}," ".x(a[0].length),a[0].length]},/^\s*([>|]\s*)*/,function(a){return[a,a[0],a[0].length,/\n\s*([>|]\s*)*/g,"\n"]},/^\s+/,function(a){return[a,a[0],a[0].length]}],f=[d.ARROW_UP,d.ARROW_DOWN].toHash(!0),g=String.fromCharCode(0);return b=/\n([>|\s]*\n)+/g,a={getParagraph:function(a,c){var d=i(a,b,c+1),e=j(a,b,c);return d==-1&&(d=0),e==null&&(e=a.length),{start:d,end:e,text:a.substring(d,e)}},getFillPrefix:function(a){var b,c,d,f=0;a=a.replace(/\x00/g,"");while(f<e.length){b=e[f++],c=e[f++],b.lastIndex=0;if(d=b.exec(a))return c(d)}},fillParagraph:function(b,c,d){var e,f,h,i,j,k,l,m,n;b=b.substr(0,d)+g+b.substr(d),e=a.getFillPrefix(b),f=e[1],h=e[2],i=b.substr(0,h),b=b.substr(h),e[3]&&(b=b.replace(e[3],function(){return e[4]||""})),b=b.replace(/\n/g," ").replace(/([^.?!])\s\s+/g,"$1 "),j=RegExp("(.{0,"+(c-f.length)+"})(\\s+|$)","g"),l=[],m=0;while(k=j.exec(b)){j.index!=m?n=b.substring(m,j.lastIndex):n=k[1],m=j.lastIndex;if(!/\S/.test(n))break;l.push(n.trim(!0))}return b=i+l.join("\n"+f),d=b.indexOf(g),d>=0&&(b=b.substr(0,d)+b.substr(d+1)),{text:b,pos:d}},fillText:function(b,c,d){var e=a.getParagraph(b,d),f=b.substr(0,e.start),g=b.substr(e.end),h=d-e.start,i=a.fillParagraph(e.text,c,h);return{text:f+i.text+g,pos:e.start+i.pos}},emacsipateTextarea:function(a){c.addEvent(a,is_ie?"keydown":"keypress",h)}}}(),DEFINE_CLASS("DlTooltip",DlPopup,function(a){a.FIXARGS=function(a){a.zIndex=2e3,a.focusable=!1,this._mouseDiff={x:8,y:12}}}),DEFINE_CLASS("DlTree",DlContainer,function(a,b,c){a.CONSTRUCT=function(){this.__treeItems=[]},b.getItem=function(a){return this.__treeItems[a]},b.getItems=function(){return this.__treeItems},b.appendWidget=function(b,c){b instanceof DlTreeItem&&b.parent===this&&c>b.getIndex()&&--c,a.BASE.appendWidget.call(this,b,c)},b.removeWidget=function(b){var c,d;a.BASE.removeWidget.call(this,b),b instanceof DlTreeItem&&(c=this.__treeItems.find(b),this.__treeItems.splice(c,1),d=this.__treeItems.length,d==0?this.parent instanceof DlTreeItem&&this.destroy():(c==0&&this.__treeItems[c]._setFirstLast(!0,null),c==d&&this.__treeItems[c-1]._setFirstLast(null,!0)))},b._appendWidgetElement=function(a,b){var c,d,e=this.__treeItems,f=this.getContentElement();if(b==null)a instanceof DlTreeItem&&(c=e.peek(),c?c._setFirstLast(null,!1):a._setFirstLast(!0,null),e.push(a),a._setFirstLast(null,!0)),f.appendChild(a.getElement());else{if(b==e.length)return this._appendWidgetElement(a,null);d=e[b],d&&d._setFirstLast(!1,b==e.length-1),a._setFirstLast(b==0,!1),e.splice(b,0,a),f.insertBefore(a.getElement(),f.childNodes[b])}},b.addSeparator=function(a){c.createElement("div",null,{className:a||"DlTree-separator",innerHTML:"&nbsp;"},this.getElement())}}),DEFINE_CLASS("DlTreeItem",DlContainer,function(a,b,c){function i(a){var b=a.target;try{while(b&&b.tagName.toLowerCase()!="td")b=b.parentNode}catch(c){b=null}return b}function j(a){var b=i(a);if(b&&/DlTreeItem-(Expander|Icon)/.test(b.className))throw this.toggle(),new DlExStopEventBubbling}function k(){var a=this.getSubtreeDiv();window.DL_CLOSING||c.trash(a),c.removeEvent(this.getDivElement(),"mousedown",this.__onLabelMouseDown)}var d,e=c.createElement,f=c.addClass,g=c.delClass,h=c.condClass;a.CONSTRUCT=function(){this.setIconClass(this.__iconClass),this.__iconClass=null},a.DEFAULT_ARGS={__label:["label",null],__iconClass:["iconClass",null],__itemClass:["itemClassName",null]},a.DEFAULT_EVENTS=["onExpand","onCollapse","onLabelMouseDown"],d="<div class='DlTreeItem-div'><table cellspacing='0' cellpadding='0' class='DlTreeItem-Table'><tbody><tr><td class='DlTreeItem-Expander'><div class='DlTree-IconWidth'>&nbsp;</div></td><td></td><td class='DlTreeItem-Label'></td></tr></tbody></table></div><div class='DlTreeItem-Subtree'></div>",b._setFirstLast=function(a,b){a!=null&&(this.condClass(a,"DlTreeItem-First"),h(this.getTableElement(),a,"DlTreeItem-First")),b!=null&&(this.condClass(b,"DlTreeItem-Last"),h(this.getTableElement(),b,"DlTreeItem-Last"))},b._setListeners=function(){a.BASE._setListeners.call(this),this.addEventListener({onMouseDown:j,onDestroy:k})},b._createElement=function(){a.BASE._createElement.call(this),this.getElement().innerHTML=d,this.__label&&this.setContent(this.__label),this.setUnselectable(),this.__onLabelMouseDown=this._onLabelMouseDown.$(this),c.addEvent(this.getDivElement(),"mousedown",this.__onLabelMouseDown),this.__itemClass&&f(this.getDivElement(),this.__itemClass)},b._onLabelMouseDown=function(){this.callHooks("onLabelMouseDown")},b.getDivElement=function(){return this.getElement().firstChild},b.getTableElement=function(){return this.getElement().firstChild.firstChild},b.getExpanderElement=function(){return this.getTableElement().rows[0].cells[0]},b.getIconElement=function(){return this.getTableElement().rows[0].cells[1]},b.getContentElement=function(){return this.getTableElement().rows[0].cells[2]},b.getSubtreeDiv=function(){return this.getElement().childNodes[1]},b.getSubtreeWidget=function(){return this._subtree},b.getIndex=function(){return this.parent.__treeItems.find(this)},b.getParentItem=function(){return this.parent.parent},b.addSubItem=function(a,b){var c=this.getSubtreeWidget();!c&&!this._tree&&(c=new DlTree({}),this.setTree(c),this.expand()),c.appendWidget(a,b)},b.setTree=function(a,b,c){this._tree&&typeof this._tree!="function"&&this.removeWidget(this._tree),this._tree=a,a!=null&&(typeof a!="function"?this.appendWidget(a,!0):b==null&&(b=!1),b?this.expand(b):(this.getSubtreeDiv().style.display="none",this.updateExpanderState())),c==null?(this._subtreeNeverExpires=!0,this._subtreeExpires=null):(this._subtreeNeverExpires=!1,this._subtreeExpires=(new Date).getTime()+c),this.condClass(a,"DlTreeItem-hasSubtree"),this.updateExpanderState()},b.isExpanded=function(){return this.getSubtreeDiv().style.display!=="none"},b.toggle=function(){this.expand(!this.isExpanded())},b.getPath=function(){var a=[],b=this.getParentItem();while(b instanceof DlTreeItem)a.push(b),b=b.getParentItem();return a},b.expandParents=function(a){var b=this.getParentItem();while(b instanceof DlTreeItem)b.expand(a),b=b.getParentItem()},b.expand=function(a,b){function e(){c.getSubtreeDiv().style.display=a?"block":"none",c.updateExpanderState(),b||c.callHooks(a?"onExpand":"onCollapse")}function f(a,b){var d=c._tree;if(c._subtree)try{c._subtree.destroy()}catch(f){}c._tree=d,b==null?(c._subtreeNeverExpires=!0,c._subtreeExpires=null):(c._subtreeNeverExpires=!1,c._subtreeExpires=(new Date).getTime()+b),c.appendWidget(a,!0),e()}var c,d;a==null&&(a=!0),c=this,a!==this.isExpanded()&&(a&&typeof this._tree=="function"?this._subtree?this._subtreeNeverExpires?e():(d=(new Date).getTime(),this._subtreeExpires&&d<=this._subtreeExpires?e():this._tree(f,this)):this._tree(f,this):e())},b.setIconClass=function(a){var b=this.getIconElement();h(b,a!=null,"DlTreeItem-Icon"),this.iconClass&&(b.innerHTML="",g(b,this.iconClass)),a&&(b.innerHTML="<div class='DlTree-IconWidth'>&nbsp;</div>",f(b,a)),this.iconClass=a},b.updateExpanderState=function(){var a,b=this.getExpanderElement().firstChild;this._tree?(a=this.isExpanded(),h(b,a,"DlTreeItem-Arrow-Expanded","DlTreeItem-Arrow-Collapsed"),h(this.getTableElement(),a,"DlTreeItem-Table-Expanded","DlTreeItem-Table-Collapsed")):(g(b,"DlTreeItem-Arrow-Expanded"),g(b,"DlTreeItem-Arrow-Collapsed"),this.delClass("DlTreeItem-hasSubtree"))},b._appendWidgetElement=function(a,b){var c,d=a.getElement();a instanceof DlTreeItem?this.addSubItem(a,b):(c=b||a instanceof DlTree?this.getSubtreeDiv():this.getContentElement(),b&&(this._subtree=a,f(d,"DlTree-withLines"),this.addClass("DlTreeItem-hasSubtree")),c.appendChild(d))},b._removeWidgetElement=function(b){a.BASE._removeWidgetElement.call(this,b),this.getSubtreeDiv().firstChild||(this._tree=null,this._subtree=null),this.updateExpanderState()},b._setFocusedStyle=function(a){h(this.getDivElement(),a,"DlTreeItem-div-focus")}}),DlType.TYPES={},DlType.prototype={getDisplayValue:function(a){return a},compare:function(){throw"No comparator for type: "+this.name}},DEFINE_CLASS("DlUploadEntry",DlWidget,function(a,b,c){function d(a){a.applyHooks("onChange",[this,this.name,this.value])}function e(a){is_ie&&(a=this.ownerDocument.parentWindow.event),this.firstChild.style.right=30-a.clientX+"px"}a.DEFAULT_EVENTS=["onUploadStart","onUploadEnd","onChange"],a.DEFAULT_ARGS={_url:["url",null],_files:["files",["file"]],_params:["params",null]},a.BEFORE_BASE=function(){this._files instanceof Array||(this._files=[this._files])},b._createElement=function(){var b;a.BASE._createElement.call(this),b=c.createElement("iframe",null,{frameBorder:0,marginHeight:0,marginWidth:0,allowTransparency:!0,src:is_ie?"javascript:'';":"about:blank"},this.getElement()),this.refNode("_iframe",b)},b.init=function(){var a,b,c,f,g=String.buffer("<html style='margin: 0; padding: 0; overflow: hidden; height: 100%;'>","<head>","<link type='text/css' rel='stylesheet' href='",Dynarch.getFileURL("css/uploadentry.css"),"' />","</head>","<body>","<form action='",this._url,"' method='POST' encoding='multipart/form-data'>","<input type='hidden' name='_uploaderID' value='",this.getWidgetId(),"' />"),h=this._params;if(h){h instanceof Array&&(h=h.toHash(""));for(a in h)g("<input type='hidden' name='",a,"' value='",h[a],"' />")}this._files.foreach(function(a){g("<label class='upload'><input type='file' name='",a,"' /></label>")}),g("</form></body></html>"),b=this._iframe.contentWindow,c=b.document,c.open(),c.write(g.get()),c.close(),this.refNode("_win",b),this.refNode("_doc",c),this.refNode("_form",c.getElementsByTagName("form")[0]),this._form.method="POST",this._form.encoding="multipart/form-data",f=d.$(null,this),this._files.foreach(function(a){var b=this._form.elements.namedItem(a);b.onchange=f,b.parentNode.onmousemove=e},this)},b.setParam=function(a,b){var c,d;if(typeof a=="string")c=this.getField(a),c||(c=this._doc.createElement("input"),c.type="hidden",c.name=a,this._form.appendChild(c)),c.value=b;else for(d in a)this.setParam(d,a[d])},b.getParam=function(a){var b=this.getField(a);return b&&b.value},b.getField=function(a){return this._form.elements.namedItem(a)},b.submit=function(){this.callHooks("onUploadStart"),this._form.submit()},a.finishUpload=function(a){a instanceof DlUploadEntry||(a=DlWidget.getById(a));if(!a)throw"No such uploader: "+a;a.init(),a.applyHooks("onUploadEnd",Array.$(arguments,1))}}),DEFINE_EXCEPTION("DlValidatorException"),DlValidatorException.MISMATCH=1,DlValidatorException.TOO_SMALL=2,DlValidatorException.TOO_BIG=3,DEFINE_CLASS("DlValidator",null,function(a,b){function c(a){function c(b){return b.foreach(function(b,c){b.toLowerCase().indexOf(a)==0&&$RETURN(c)})}var b;return a=a.toLowerCase(),b=c(DlTEXTS._date_shortMonthNames)||c(DlTEXTS._date_monthNames),b!=null&&b++,b}a.CONSTRUCT=function(b){b&&(typeof b=="string"&&(b=a[b]),this._callback=b,this._args=arguments.length>1?Array.$(arguments,1):null)},b.ok=function(a){var b,c;if(typeof this._lastData!="undefined"&&this._lastData===a)return!0;try{return b=[a].concat(this._args||Array.$(arguments,1)),c=this._callback.apply(this,b),this._lastData=a,this._lastValue=c,!0}catch(d){if(d instanceof DlValidatorException)return this._error=d,!1;throw d}},b.getLastVal=function(){return this._lastValue},b.getLastData=function(){return this._lastData},b.getError=function(){return this._error},a.Number=function(a,b,c,d,e){var f;a=a.replace(/\s/g,""),f=new Number(a);if(isNaN(f))throw new DlValidatorException("Value must be numeric",DlValidatorException.MISMATCH);if(d&&f!=Math.round(f))throw new DlValidatorException("Value must be an integer",DlValidatorException.MISMATCH);if(b!=null&&f<b)throw new DlValidatorException("Value must be bigger than "+b,DlValidatorException.TOO_SMALL);if(c!=null&&f>c)throw new DlValidatorException("Value must be smaller than "+c,DlValidatorException.TOO_BIG);return e&&(f=f.toFixed(e)),f},a.Email=function(a){a=a.trim();if(!/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i.test(a))throw new DlValidatorException("That doesn't look like an email address",DlValidatorException.MISMATCH);return a},a.URL=function(a,b){b||(b={}),a=a.trim();if(!/^(https?|ftps?):\x2f\x2f/.test(a)){if(/^([a-z0-9_-]+\.)+[a-z]+$/i.test(a))return/^www\./.test(a)||(a="www."+a),"http://"+a+"/";throw new DlValidatorException("Value must be an absolute URL",DlValidatorException.MISMATCH)}return a},a.Date=function(a,b,d){var e,f,g,h,i,j,k,l,m,n;if(!/\S/.test(a))return"";b||(b="%Y-%m-%d"),a=a.replace(/^\s+/,"").replace(/\s+$/,""),e=new Date,f=null,g=null,h=null,i=null,j=null,k=null,l=a.match(/([0-9]{1,2}):([0-9]{1,2})(:[0-9]{1,2})?\s*(am|pm)?/i),l&&(i=parseInt(l[1],10),j=parseInt(l[2],10),k=l[3]?parseInt(l[3].substr(1),10):0,a=a.substring(0,l.index)+a.substr(l.index+l[0].length),l[4]&&(l[4].toLowerCase()=="pm"&&i<12?i+=12:l[4].toLowerCase()=="am"&&i>=12&&(i-=12))),m=a.split(/\W+/),n=[],m.foreach(function(a){/^[0-9]{4}$/.test(a)?(f=parseInt(a,10),!g&&!h&&d==null&&(d=!0)):/^[0-9]{1,2}$/.test(a)?(a=parseInt(a,10),a<60?a<0||a>12?a>=1&&a<=31&&(h=a):n.push(a):f=a):g=c(a)}),n.length<2?n.length==1&&(h?g||(g=n.shift()):h=n.shift()):d?(g||(g=n.shift()),h||(h=n.shift())):(h||(h=n.shift()),g||(g=n.shift())),f||(f=n.length>0?n.shift():e.getFullYear()),f<30?f+=2e3:f<99&&(f+=1900),g||(g=e.getMonth()+1);if(!(f&&g&&h))throw this._date=null,new DlValidatorException("Can't figure out this date",DlValidatorException.MISMATCH);return this._date=new Date(f,g-1,h,i,j,k),this._date.print(b)}}),DlConsole.prototype={log:function(a){a=a.printf.apply(a,Array.$(arguments,1)),this._addMsg({str:a})},line:function(){this._addMsg({str:"&nbsp;",cls:"sep"})},CC:function(a,b){var c=this.win.document.createElement("div");c.className=b||"msg",c.innerHTML=a,this.win.document.body.appendChild(c),this.win.scrollTo(0,c.offsetTop+c.offsetHeight),this._last&&DynarchDomUtils.delClass(this._last,"current"),DynarchDomUtils.addClass(c,"current"),this._last=c},_addMsg:function(a){this._init(),this.win?this.CC(a.str,a.cls):this._messages.push(a)},_init:function(){this.win||window.open(Dynarch.getFileURL("html/dlconsole.html"),"DlConsole","height=400,width=600,menubar=0,toolbar=0,scrollbars=1")},_loaded:function(a){this._last=null,this.win=a,this.log("<b>DynarchLIB Console</b><br />Initialized at %s",new Date),this.line(),this._messages.foreach(this._addMsg,this)},protect:function(name){var func=eval(name),f=function(){try{var a=[];for(var b=0;b<arguments.length;++b)a.push(arguments[b]);console.log(name+" ["+a.join(", ")+"]"),func.apply(this,arguments)}catch(c){throw alert("Exception in "+name+"\n"+c),c}};eval(name+" = f")}},window.dlconsole||(window.dlconsole=new DlConsole);